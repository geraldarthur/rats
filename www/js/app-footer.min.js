(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports)exports=module.exports=_;exports._=_;}else root._=_;_.VERSION='1.4.2';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return;}else for(var key in obj)if(_.has(obj,key))if(iterator.call(context,obj[key],key,obj)===breaker)return;};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});return results;};_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else memo=iterator.call(context,memo,value,index,list);});if(!initial)throw new TypeError('Reduce of empty array with no initial value');return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return arguments.length>2?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length;}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true;}else memo=iterator.call(context,memo,obj[index],index,list);});if(!initial)throw new TypeError('Reduce of empty array with no initial value');return memo;};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){var results=[];if(obj==null)return results;each(obj,function(value,index,list){if(!iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return !!result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker;});return !!result;};_.contains=_.include=function(obj,target){var found=false;if(obj==null)return found;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;found=any(obj,function(value){return value===target;});return found;};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.where=function(obj,attrs){if(_.isEmpty(attrs))return [];return _.filter(obj,function(value){for(var key in attrs)if(attrs[key]!==value[key])return false;return true;});};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return -Infinity;var result={computed:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value;});return shuffled;};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value];};};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return -1;}return left.index<right.index?-1:1;}),'value');};var group=function(obj,value,context,behavior){var result={};var iterator=lookupIterator(value);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value);});return result;};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:(result[key]=[])).push(value);});};_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){if(!_.has(result,key))result[key]=0;result[key]++;});};_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=(low+high)>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid;}return low;};_.toArray=function(obj){if(!obj)return [];if(obj.length===+obj.length)return slice.call(obj);return _.values(obj);};_.size=function(obj){return(obj.length===+obj.length)?obj.length:_.keys(obj).length;};_.first=_.head=_.take=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if((n!=null)&&!guard)return slice.call(array,Math.max(array.length-n,0));else return array[array.length-1];};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,(n==null)||guard?1:n);};_.compact=function(array){return _.filter(array,function(value){return !!value;});};var flatten=function(input,shallow,output){each(input,function(value){if(_.isArray(value))shallow?push.apply(output,value):flatten(value,shallow,output);else output.push(value);});return output;};_.flatten=function(array,shallow){return flatten(array,shallow,[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator,context){var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?(!index||seen[seen.length-1]!==value):!_.contains(seen,value)){seen.push(value);results.push(array[index]);}});return results;};_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments));};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return !_.contains(rest,value);});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results;};_.object=function(list,values){var result={};for(var i=0,l=list.length;i<l;i++)if(values)result[list[i]]=values[i];else result[list[i][0]]=list[i][1];return result;};_.indexOf=function(array,item,isSorted){if(array==null)return -1;var i=0,l=array.length;if(isSorted)if(typeof isSorted=='number')i=(isSorted<0?Math.max(0,l+isSorted):isSorted);else{i=_.sortedIndex(array,item);return array[i]===item?i:-1;}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<l;i++)if(array[i]===item)return i;return -1;};_.lastIndexOf=function(array,item,from){if(array==null)return -1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);var i=(hasIndex?from:array.length);while(i--)if(array[i]===item)return i;return -1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}return range;};var ctor=function(){};_.bind=function bind(func,context){var bound,args;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError();args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor();var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait){var context,args,timeout,throttling,more,result;var whenDone=_.debounce(function(){more=throttling=false;},wait);return function(){context=this;args=arguments;var later=function(){timeout=null;if(more)result=func.apply(context,args);whenDone();};if(!timeout)timeout=setTimeout(later,wait);if(throttling)more=true;else{throttling=true;result=func.apply(context,args);}whenDone();return result;};};_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)result=func.apply(context,args);};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result;};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo;};};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args);};};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0];};};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1)return func.apply(this,arguments);};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){var values=[];for(var key in obj)if(_.has(obj,key))values.push(obj[key]);return values;};_.pairs=function(obj){var pairs=[];for(var key in obj)if(_.has(obj,key))pairs.push([key,obj[key]]);return pairs;};_.invert=function(obj){var result={};for(var key in obj)if(_.has(obj,key))result[obj[key]]=key;return result;};_.functions=_.methods=function(obj){var names=[];for(var key in obj)if(_.isFunction(obj[key]))names.push(key);return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop];});return obj;};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key];});return copy;};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)if(!_.contains(keys,key))copy[key]=obj[key];return copy;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source)if(obj[prop]==null)obj[prop]=source[prop];});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case '[object String]':return a==String(b);case '[object Number]':return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case '[object Date]':case '[object Boolean]':return +a==+b;case '[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}if(typeof a!='object'||typeof b!='object')return false;var length=aStack.length;while(length--)if(aStack[length]==a)return bStack[length]==b;aStack.push(a);bStack.push(b);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result)while(size--)if(!(result=eq(a[size],b[size],aStack,bStack)))break;}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&(aCtor instanceof aCtor)&&_.isFunction(bCtor)&&(bCtor instanceof bCtor)))return false;for(var key in a)if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break;}if(result){for(key in b)if(_.has(b,key)&&!(size--))break;result=!size;}}aStack.pop();bStack.pop();return result;};_.isEqual=function(a,b){return eq(a,b,[],[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return !!(obj&&obj.nodeType===1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};each(['Arguments','Function','String','Number','Date','RegExp'],function(name){_['is'+name]=function(obj){return toString.call(obj)=='[object '+name+']';};});if(!_.isArguments(arguments))_.isArguments=function(obj){return !!(obj&&_.has(obj,'callee'));};if(typeof (/./)!=='function')_.isFunction=function(obj){return typeof obj==='function';};_.isFinite=function(obj){return _.isNumber(obj)&&isFinite(obj);};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i);};_.random=function(min,max){if(max==null){max=min;min=0;}return min+(0|Math.random()*(max-min+1));};var entityMap={escape:{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','/':'&#x2F;'}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp('['+_.keys(entityMap.escape).join('')+']','g'),unescape:new RegExp('('+_.keys(entityMap.unescape).join('|')+')','g')};_.each(['escape','unescape'],function(method){_[method]=function(string){if(string==null)return '';return(''+string).replace(entityRegexes[method],function(match){return entityMap[method][match];});};});_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value;};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args));};});};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\t':'t','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return '\\'+escapes[match];});source+=escape?"'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?"'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate?"';\n"+evaluate+"\n__p+='":'';index=offset+match.length;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}if(data)return render(data,_);var template=function(data){return render.call(this,data,_);};template.source='function('+(settings.variable||'obj')+'){\n'+source+'}';return template;};_.chain=function(obj){return _(obj).chain();};var result=function(obj){return this._chain?_(obj).chain():obj;};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=='shift'||name=='splice')&&obj.length===0)delete obj[0];return result.call(this,obj);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments));};});_.extend(_.prototype,{chain:function(){this._chain=true;return this;},value:function(){return this._wrapped;}});}).call(this);
(function(undefined){var moment,VERSION="1.7.2",round=Math.round,i,languages={},currentLanguage='en',hasModule=(typeof module!=='undefined'&&module.exports),langConfigProperties='months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem'.split('|'),aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,parseMultipleFormatChunker=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{1,4}/,parseTokenWord=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/i,parseTokenT=/T/i,isoRegex=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,isoFormat='YYYY-MM-DDTHH:mm:ssZ',isoTimes=[['HH:mm:ss.S',/T\d\d:\d\d:\d\d\.\d{1,3}/],['HH:mm:ss',/T\d\d:\d\d:\d\d/],['HH:mm',/T\d\d:\d\d/],['HH',/T\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters='Month|Date|Hours|Minutes|Seconds|Milliseconds'.split('|'),unitMillisecondFactors={'Milliseconds':1,'Seconds':1e3,'Minutes':6e4,'Hours':36e5,'Days':864e5,'Months':2592e6,'Years':31536e6},formatFunctions={},ordinalizeTokens='DDD w M D d'.split(' '),paddedTokens='M D H h m s w'.split(' '),formatTokenFunctions={M:function(){return this.month()+1;},MMM:function(format){return getValueFromArray("monthsShort",this.month(),this,format);},MMMM:function(format){return getValueFromArray("months",this.month(),this,format);},D:function(){return this.date();},DDD:function(){var a=new Date(this.year(),this.month(),this.date()),b=new Date(this.year(),0,1);return ~~(((a-b)/864e5)+1.5);},d:function(){return this.day();},dd:function(format){return getValueFromArray("weekdaysMin",this.day(),this,format);},ddd:function(format){return getValueFromArray("weekdaysShort",this.day(),this,format);},dddd:function(format){return getValueFromArray("weekdays",this.day(),this,format);},w:function(){var a=new Date(this.year(),this.month(),this.date()-this.day()+5),b=new Date(a.getFullYear(),0,4);return ~~((a-b)/864e5/7+1.5);},YY:function(){return leftZeroFill(this.year()%100,2);},YYYY:function(){return leftZeroFill(this.year(),4);},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),true);},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),false);},H:function(){return this.hours();},h:function(){return this.hours()%12||12;},m:function(){return this.minutes();},s:function(){return this.seconds();},S:function(){return ~~(this.milliseconds()/100);},SS:function(){return leftZeroFill(~~(this.milliseconds()/10),2);},SSS:function(){return leftZeroFill(this.milliseconds(),3);},Z:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-";}return b+leftZeroFill(~~(a/60),2)+":"+leftZeroFill(~~a%60,2);},ZZ:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-";}return b+leftZeroFill(~~(10*a/6),4);}};function getValueFromArray(key,index,m,format){var lang=m.lang();return lang[key].call?lang[key](m,format):lang[key][index];}function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count);};}function ordinalizeToken(func){return function(a){var b=func.call(this,a);return b+this.lang().ordinal(b);};}while(ordinalizeTokens.length){i=ordinalizeTokens.pop();formatTokenFunctions[i+'o']=ordinalizeToken(formatTokenFunctions[i]);}while(paddedTokens.length){i=paddedTokens.pop();formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2);}formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3);function Moment(date,isUTC,lang){this._d=date;this._isUTC=!!isUTC;this._a=date._a||null;this._lang=lang||false;}function Duration(duration){var data=this._data={},years=duration.years||duration.y||0,months=duration.months||duration.M||0,weeks=duration.weeks||duration.w||0,days=duration.days||duration.d||0,hours=duration.hours||duration.h||0,minutes=duration.minutes||duration.m||0,seconds=duration.seconds||duration.s||0,milliseconds=duration.milliseconds||duration.ms||0;this._milliseconds=milliseconds+seconds*1e3+minutes*6e4+hours*36e5;this._days=days+weeks*7;this._months=months+years*12;data.milliseconds=milliseconds%1000;seconds+=absRound(milliseconds/1000);data.seconds=seconds%60;minutes+=absRound(seconds/60);data.minutes=minutes%60;hours+=absRound(minutes/60);data.hours=hours%24;days+=absRound(hours/24);days+=weeks*7;data.days=days%30;months+=absRound(days/30);data.months=months%12;years+=absRound(months/12);data.years=years;this._lang=false;}function absRound(number){if(number<0)return Math.ceil(number);else return Math.floor(number);}function leftZeroFill(number,targetLength){var output=number+'';while(output.length<targetLength)output='0'+output;return output;}function addOrSubtractDurationFromMoment(mom,duration,isAdding){var ms=duration._milliseconds,d=duration._days,M=duration._months,currentDate;if(ms)mom._d.setTime(+mom+ms*isAdding);if(d)mom.date(mom.date()+d*isAdding);if(M){currentDate=mom.date();mom.date(1).month(mom.month()+M*isAdding).date(Math.min(currentDate,mom.daysInMonth()));}}function isArray(input){return Object.prototype.toString.call(input)==='[object Array]';}function compareArrays(array1,array2){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++)if(~~array1[i]!==~~array2[i])diffs++;return diffs+lengthDiff;}function dateFromArray(input,asUTC,hoursOffset,minutesOffset){var i,date,forValid=[];for(i=0;i<7;i++)forValid[i]=input[i]=(input[i]==null)?(i===2?1:0):input[i];input[7]=forValid[7]=asUTC;if(input[8]!=null)forValid[8]=input[8];input[3]+=hoursOffset||0;input[4]+=minutesOffset||0;date=new Date(0);if(asUTC){date.setUTCFullYear(input[0],input[1],input[2]);date.setUTCHours(input[3],input[4],input[5],input[6]);}else{date.setFullYear(input[0],input[1],input[2]);date.setHours(input[3],input[4],input[5],input[6]);}date._a=forValid;return date;}function loadLang(key,values){var i,m,parse=[];if(!values&&hasModule)values=require('./lang/'+key);for(i=0;i<langConfigProperties.length;i++)values[langConfigProperties[i]]=values[langConfigProperties[i]]||languages.en[langConfigProperties[i]];for(i=0;i<12;i++){m=moment([2000,i]);parse[i]=new RegExp('^'+(values.months[i]||values.months(m,''))+'|^'+(values.monthsShort[i]||values.monthsShort(m,'')).replace('.',''),'i');}values.monthsParse=values.monthsParse||parse;languages[key]=values;return values;}function getLangDefinition(m){var langKey=(typeof m==='string')&&m||m&&m._lang||null;return langKey?(languages[langKey]||loadLang(langKey)):moment;}function removeFormattingTokens(input){if(input.match(/\[.*\]/))return input.replace(/^\[|\]$/g,"");return input.replace(/\\/g,"");}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++)if(formatTokenFunctions[array[i]])array[i]=formatTokenFunctions[array[i]];else array[i]=removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;i<length;i++)output+=typeof array[i].call==='function'?array[i].call(mom,format):array[i];return output;};}function formatMoment(m,format){var i=5;function replaceLongDateFormatTokens(input){return m.lang().longDateFormat[input]||input;}while(i--&&localFormattingTokens.test(format))format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);if(!formatFunctions[format])formatFunctions[format]=makeFormatFunction(format);return formatFunctions[format](m);}function getParseRegexForToken(token){switch(token){case 'DDDD':return parseTokenThreeDigits;case 'YYYY':return parseTokenFourDigits;case 'S':case 'SS':case 'SSS':case 'DDD':return parseTokenOneToThreeDigits;case 'MMM':case 'MMMM':case 'dd':case 'ddd':case 'dddd':case 'a':case 'A':return parseTokenWord;case 'Z':case 'ZZ':return parseTokenTimezone;case 'T':return parseTokenT;case 'MM':case 'DD':case 'YY':case 'HH':case 'hh':case 'mm':case 'ss':case 'M':case 'D':case 'd':case 'H':case 'h':case 'm':case 's':return parseTokenOneOrTwoDigits;default:return new RegExp(token.replace('\\',''));}}function addTimeToArrayFromToken(token,input,datePartArray,config){var a,b;switch(token){case 'M':case 'MM':datePartArray[1]=(input==null)?0:~~input-1;break;case 'MMM':case 'MMMM':for(a=0;a<12;a++)if(getLangDefinition().monthsParse[a].test(input)){datePartArray[1]=a;b=true;break;}if(!b)datePartArray[8]=false;break;case 'D':case 'DD':case 'DDD':case 'DDDD':if(input!=null)datePartArray[2]=~~input;break;case 'YY':datePartArray[0]=~~input+(~~input>70?1900:2000);break;case 'YYYY':datePartArray[0]=~~Math.abs(input);break;case 'a':case 'A':config.isPm=((input+'').toLowerCase()==='pm');break;case 'H':case 'HH':case 'h':case 'hh':datePartArray[3]=~~input;break;case 'm':case 'mm':datePartArray[4]=~~input;break;case 's':case 'ss':datePartArray[5]=~~input;break;case 'S':case 'SS':case 'SSS':datePartArray[6]=~~(('0.'+input)*1000);break;case 'Z':case 'ZZ':config.isUTC=true;a=(input+'').match(parseTimezoneChunker);if(a&&a[1])config.tzh=~~a[1];if(a&&a[2])config.tzm=~~a[2];if(a&&a[0]==='+'){config.tzh=-config.tzh;config.tzm=-config.tzm;}break;}if(input==null)datePartArray[8]=false;}function makeDateFromStringAndFormat(string,format){var datePartArray=[0,0,1,0,0,0,0],config={tzh:0,tzm:0},tokens=format.match(formattingTokens),i,parsedInput;for(i=0;i<tokens.length;i++){parsedInput=(getParseRegexForToken(tokens[i]).exec(string)||[])[0];if(parsedInput)string=string.slice(string.indexOf(parsedInput)+parsedInput.length);if(formatTokenFunctions[tokens[i]])addTimeToArrayFromToken(tokens[i],parsedInput,datePartArray,config);}if(config.isPm&&datePartArray[3]<12)datePartArray[3]+=12;if(config.isPm===false&&datePartArray[3]===12)datePartArray[3]=0;return dateFromArray(datePartArray,config.isUTC,config.tzh,config.tzm);}function makeDateFromStringAndArray(string,formats){var output,inputParts=string.match(parseMultipleFormatChunker)||[],formattedInputParts,scoreToBeat=99,i,currentDate,currentScore;for(i=0;i<formats.length;i++){currentDate=makeDateFromStringAndFormat(string,formats[i]);formattedInputParts=formatMoment(new Moment(currentDate),formats[i]).match(parseMultipleFormatChunker)||[];currentScore=compareArrays(inputParts,formattedInputParts);if(currentScore<scoreToBeat){scoreToBeat=currentScore;output=currentDate;}}return output;}function makeDateFromString(string){var format='YYYY-MM-DDT',i;if(isoRegex.exec(string)){for(i=0;i<4;i++)if(isoTimes[i][1].exec(string)){format+=isoTimes[i][0];break;}return parseTokenTimezone.exec(string)?makeDateFromStringAndFormat(string,format+' Z'):makeDateFromStringAndFormat(string,format);}return new Date(string);}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){var rt=lang.relativeTime[string];return(typeof rt==='function')?rt(number||1,!!withoutSuffix,string,isFuture):rt.replace(/%d/i,number||1);}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1000),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=seconds<45&&['s',seconds]||minutes===1&&['m']||minutes<45&&['mm',minutes]||hours===1&&['h']||hours<22&&['hh',hours]||days===1&&['d']||days<=25&&['dd',days]||days<=45&&['M']||days<345&&['MM',round(days/30)]||years===1&&['y']||['yy',years];args[2]=withoutSuffix;args[3]=milliseconds>0;args[4]=lang;return substituteTimeAgo.apply({},args);}moment=function(input,format){if(input===null||input==='')return null;var date,matched;if(moment.isMoment(input))return new Moment(new Date(+input._d),input._isUTC,input._lang);else if(format)if(isArray(format))date=makeDateFromStringAndArray(input,format);else date=makeDateFromStringAndFormat(input,format);else{matched=aspNetJsonRegex.exec(input);date=input===undefined?new Date():matched?new Date(+matched[1]):input instanceof Date?input:isArray(input)?dateFromArray(input):typeof input==='string'?makeDateFromString(input):new Date(input);}return new Moment(date);};moment.utc=function(input,format){if(isArray(input))return new Moment(dateFromArray(input,true),true);if(typeof input==='string'&&!parseTokenTimezone.exec(input)){input+=' +0000';if(format)format+=' Z';}return moment(input,format).utc();};moment.unix=function(input){return moment(input*1000);};moment.duration=function(input,key){var isDuration=moment.isDuration(input),isNumber=(typeof input==='number'),duration=(isDuration?input._data:(isNumber?{}:input)),ret;if(isNumber)if(key)duration[key]=input;else duration.milliseconds=input;ret=new Duration(duration);if(isDuration)ret._lang=input._lang;return ret;};moment.humanizeDuration=function(num,type,withSuffix){return moment.duration(num,type===true?null:type).humanize(type===true?true:withSuffix);};moment.version=VERSION;moment.defaultFormat=isoFormat;moment.lang=function(key,values){var i;if(!key)return currentLanguage;if(values||!languages[key])loadLang(key,values);if(languages[key]){for(i=0;i<langConfigProperties.length;i++)moment[langConfigProperties[i]]=languages[key][langConfigProperties[i]];moment.monthsParse=languages[key].monthsParse;currentLanguage=key;}};moment.langData=getLangDefinition;moment.isMoment=function(obj){return obj instanceof Moment;};moment.isDuration=function(obj){return obj instanceof Duration;};moment.lang('en',{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(hours,minutes,isLower){if(hours>11)return isLower?'pm':'PM';else return isLower?'am':'AM';},calendar:{sameDay:'[Today at] LT',nextDay:'[Tomorrow at] LT',nextWeek:'dddd [at] LT',lastDay:'[Yesterday at] LT',lastWeek:'[last] dddd [at] LT',sameElse:'L'},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(number){var b=number%10;return(~~(number%100/10)===1)?'th':(b===1)?'st':(b===2)?'nd':(b===3)?'rd':'th';}});moment.fn=Moment.prototype={clone:function(){return moment(this);},valueOf:function(){return +this._d;},unix:function(){return Math.floor(+this._d/1000);},toString:function(){return this._d.toString();},toDate:function(){return this._d;},toArray:function(){var m=this;return [m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds(),!!this._isUTC];},isValid:function(){if(this._a){if(this._a[8]!=null)return !!this._a[8];return !compareArrays(this._a,(this._a[7]?moment.utc(this._a):moment(this._a)).toArray());}return !isNaN(this._d.getTime());},utc:function(){this._isUTC=true;return this;},local:function(){this._isUTC=false;return this;},format:function(inputString){return formatMoment(this,inputString?inputString:moment.defaultFormat);},add:function(input,val){var dur=val?moment.duration(+val,input):moment.duration(input);addOrSubtractDurationFromMoment(this,dur,1);return this;},subtract:function(input,val){var dur=val?moment.duration(+val,input):moment.duration(input);addOrSubtractDurationFromMoment(this,dur,-1);return this;},diff:function(input,val,asFloat){var inputMoment=this._isUTC?moment(input).utc():moment(input).local(),zoneDiff=(this.zone()-inputMoment.zone())*6e4,diff=this._d-inputMoment._d-zoneDiff,year=this.year()-inputMoment.year(),month=this.month()-inputMoment.month(),date=this.date()-inputMoment.date(),output;if(val==='months')output=year*12+month+date/30;else if(val==='years')output=year+(month+date/30)/12;else output=val==='seconds'?diff/1e3:val==='minutes'?diff/6e4:val==='hours'?diff/36e5:val==='days'?diff/864e5:val==='weeks'?diff/6048e5:diff;return asFloat?output:round(output);},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this._lang).humanize(!withoutSuffix);},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix);},calendar:function(){var diff=this.diff(moment().sod(),'days',true),calendar=this.lang().calendar,allElse=calendar.sameElse,format=diff<-6?allElse:diff<-1?calendar.lastWeek:diff<0?calendar.lastDay:diff<1?calendar.sameDay:diff<2?calendar.nextDay:diff<7?calendar.nextWeek:allElse;return this.format(typeof format==='function'?format.apply(this):format);},isLeapYear:function(){var year=this.year();return(year%4===0&&year%100!==0)||year%400===0;},isDST:function(){return(this.zone()<moment([this.year()]).zone()||this.zone()<moment([this.year(),5]).zone());},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return input==null?day:this.add({d:input-day});},startOf:function(val){switch(val.replace(/s$/,'')){case 'year':this.month(0);case 'month':this.date(1);case 'day':this.hours(0);case 'hour':this.minutes(0);case 'minute':this.seconds(0);case 'second':this.milliseconds(0);}return this;},endOf:function(val){return this.startOf(val).add(val.replace(/s?$/,'s'),1).subtract('ms',1);},sod:function(){return this.clone().startOf('day');},eod:function(){return this.clone().endOf('day');},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset();},daysInMonth:function(){return moment.utc([this.year(),this.month()+1,0]).date();},lang:function(lang){if(lang===undefined)return getLangDefinition(this);else{this._lang=lang;return this;}}};function makeGetterAndSetter(name,key){moment.fn[name]=function(input){var utc=this._isUTC?'UTC':'';if(input!=null){this._d['set'+utc+key](input);return this;}else return this._d['get'+utc+key]();};}for(i=0;i<proxyGettersAndSetters.length;i++)makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase(),proxyGettersAndSetters[i]);makeGetterAndSetter('year','FullYear');moment.duration.fn=Duration.prototype={weeks:function(){return absRound(this.days()/7);},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6;},humanize:function(withSuffix){var difference=+this,rel=this.lang().relativeTime,output=relativeTime(difference,!withSuffix,this.lang()),fromNow=difference<=0?rel.past:rel.future;if(withSuffix)if(typeof fromNow==='function')output=fromNow(output);else output=fromNow.replace(/%s/i,output);return output;},lang:moment.fn.lang};function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name];};}function makeDurationAsGetter(name,factor){moment.duration.fn['as'+name]=function(){return +this/factor;};}for(i in unitMillisecondFactors)if(unitMillisecondFactors.hasOwnProperty(i)){makeDurationAsGetter(i,unitMillisecondFactors[i]);makeDurationGetter(i.toLowerCase());}makeDurationAsGetter('Weeks',6048e5);if(hasModule)module.exports=moment;if(typeof ender==='undefined')this.moment=moment;if(typeof define==="function"&&define.amd)define("moment",[],function(){return moment;});}).call(this);
if(!jQuery)throw new Error("Bootstrap requires jQuery");+function($){"use strict";function transitionEnd(){var el=document.createElement('bootstrap');var transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd otransitionend','transition':'transitionend'};for(var name in transEndEventNames)if(el.style[name]!==undefined)return{end:transEndEventNames[name]};}$.fn.emulateTransitionEnd=function(duration){var called=false,$el=this;$(this).one('webkitTransitionEnd',function(){called=true;});var callback=function(){if(!called)$($el).trigger('webkitTransitionEnd');};setTimeout(callback,duration);return this;};$(function(){$.support.transition=transitionEnd();});}(window.jQuery);+function($){"use strict";var dismiss='[data-dismiss="alert"]';var Alert=function(el){$(el).on('click',dismiss,this.close);};Alert.prototype.close=function(e){var $this=$(this);var selector=$this.attr('data-target');if(!selector){selector=$this.attr('href');selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'');}var $parent=$(selector);if(e)e.preventDefault();if(!$parent.length)$parent=$this.hasClass('alert')?$this:$this.parent();$parent.trigger(e=$.Event('close.bs.alert'));if(e.isDefaultPrevented())return;$parent.removeClass('in');function removeElement(){$parent.trigger('closed.bs.alert').remove();}$.support.transition&&$parent.hasClass('fade')?$parent.one($.support.transition.end,removeElement).emulateTransitionEnd(150):removeElement();};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.alert');if(!data)$this.data('bs.alert',(data=new Alert(this)));if(typeof option=='string')data[option].call($this);});};$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this;};$(document).on('click.bs.alert.data-api',dismiss,Alert.prototype.close);}(window.jQuery);+function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},Button.DEFAULTS,options);};Button.DEFAULTS={loadingText:'loading...'};Button.prototype.setState=function(state){var d='disabled';var $el=this.$element;var val=$el.is('input')?'val':'html';var data=$el.data();state=state+'Text';if(!data.resetText)$el.data('resetText',$el[val]());$el[val](data[state]||this.options[state]);setTimeout(function(){state=='loadingText'?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d);},0);};Button.prototype.toggle=function(){var $parent=this.$element.closest('[data-toggle="buttons"]');if($parent.length){var $input=this.$element.find('input').prop('checked',!this.$element.hasClass('active'));if($input.prop('type')==='radio')$parent.find('.active').removeClass('active');}this.$element.toggleClass('active');};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this);var data=$this.data('button');var options=typeof option=='object'&&option;if(!data)$this.data('bs.button',(data=new Button(this,options)));if(option=='toggle')data.toggle();else if(option)data.setState(option);});};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this;};$(document).on('click.bs.button.data-api','[data-toggle^=button]',function(e){var $btn=$(e.target);if(!$btn.hasClass('btn'))$btn=$btn.closest('.btn');$btn.button('toggle');e.preventDefault();});}(window.jQuery);+function($){"use strict";var Carousel=function(element,options){this.$element=$(element);this.$indicators=this.$element.find('.carousel-indicators');this.options=options;this.paused=this.sliding=this.interval=this.$active=this.$items=null;this.options.pause=='hover'&&this.$element.on('mouseenter',$.proxy(this.pause,this)).on('mouseleave',$.proxy(this.cycle,this));};Carousel.DEFAULTS={interval:5000,pause:'hover'};Carousel.prototype.cycle=function(e){e||(this.paused=false);this.interval&&clearInterval(this.interval);this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval));return this;};Carousel.prototype.getActiveIndex=function(){this.$active=this.$element.find('.item.active');this.$items=this.$active.parent().children();return this.$items.index(this.$active);};Carousel.prototype.to=function(pos){var that=this;var activeIndex=this.getActiveIndex();if(pos>(this.$items.length-1)||pos<0)return;if(this.sliding)return this.$element.one('slid',function(){that.to(pos);});if(activeIndex==pos)return this.pause().cycle();return this.slide(pos>activeIndex?'next':'prev',$(this.$items[pos]));};Carousel.prototype.pause=function(e){e||(this.paused=true);if(this.$element.find('.next, .prev').length&&$.support.transition.end){this.$element.trigger($.support.transition.end);this.cycle(true);}this.interval=clearInterval(this.interval);return this;};Carousel.prototype.next=function(){if(this.sliding)return;return this.slide('next');};Carousel.prototype.prev=function(){if(this.sliding)return;return this.slide('prev');};Carousel.prototype.slide=function(type,next){var $active=this.$element.find('.item.active');var $next=next||$active[type]();var isCycling=this.interval;var direction=type=='next'?'left':'right';var fallback=type=='next'?'first':'last';var that=this;this.sliding=true;isCycling&&this.pause();$next=$next.length?$next:this.$element.find('.item')[fallback]();var e=$.Event('slide.bs.carousel',{relatedTarget:$next[0],direction:direction});if($next.hasClass('active'))return;if(this.$indicators.length){this.$indicators.find('.active').removeClass('active');this.$element.one('slid',function(){var $nextIndicator=$(that.$indicators.children()[that.getActiveIndex()]);$nextIndicator&&$nextIndicator.addClass('active');});}if($.support.transition&&this.$element.hasClass('slide')){this.$element.trigger(e);if(e.isDefaultPrevented())return;$next.addClass(type);$next[0].offsetWidth;$active.addClass(direction);$next.addClass(direction);$active.one($.support.transition.end,function(){$next.removeClass([type,direction].join(' ')).addClass('active');$active.removeClass(['active',direction].join(' '));that.sliding=false;setTimeout(function(){that.$element.trigger('slid');},0);}).emulateTransitionEnd(600);}else{this.$element.trigger(e);if(e.isDefaultPrevented())return;$active.removeClass('active');$next.addClass('active');this.sliding=false;this.$element.trigger('slid');}isCycling&&this.cycle();return this;};var old=$.fn.carousel;$.fn.carousel=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.carousel');var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=='object'&&option);var action=typeof option=='string'?option:options.slide;if(!data)$this.data('bs.carousel',(data=new Carousel(this,options)));if(typeof option=='number')data.to(option);else if(action)data[action]();else if(options.interval)data.pause().cycle();});};$.fn.carousel.Constructor=Carousel;$.fn.carousel.noConflict=function(){$.fn.carousel=old;return this;};$(document).on('click.bs.carousel.data-api','[data-slide], [data-slide-to]',function(e){var $this=$(this),href;var $target=$($this.attr('data-target')||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''));var options=$.extend({},$target.data(),$this.data());var slideIndex=$this.attr('data-slide-to');if(slideIndex)options.interval=false;$target.carousel(options);if(slideIndex=$this.attr('data-slide-to'))$target.data('bs.carousel').to(slideIndex);e.preventDefault();});$(window).on('load',function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this);$carousel.carousel($carousel.data());});});}(window.jQuery);+function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},Collapse.DEFAULTS,options);this.transitioning=null;if(this.options.parent)this.$parent=$(this.options.parent);if(this.options.toggle)this.toggle();};Collapse.DEFAULTS={toggle:true};Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass('width');return hasWidth?'width':'height';};Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass('in'))return;var startEvent=$.Event('show.bs.collapse');this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var actives=this.$parent&&this.$parent.find('> .accordion-group > .in');if(actives&&actives.length){var hasData=actives.data('bs.collapse');if(hasData&&hasData.transitioning)return;actives.collapse('hide');hasData||actives.data('bs.collapse',null);}var dimension=this.dimension();this.$element.removeClass('collapse').addClass('collapsing')[dimension](0);this.transitioning=1;var complete=function(){this.$element.removeClass('collapsing').addClass('in')[dimension]('auto');this.transitioning=0;this.$element.trigger('shown.bs.collapse');};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(['scroll',dimension].join('-'));this.$element.one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize]);};Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass('in'))return;var startEvent=$.Event('hide.bs.collapse');this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight;this.$element.addClass('collapsing').removeClass('collapse').removeClass('in');this.transitioning=1;var complete=function(){this.transitioning=0;this.$element.trigger('hidden.bs.collapse').removeClass('collapsing').addClass('collapse');};if(!$.support.transition)return complete.call(this);this.$element[dimension](0).one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350);};Collapse.prototype.toggle=function(){this[this.$element.hasClass('in')?'hide':'show']();};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.collapse');var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=='object'&&option);if(!data)$this.data('bs.collapse',(data=new Collapse(this,options)));if(typeof option=='string')data[option]();});};$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this;};$(document).on('click.bs.collapse.data-api','[data-toggle=collapse]',function(e){var $this=$(this),href;var target=$this.attr('data-target')||e.preventDefault()||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,'');var $target=$(target);var data=$target.data('bs.collapse');var option=data?'toggle':$this.data();var parent=$this.attr('data-parent');var $parent=parent&&$(parent);if(!data||!data.transitioning){if($parent)$parent.find('[data-toggle=collapse][data-parent='+parent+']').not($this).addClass('collapsed');$this[$target.hasClass('in')?'addClass':'removeClass']('collapsed');}$target.collapse(option);});}(window.jQuery);+function($){"use strict";var backdrop='.dropdown-backdrop';var toggle='[data-toggle=dropdown]';var Dropdown=function(element){var $el=$(element).on('click.bs.dropdown',this.toggle);};Dropdown.prototype.toggle=function(e){var $this=$(this);if($this.is('.disabled, :disabled'))return;var $parent=getParent($this);var isActive=$parent.hasClass('open');clearMenus();if(!isActive){if('ontouchstart' in document.documentElement)$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on('click',clearMenus);$parent.trigger(e=$.Event('show.bs.dropdown'));if(e.isDefaultPrevented())return;$parent.toggleClass('open').trigger('shown.bs.dropdown');}$this.focus();return false;};Dropdown.prototype.keydown=function(e){if(!/(38|40|27)/.test(e.keyCode))return;var $this=$(this);e.preventDefault();e.stopPropagation();if($this.is('.disabled, :disabled'))return;var $parent=getParent($this);var isActive=$parent.hasClass('open');if(!isActive||(isActive&&e.keyCode==27)){if(e.which==27)$parent.find(toggle).focus();return $this.click();}var $items=$('[role=menu] li:not(.divider):visible a',$parent);if(!$items.length)return;var index=$items.index($items.filter(':focus'));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus();};function clearMenus(){$(backdrop).remove();$(toggle).each(function(e){var $parent=getParent($(this));if(!$parent.hasClass('open'))return;$parent.trigger(e=$.Event('hide.bs.dropdown'));if(e.isDefaultPrevented())return;$parent.removeClass('open').trigger('hidden.bs.dropdown');});}function getParent($this){var selector=$this.attr('data-target');if(!selector){selector=$this.attr('href');selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,'');}var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent();}var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this);var data=$this.data('dropdown');if(!data)$this.data('dropdown',(data=new Dropdown(this)));if(typeof option=='string')data[option].call($this);});};$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this;};$(document).on('click.bs.dropdown.data-api',clearMenus).on('click.bs.dropdown.data-api','.dropdown form',function(e){e.stopPropagation();}).on('click.bs.dropdown.data-api',toggle,Dropdown.prototype.toggle).on('keydown.bs.dropdown.data-api',toggle+', [role=menu]',Dropdown.prototype.keydown);}(window.jQuery);+function($){"use strict";var Modal=function(element,options){this.options=options;this.$element=$(element).on('click.dismiss.modal','[data-dismiss="modal"]',$.proxy(this.hide,this));this.$backdrop=this.isShown=null;if(this.options.remote)this.$element.find('.modal-body').load(this.options.remote);};Modal.DEFAULTS={backdrop:true,keyboard:true,show:true};Modal.prototype.toggle=function(){return this[!this.isShown?'show':'hide']();};Modal.prototype.show=function(){var that=this;var e=$.Event('show.bs.modal');this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass('fade');if(!that.$element.parent().length)that.$element.appendTo(document.body);that.$element.show();if(transition)that.$element[0].offsetWidth;that.$element.addClass('in').attr('aria-hidden',false);that.enforceFocus();transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger('shown.bs.modal');}).emulateTransitionEnd(300):that.$element.focus().trigger('shown.bs.modal');});};Modal.prototype.hide=function(e){if(e)e.preventDefault();e=$.Event('hide.bs.modal');this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();$(document).off('focusin.bs.modal');this.$element.removeClass('in').attr('aria-hidden',true);$.support.transition&&this.$element.hasClass('fade')?this.$element.one($.support.transition.end,$.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal();};Modal.prototype.enforceFocus=function(){$(document).off('focusin.bs.modal').on('focusin.bs.modal',$.proxy(function(e){if(this.$element[0]!==e.target&&!this.$element.has(e.target).length)this.$element.focus();},this));};Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard)this.$element.on('keyup.dismiss.bs.modal',$.proxy(function(e){e.which==27&&this.hide();},this));else if(!this.isShown)this.$element.off('keyup.dismiss.bs.modal');};Modal.prototype.hideModal=function(){var that=this;this.$element.hide();this.backdrop(function(){that.removeBackdrop();that.$element.trigger('hidden.bs.modal');});};Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null;};Modal.prototype.backdrop=function(callback){var that=this;var animate=this.$element.hasClass('fade')?'fade':'';if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);this.$element.on('click',$.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=='static'?this.$element[0].focus.call(this.$element[0]):this.hide.call(this);},this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass('in');if(!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback();}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass('in');$.support.transition&&this.$element.hasClass('fade')?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback();}else if(callback)callback();};var old=$.fn.modal;$.fn.modal=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.modal');var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=='object'&&option);if(!data)$this.data('bs.modal',(data=new Modal(this,options)));if(typeof option=='string')data[option]();else if(options.show)data.show();});};$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this;};$(document).on('click.bs.modal.data-api','[data-toggle="modal"]',function(e){var $this=$(this);var href=$this.attr('href');var $target=$($this.attr('data-target')||(href&&href.replace(/.*(?=#[^\s]+$)/,'')));var option=$target.data('modal')?'toggle':$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault();$target.modal(option).one('hide',function(){$this.is(':visible')&&$this.focus();});});var $body=$(document.body).on('shown.bs.modal','.modal',function(){$body.addClass('modal-open');}).on('hidden.bs.modal','.modal',function(){$body.removeClass('modal-open');});}(window.jQuery);+function($){"use strict";var Tooltip=function(element,options){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null;this.init('tooltip',element,options);};Tooltip.DEFAULTS={animation:true,placement:'top',selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:'hover focus',title:'',delay:0,html:false,container:false};Tooltip.prototype.init=function(type,element,options){this.enabled=true;this.type=type;this.$element=$(element);this.options=this.getOptions(options);var triggers=this.options.trigger.split(' ');for(var i=triggers.length;i--;){var trigger=triggers[i];if(trigger=='click')this.$element.on('click.'+this.type,this.options.selector,$.proxy(this.toggle,this));else if(trigger!='manual'){var eventIn=trigger=='hover'?'mouseenter':'focus';var eventOut=trigger=='hover'?'mouseleave':'blur';this.$element.on(eventIn+'.'+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+'.'+this.type,this.options.selector,$.proxy(this.leave,this));}}this.options.selector?(this._options=$.extend({},this.options,{trigger:'manual',selector:''})):this.fixTitle();};Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS;};Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options);if(options.delay&&typeof options.delay=='number')options.delay={show:options.delay,hide:options.delay};return options;};Tooltip.prototype.enter=function(obj){var defaults=this.getDefaults();var options={};this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value;});var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](options).data('bs.'+this.type);clearTimeout(self.timeout);if(!self.options.delay||!self.options.delay.show)return self.show();self.hoverState='in';self.timeout=setTimeout(function(){if(self.hoverState=='in')self.show();},self.options.delay.show);};Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this._options).data('bs.'+this.type);clearTimeout(self.timeout);if(!self.options.delay||!self.options.delay.hide)return self.hide();self.hoverState='out';self.timeout=setTimeout(function(){if(self.hoverState=='out')self.hide();},self.options.delay.hide);};Tooltip.prototype.show=function(){var e=$.Event('show.bs.'+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);if(e.isDefaultPrevented())return;var $tip=this.tip();this.setContent();if(this.options.animation)$tip.addClass('fade');var placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;var autoToken=/\s?auto?\s?/i;var autoPlace=autoToken.test(placement);if(autoPlace)placement=placement.replace(autoToken,'')||'top';$tip.detach().css({top:0,left:0,display:'block'}).addClass(placement);this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);var pos=this.getPosition();var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(autoPlace){var $parent=this.$element.parent();var orgPlacement=placement;var docScroll=document.documentElement.scrollTop||document.body.scrollTop;var parentWidth=this.options.container=='body'?window.innerWidth:$parent.outerWidth();var parentHeight=this.options.container=='body'?window.innerHeight:$parent.outerHeight();var parentLeft=this.options.container=='body'?0:$parent.offset().left;placement=placement=='bottom'&&pos.top+pos.height+actualHeight-docScroll>parentHeight?'top':placement=='top'&&pos.top-docScroll-actualHeight<0?'bottom':placement=='right'&&pos.right+actualWidth>parentWidth?'left':placement=='left'&&pos.left-actualWidth<parentLeft?'right':placement;$tip.removeClass(orgPlacement).addClass(placement);}var tp=placement=='bottom'?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=='top'?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=='left'?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};this.applyPlacement(tp,placement);this.$element.trigger('shown.bs.'+this.type);}};Tooltip.prototype.applyPlacement=function(offset,placement){var replace;var $tip=this.tip();var width=$tip[0].offsetWidth;var height=$tip[0].offsetHeight;offset.top=offset.top+parseInt($tip.css('margin-top'),10);offset.left=offset.left+parseInt($tip.css('margin-left'),10);$tip.offset(offset).addClass('in');var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(placement=='top'&&actualHeight!=height){replace=true;offset.top=offset.top+height-actualHeight;}if(placement=='bottom'||placement=='top'){var delta=0;if(offset.left<0){delta=offset.left*-2;offset.left=0;$tip.offset(offset);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;}this.replaceArrow(delta-width+actualWidth,actualWidth,'left');}else this.replaceArrow(actualHeight-height,actualHeight,'top');if(replace)$tip.offset(offset);};Tooltip.prototype.replaceArrow=function(delta,dimension,position){this.arrow().css(position,delta?(50*(1-delta/dimension)+"%"):'');};Tooltip.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();$tip.find('.tooltip-inner')[this.options.html?'html':'text'](title);$tip.removeClass('fade in top bottom left right');};Tooltip.prototype.hide=function(){var that=this;var $tip=this.tip();var e=$.Event('hide.bs.'+this.type);this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip.removeClass('in');$.support.transition&&this.$tip.hasClass('fade')?$tip.one($.support.transition.end,$tip.detach).emulateTransitionEnd(150):$tip.detach();this.$element.trigger('hidden.bs.'+this.type);return this;};Tooltip.prototype.fixTitle=function(){var $e=this.$element;if($e.attr('title')||typeof ($e.attr('data-original-title'))!='string')$e.attr('data-original-title',$e.attr('title')||'').attr('title','');};Tooltip.prototype.hasContent=function(){return this.getTitle();};Tooltip.prototype.getPosition=function(){var el=this.$element[0];return $.extend({},(typeof el.getBoundingClientRect=='function')?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset());};Tooltip.prototype.getTitle=function(){var title;var $e=this.$element;var o=this.options;title=$e.attr('data-original-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title);return title;};Tooltip.prototype.tip=function(){return this.$tip=this.$tip||$(this.options.template);};Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow");};Tooltip.prototype.validate=function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}};Tooltip.prototype.enable=function(){this.enabled=true;};Tooltip.prototype.disable=function(){this.enabled=false;};Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled;};Tooltip.prototype.toggle=function(e){var self=e?$(e.currentTarget)[this.type](this._options).data('bs.'+this.type):this;self.tip().hasClass('in')?self.leave(self):self.enter(self);};Tooltip.prototype.destroy=function(){this.hide().$element.off('.'+this.type).removeData('bs.'+this.type);};var old=$.fn.tooltip;$.fn.tooltip=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.tooltip');var options=typeof option=='object'&&option;if(!data)$this.data('bs.tooltip',(data=new Tooltip(this,options)));if(typeof option=='string')data[option]();});};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this;};}(window.jQuery);+function($){"use strict";var Popover=function(element,options){this.init('popover',element,options);};if(!$.fn.tooltip)throw new Error('Popover requires tooltip.js');Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:'right',trigger:'click',content:'',template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype);Popover.prototype.constructor=Popover;Popover.prototype.getDefaults=function(){return Popover.DEFAULTS;};Popover.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();var content=this.getContent();$tip.find('.popover-title')[this.options.html?'html':'text'](title);$tip.find('.popover-content')[this.options.html?'html':'text'](content);$tip.removeClass('fade top bottom left right in');$tip.find('.popover-title:empty').hide();};Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent();};Popover.prototype.getContent=function(){var $e=this.$element;var o=this.options;return $e.attr('data-content')||(typeof o.content=='function'?o.content.call($e[0]):o.content);};Popover.prototype.tip=function(){if(!this.$tip)this.$tip=$(this.options.template);return this.$tip;};Popover.prototype.destroy=function(){this.hide().$element.off('.'+this.type).removeData(this.type);};var old=$.fn.popover;$.fn.popover=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.popover');var options=typeof option=='object'&&option;if(!data)$this.data('bs.popover',(data=new Popover(this,options)));if(typeof option=='string')data[option]();});};$.fn.popover.Constructor=Popover;$.fn.popover.noConflict=function(){$.fn.popover=old;return this;};}(window.jQuery);+function($){"use strict";function ScrollSpy(element,options){var href;var process=$.proxy(this.process,this);this.$element=$(element).is('body')?$(window):$(element);this.$body=$('body');this.$scrollElement=this.$element.on('scroll.bs.scroll-spy.data-api',process);this.options=$.extend({},ScrollSpy.DEFAULTS,options);this.selector=(this.options.target||((href=$(element).attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''))||'')+' .nav li > a';this.offsets=$([]);this.targets=$([]);this.activeTarget=null;this.refresh();this.process();}ScrollSpy.DEFAULTS={offset:10};ScrollSpy.prototype.refresh=function(){var offsetMethod=this.$element[0]==window?'offset':'position';this.offsets=$([]);this.targets=$([]);var self=this;var $targets=this.$body.find(this.selector).map(function(){var $el=$(this);var href=$el.data('target')||$el.attr('href');var $href=/^#\w/.test(href)&&$(href);return($href&&$href.length&&[[$href[offsetMethod]().top+(!$.isWindow(self.$scrollElement.get(0))&&self.$scrollElement.scrollTop()),href]])||null;}).sort(function(a,b){return a[0]-b[0];}).each(function(){self.offsets.push(this[0]);self.targets.push(this[1]);});};ScrollSpy.prototype.process=function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset;var scrollHeight=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight;var maxScroll=scrollHeight-this.$scrollElement.height();var offsets=this.offsets;var targets=this.targets;var activeTarget=this.activeTarget;var i;if(scrollTop>=maxScroll)return activeTarget!=(i=targets.last()[0])&&this.activate(i);for(i=offsets.length;i--;)activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(!offsets[i+1]||scrollTop<=offsets[i+1])&&this.activate(targets[i]);};ScrollSpy.prototype.activate=function(target){this.activeTarget=target;$(this.selector).parents('.active').removeClass('active');var selector=this.selector+'[data-target="'+target+'"],'+this.selector+'[href="'+target+'"]';var active=$(selector).parents('li').addClass('active');if(active.parent('.dropdown-menu').length)active=active.closest('li.dropdown').addClass('active');active.trigger('activate');};var old=$.fn.scrollspy;$.fn.scrollspy=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.scrollspy');var options=typeof option=='object'&&option;if(!data)$this.data('bs.scrollspy',(data=new ScrollSpy(this,options)));if(typeof option=='string')data[option]();});};$.fn.scrollspy.Constructor=ScrollSpy;$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old;return this;};$(window).on('load',function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this);$spy.scrollspy($spy.data());});});}(window.jQuery);+function($){"use strict";var Tab=function(element){this.element=$(element);};Tab.prototype.show=function(){var $this=this.element;var $ul=$this.closest('ul:not(.dropdown-menu)');var selector=$this.attr('data-target');if(!selector){selector=$this.attr('href');selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'');}if($this.parent('li').hasClass('active'))return;var previous=$ul.find('.active:last a')[0];var e=$.Event('show.bs.tab',{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;var $target=$(selector);this.activate($this.parent('li'),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:'shown.bs.tab',relatedTarget:previous});});};Tab.prototype.activate=function(element,container,callback){var $active=container.find('> .active');var transition=callback&&$.support.transition&&$active.hasClass('fade');function next(){$active.removeClass('active').find('> .dropdown-menu > .active').removeClass('active');element.addClass('active');if(transition){element[0].offsetWidth;element.addClass('in');}else element.removeClass('fade');if(element.parent('.dropdown-menu'))element.closest('li.dropdown').addClass('active');callback&&callback();}transition?$active.one($.support.transition.end,next).emulateTransitionEnd(150):next();$active.removeClass('in');};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.tab');if(!data)$this.data('bs.tab',(data=new Tab(this)));if(typeof option=='string')data[option]();});};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this;};$(document).on('click.bs.tab.data-api','[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab('show');});}(window.jQuery);+function($){"use strict";var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options);this.$window=$(window).on('scroll.bs.affix.data-api',$.proxy(this.checkPosition,this)).on('click.bs.affix.data-api',$.proxy(this.checkPositionWithEventLoop,this));this.$element=$(element);this.affixed=this.unpin=null;this.checkPosition();};Affix.RESET='affix affix-top affix-bottom';Affix.DEFAULTS={offset:0};Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1);};Affix.prototype.checkPosition=function(){if(!this.$element.is(':visible'))return;var scrollHeight=$(document).height();var scrollTop=this.$window.scrollTop();var position=this.$element.offset();var offset=this.options.offset;var offsetTop=offset.top;var offsetBottom=offset.bottom;if(typeof offset!='object')offsetBottom=offsetTop=offset;if(typeof offsetTop=='function')offsetTop=offset.top();if(typeof offsetBottom=='function')offsetBottom=offset.bottom();var affix=this.unpin!=null&&(scrollTop+this.unpin<=position.top)?false:offsetBottom!=null&&(position.top+this.$element.height()>=scrollHeight-offsetBottom)?'bottom':offsetTop!=null&&(scrollTop<=offsetTop)?'top':false;if(this.affixed===affix)return;if(this.unpin)this.$element.css('top','');this.affixed=affix;this.unpin=affix=='bottom'?position.top-scrollTop:null;this.$element.removeClass(Affix.RESET).addClass('affix'+(affix?'-'+affix:''));if(affix=='bottom')this.$element.offset({top:document.body.offsetHeight-offsetBottom-this.$element.height()});};var old=$.fn.affix;$.fn.affix=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.affix');var options=typeof option=='object'&&option;if(!data)$this.data('bs.affix',(data=new Affix(this,options)));if(typeof option=='string')data[option]();});};$.fn.affix.Constructor=Affix;$.fn.affix.noConflict=function(){$.fn.affix=old;return this;};$(window).on('load',function(){$('[data-spy="affix"]').each(function(){var $spy=$(this);var data=$spy.data();data.offset=data.offset||{};if(data.offsetBottom)data.offset.bottom=data.offsetBottom;if(data.offsetTop)data.offset.top=data.offsetTop;$spy.affix(data);});});}(window.jQuery);
;(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'");}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t);},u,u.exports);}return t[n].exports;}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i;})({1:[function(require,module,exports){require('./leaflet');require('./mapbox');},{"./leaflet":2,"./mapbox":3}],3:[function(require,module,exports){window.L.Icon.Default.imagePath='http://api.tiles.mapbox.com/mapbox.js/'+'v'+require('./package.json').version+'/images';L.mapbox=module.exports={VERSION:require('./package.json').version,geocoder:require('./src/geocoder'),marker:require('./src/marker'),tileLayer:require('./src/tile_layer'),shareControl:require('./src/share_control'),legendControl:require('./src/legend_control'),geocoderControl:require('./src/geocoder_control'),gridControl:require('./src/grid_control'),gridLayer:require('./src/grid_layer'),markerLayer:require('./src/marker_layer'),map:require('./src/map'),config:require('./src/config')};},{"./package.json":4,"./src/geocoder":5,"./src/marker":6,"./src/tile_layer":7,"./src/share_control":8,"./src/legend_control":9,"./src/geocoder_control":10,"./src/grid_control":11,"./src/grid_layer":12,"./src/marker_layer":13,"./src/map":14,"./src/config":15}],2:[function(require,module,exports){window.L=require('leaflet/dist/leaflet-src');},{"leaflet/dist/leaflet-src":16}],4:[function(require,module,exports){module.exports={"author":"MapBox","name":"mapbox.js","description":"mapbox javascript api","version":"1.1.0","homepage":"http://mapbox.com/","repository":{"type":"git","url":"git://github.com/mapbox/mapbox.js.git"},"main":"index.js","dependencies":{"leaflet":"0.6.1","mustache":"~0.7.2","corslite":"0.0.3","json3":"~3.2.5"},"scripts":{"test":"mocha-phantomjs test/index.html"},"devDependencies":{"leaflet-hash":"git://github.com/mlevans/leaflet-hash.git#b039a3aa4e2492a5c7448075172ac26769e601d6","leaflet-fullscreen":"0.0.0","uglify-js":"~2.2.5","mocha":"~1.9","expect.js":"~0.2.0","sinon":"~1.6.0","mocha-phantomjs":"~1.1.1","happen":"~0.1.2","browserify":"~2.22.0"},"optionalDependencies":{},"engines":{"node":"*"}};},{}],15:[function(require,module,exports){'use strict';module.exports={HTTP_URLS:['http://a.tiles.mapbox.com/v3/','http://b.tiles.mapbox.com/v3/','http://c.tiles.mapbox.com/v3/','http://d.tiles.mapbox.com/v3/'],FORCE_HTTPS:false,HTTPS_URLS:['https://a.tiles.mapbox.com/v3/','https://b.tiles.mapbox.com/v3/','https://c.tiles.mapbox.com/v3/','https://d.tiles.mapbox.com/v3/']};},{}],16:[function(require,module,exports){(function(){(function(window,document,undefined){var oldL=window.L,L={};L.version='0.6.1';if(typeof module==='object'&&typeof module.exports==='object')module.exports=L;else if(typeof define==='function'&&define.amd)define(L);L.noConflict=function(){window.L=oldL;return this;};window.L=L;L.Util={extend:function(dest){var sources=Array.prototype.slice.call(arguments,1),i,j,len,src;for(j=0,len=sources.length;j<len;j++){src=sources[j]||{};for(i in src)if(src.hasOwnProperty(i))dest[i]=src[i];}return dest;},bind:function(fn,obj){var args=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return fn.apply(obj,args||arguments);};},stamp:(function(){var lastId=0,key='_leaflet_id';return function(obj){obj[key]=obj[key]||++lastId;return obj[key];};}()),invokeEach:function(obj,method,context){var i,args;if(typeof obj==='object'){args=Array.prototype.slice.call(arguments,3);for(i in obj)method.apply(context,[i,obj[i]].concat(args));return true;}return false;},limitExecByInterval:function(fn,time,context){var lock,execOnUnlock;return function wrapperFn(){var args=arguments;if(lock){execOnUnlock=true;return;}lock=true;setTimeout(function(){lock=false;if(execOnUnlock){wrapperFn.apply(context,args);execOnUnlock=false;}},time);fn.apply(context,args);};},falseFn:function(){return false;},formatNum:function(num,digits){var pow=Math.pow(10,digits||5);return Math.round(num*pow)/pow;},trim:function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,'');},splitWords:function(str){return L.Util.trim(str).split(/\s+/);},setOptions:function(obj,options){obj.options=L.extend({},obj.options,options);return obj.options;},getParamString:function(obj,existingUrl,uppercase){var params=[];for(var i in obj)params.push(encodeURIComponent(uppercase?i.toUpperCase():i)+'='+encodeURIComponent(obj[i]));return((!existingUrl||existingUrl.indexOf('?')===-1)?'?':'&')+params.join('&');},template:function(str,data){return str.replace(/\{ *([\w_]+) *\}/g,function(str,key){var value=data[key];if(value===undefined)throw new Error('No value provided for variable '+str);else if(typeof value==='function')value=value(data);return value;});},isArray:function(obj){return(Object.prototype.toString.call(obj)==='[object Array]');},emptyImageUrl:'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='};(function(){function getPrefixed(name){var i,fn,prefixes=['webkit','moz','o','ms'];for(i=0;i<prefixes.length&&!fn;i++)fn=window[prefixes[i]+name];return fn;}var lastTime=0;function timeoutDefer(fn){var time=+new Date(),timeToCall=Math.max(0,16-(time-lastTime));lastTime=time+timeToCall;return window.setTimeout(fn,timeToCall);}var requestFn=window.requestAnimationFrame||getPrefixed('RequestAnimationFrame')||timeoutDefer;var cancelFn=window.cancelAnimationFrame||getPrefixed('CancelAnimationFrame')||getPrefixed('CancelRequestAnimationFrame')||function(id){window.clearTimeout(id);};L.Util.requestAnimFrame=function(fn,context,immediate,element){fn=L.bind(fn,context);if(immediate&&requestFn===timeoutDefer)fn();else return requestFn.call(window,fn,element);};L.Util.cancelAnimFrame=function(id){if(id)cancelFn.call(window,id);};}());L.extend=L.Util.extend;L.bind=L.Util.bind;L.stamp=L.Util.stamp;L.setOptions=L.Util.setOptions;L.Class=function(){};L.Class.extend=function(props){var NewClass=function(){if(this.initialize)this.initialize.apply(this,arguments);if(this._initHooks)this.callInitHooks();};var F=function(){};F.prototype=this.prototype;var proto=new F();proto.constructor=NewClass;NewClass.prototype=proto;for(var i in this)if(this.hasOwnProperty(i)&&i!=='prototype')NewClass[i]=this[i];if(props.statics){L.extend(NewClass,props.statics);delete props.statics;}if(props.includes){L.Util.extend.apply(null,[proto].concat(props.includes));delete props.includes;}if(props.options&&proto.options)props.options=L.extend({},proto.options,props.options);L.extend(proto,props);proto._initHooks=[];var parent=this;NewClass.__super__=parent.prototype;proto.callInitHooks=function(){if(this._initHooksCalled)return;if(parent.prototype.callInitHooks)parent.prototype.callInitHooks.call(this);this._initHooksCalled=true;for(var i=0,len=proto._initHooks.length;i<len;i++)proto._initHooks[i].call(this);};return NewClass;};L.Class.include=function(props){L.extend(this.prototype,props);};L.Class.mergeOptions=function(options){L.extend(this.prototype.options,options);};L.Class.addInitHook=function(fn){var args=Array.prototype.slice.call(arguments,1);var init=typeof fn==='function'?fn:function(){this[fn].apply(this,args);};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(init);};var eventsKey='_leaflet_events';L.Mixin={};L.Mixin.Events={addEventListener:function(types,fn,context){if(L.Util.invokeEach(types,this.addEventListener,this,fn,context))return this;var events=this[eventsKey]=this[eventsKey]||{},contextId=context&&L.stamp(context),i,len,event,type,indexKey,indexLenKey,typeIndex;types=L.Util.splitWords(types);for(i=0,len=types.length;i<len;i++){event={action:fn,context:context||this};type=types[i];if(context){indexKey=type+'_idx';indexLenKey=indexKey+'_len';typeIndex=events[indexKey]=events[indexKey]||{};if(!typeIndex[contextId]){typeIndex[contextId]=[];events[indexLenKey]=(events[indexLenKey]||0)+1;}typeIndex[contextId].push(event);}else{events[type]=events[type]||[];events[type].push(event);}}return this;},hasEventListeners:function(type){var events=this[eventsKey];return !!events&&((type in events&&events[type].length>0)||(type+'_idx' in events&&events[type+'_idx_len']>0));},removeEventListener:function(types,fn,context){if(!this[eventsKey])return this;if(!types)return this.clearAllEventListeners();if(L.Util.invokeEach(types,this.removeEventListener,this,fn,context))return this;var events=this[eventsKey],contextId=context&&L.stamp(context),i,len,type,listeners,j,indexKey,indexLenKey,typeIndex,removed;types=L.Util.splitWords(types);for(i=0,len=types.length;i<len;i++){type=types[i];indexKey=type+'_idx';indexLenKey=indexKey+'_len';typeIndex=events[indexKey];if(!fn){delete events[type];delete events[indexKey];}else{listeners=context&&typeIndex?typeIndex[contextId]:events[type];if(listeners){for(j=listeners.length-1;j>=0;j--)if((listeners[j].action===fn)&&(!context||(listeners[j].context===context))){removed=listeners.splice(j,1);removed[0].action=L.Util.falseFn;}if(context&&typeIndex&&(listeners.length===0)){delete typeIndex[contextId];events[indexLenKey]--;}}}}return this;},clearAllEventListeners:function(){delete this[eventsKey];return this;},fireEvent:function(type,data){if(!this.hasEventListeners(type))return this;var event=L.Util.extend({},data,{type:type,target:this});var events=this[eventsKey],listeners,i,len,typeIndex,contextId;if(events[type]){listeners=events[type].slice();for(i=0,len=listeners.length;i<len;i++)listeners[i].action.call(listeners[i].context||this,event);}typeIndex=events[type+'_idx'];for(contextId in typeIndex){listeners=typeIndex[contextId].slice();if(listeners)for(i=0,len=listeners.length;i<len;i++)listeners[i].action.call(listeners[i].context||this,event);}return this;},addOneTimeEventListener:function(types,fn,context){if(L.Util.invokeEach(types,this.addOneTimeEventListener,this,fn,context))return this;var handler=L.bind(function(){this.removeEventListener(types,fn,context).removeEventListener(types,handler,context);},this);return this.addEventListener(types,fn,context).addEventListener(types,handler,context);}};L.Mixin.Events.on=L.Mixin.Events.addEventListener;L.Mixin.Events.off=L.Mixin.Events.removeEventListener;L.Mixin.Events.once=L.Mixin.Events.addOneTimeEventListener;L.Mixin.Events.fire=L.Mixin.Events.fireEvent;(function(){var ie=!!window.ActiveXObject,ie6=ie&&!window.XMLHttpRequest,ie7=ie&&!document.querySelector,ielt9=ie&&!document.addEventListener,ua=navigator.userAgent.toLowerCase(),webkit=ua.indexOf('webkit')!==-1,chrome=ua.indexOf('chrome')!==-1,phantomjs=ua.indexOf('phantom')!==-1,android=ua.indexOf('android')!==-1,android23=ua.search('android [23]')!==-1,mobile=typeof orientation!==undefined+'',msTouch=window.navigator&&window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints,retina=('devicePixelRatio' in window&&window.devicePixelRatio>1)||('matchMedia' in window&&window.matchMedia('(min-resolution:144dpi)')&&window.matchMedia('(min-resolution:144dpi)').matches),doc=document.documentElement,ie3d=ie&&('transition' in doc.style),webkit3d=('WebKitCSSMatrix' in window)&&('m11' in new window.WebKitCSSMatrix()),gecko3d='MozPerspective' in doc.style,opera3d='OTransition' in doc.style,any3d=!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d||opera3d)&&!phantomjs;var touch=!window.L_NO_TOUCH&&!phantomjs&&(function(){var startName='ontouchstart';if(msTouch||(startName in doc))return true;var div=document.createElement('div'),supported=false;if(!div.setAttribute)return false;div.setAttribute(startName,'return;');if(typeof div[startName]==='function')supported=true;div.removeAttribute(startName);div=null;return supported;}());L.Browser={ie:ie,ie6:ie6,ie7:ie7,ielt9:ielt9,webkit:webkit,android:android,android23:android23,chrome:chrome,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,opera3d:opera3d,any3d:any3d,mobile:mobile,mobileWebkit:mobile&&webkit,mobileWebkit3d:mobile&&webkit3d,mobileOpera:mobile&&window.opera,touch:touch,msTouch:msTouch,retina:retina};}());L.Point=function(x,y,round){this.x=(round?Math.round(x):x);this.y=(round?Math.round(y):y);};L.Point.prototype={clone:function(){return new L.Point(this.x,this.y);},add:function(point){return this.clone()._add(L.point(point));},_add:function(point){this.x+=point.x;this.y+=point.y;return this;},subtract:function(point){return this.clone()._subtract(L.point(point));},_subtract:function(point){this.x-=point.x;this.y-=point.y;return this;},divideBy:function(num){return this.clone()._divideBy(num);},_divideBy:function(num){this.x/=num;this.y/=num;return this;},multiplyBy:function(num){return this.clone()._multiplyBy(num);},_multiplyBy:function(num){this.x*=num;this.y*=num;return this;},round:function(){return this.clone()._round();},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this;},floor:function(){return this.clone()._floor();},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this;},distanceTo:function(point){point=L.point(point);var x=point.x-this.x,y=point.y-this.y;return Math.sqrt(x*x+y*y);},equals:function(point){point=L.point(point);return point.x===this.x&&point.y===this.y;},contains:function(point){point=L.point(point);return Math.abs(point.x)<=Math.abs(this.x)&&Math.abs(point.y)<=Math.abs(this.y);},toString:function(){return 'Point('+L.Util.formatNum(this.x)+', '+L.Util.formatNum(this.y)+')';}};L.point=function(x,y,round){if(x instanceof L.Point)return x;if(L.Util.isArray(x))return new L.Point(x[0],x[1]);if(x===undefined||x===null)return x;return new L.Point(x,y,round);};L.Bounds=function(a,b){if(!a)return;var points=b?[a,b]:a;for(var i=0,len=points.length;i<len;i++)this.extend(points[i]);};L.Bounds.prototype={extend:function(point){point=L.point(point);if(!this.min&&!this.max){this.min=point.clone();this.max=point.clone();}else{this.min.x=Math.min(point.x,this.min.x);this.max.x=Math.max(point.x,this.max.x);this.min.y=Math.min(point.y,this.min.y);this.max.y=Math.max(point.y,this.max.y);}return this;},getCenter:function(round){return new L.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,round);},getBottomLeft:function(){return new L.Point(this.min.x,this.max.y);},getTopRight:function(){return new L.Point(this.max.x,this.min.y);},getSize:function(){return this.max.subtract(this.min);},contains:function(obj){var min,max;if(typeof obj[0]==='number'||obj instanceof L.Point)obj=L.point(obj);else obj=L.bounds(obj);if(obj instanceof L.Bounds){min=obj.min;max=obj.max;}else min=max=obj;return(min.x>=this.min.x)&&(max.x<=this.max.x)&&(min.y>=this.min.y)&&(max.y<=this.max.y);},intersects:function(bounds){bounds=L.bounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xIntersects=(max2.x>=min.x)&&(min2.x<=max.x),yIntersects=(max2.y>=min.y)&&(min2.y<=max.y);return xIntersects&&yIntersects;},isValid:function(){return !!(this.min&&this.max);}};L.bounds=function(a,b){if(!a||a instanceof L.Bounds)return a;return new L.Bounds(a,b);};L.Transformation=function(a,b,c,d){this._a=a;this._b=b;this._c=c;this._d=d;};L.Transformation.prototype={transform:function(point,scale){return this._transform(point.clone(),scale);},_transform:function(point,scale){scale=scale||1;point.x=scale*(this._a*point.x+this._b);point.y=scale*(this._c*point.y+this._d);return point;},untransform:function(point,scale){scale=scale||1;return new L.Point((point.x/scale-this._b)/this._a,(point.y/scale-this._d)/this._c);}};L.DomUtil={get:function(id){return(typeof id==='string'?document.getElementById(id):id);},getStyle:function(el,style){var value=el.style[style];if(!value&&el.currentStyle)value=el.currentStyle[style];if((!value||value==='auto')&&document.defaultView){var css=document.defaultView.getComputedStyle(el,null);value=css?css[style]:null;}return value==='auto'?null:value;},getViewportOffset:function(element){var top=0,left=0,el=element,docBody=document.body,docEl=document.documentElement,pos,ie7=L.Browser.ie7;do{top+=el.offsetTop||0;left+=el.offsetLeft||0;top+=parseInt(L.DomUtil.getStyle(el,'borderTopWidth'),10)||0;left+=parseInt(L.DomUtil.getStyle(el,'borderLeftWidth'),10)||0;pos=L.DomUtil.getStyle(el,'position');if(el.offsetParent===docBody&&pos==='absolute')break;if(pos==='fixed'){top+=docBody.scrollTop||docEl.scrollTop||0;left+=docBody.scrollLeft||docEl.scrollLeft||0;break;}if(pos==='relative'&&!el.offsetLeft){var width=L.DomUtil.getStyle(el,'width'),maxWidth=L.DomUtil.getStyle(el,'max-width'),r=el.getBoundingClientRect();if(width!=='none'||maxWidth!=='none')left+=r.left+el.clientLeft;top+=r.top+(docBody.scrollTop||docEl.scrollTop||0);break;}el=el.offsetParent;}while(el);el=element;do{if(el===docBody)break;top-=el.scrollTop||0;left-=el.scrollLeft||0;if(!L.DomUtil.documentIsLtr()&&(L.Browser.webkit||ie7)){left+=el.scrollWidth-el.clientWidth;if(ie7&&L.DomUtil.getStyle(el,'overflow-y')!=='hidden'&&L.DomUtil.getStyle(el,'overflow')!=='hidden')left+=17;}el=el.parentNode;}while(el);return new L.Point(left,top);},documentIsLtr:function(){if(!L.DomUtil._docIsLtrCached){L.DomUtil._docIsLtrCached=true;L.DomUtil._docIsLtr=L.DomUtil.getStyle(document.body,'direction')==='ltr';}return L.DomUtil._docIsLtr;},create:function(tagName,className,container){var el=document.createElement(tagName);el.className=className;if(container)container.appendChild(el);return el;},hasClass:function(el,name){return(el.className.length>0)&&new RegExp('(^|\\s)'+name+'(\\s|$)').test(el.className);},addClass:function(el,name){if(!L.DomUtil.hasClass(el,name))el.className+=(el.className?' ':'')+name;},removeClass:function(el,name){el.className=L.Util.trim((' '+el.className+' ').replace(' '+name+' ',' '));},setOpacity:function(el,value){if('opacity' in el.style)el.style.opacity=value;else if('filter' in el.style){var filter=false,filterName='DXImageTransform.Microsoft.Alpha';try{filter=el.filters.item(filterName);}catch(e){if(value===1)return;}value=Math.round(value*100);if(filter){filter.Enabled=(value!==100);filter.Opacity=value;}else el.style.filter+=' progid:'+filterName+'(opacity='+value+')';}},testProp:function(props){var style=document.documentElement.style;for(var i=0;i<props.length;i++)if(props[i] in style)return props[i];return false;},getTranslateString:function(point){var is3d=L.Browser.webkit3d,open='translate'+(is3d?'3d':'')+'(',close=(is3d?',0':'')+')';return open+point.x+'px,'+point.y+'px'+close;},getScaleString:function(scale,origin){var preTranslateStr=L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1*scale))),scaleStr=' scale('+scale+') ';return preTranslateStr+scaleStr;},setPosition:function(el,point,disable3D){el._leaflet_pos=point;if(!disable3D&&L.Browser.any3d){el.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(point);if(L.Browser.mobileWebkit3d)el.style.WebkitBackfaceVisibility='hidden';}else{el.style.left=point.x+'px';el.style.top=point.y+'px';}},getPosition:function(el){return el._leaflet_pos;}};L.DomUtil.TRANSFORM=L.DomUtil.testProp(['transform','WebkitTransform','OTransform','MozTransform','msTransform']);L.DomUtil.TRANSITION=L.DomUtil.testProp(['webkitTransition','transition','OTransition','MozTransition','msTransition']);L.DomUtil.TRANSITION_END=L.DomUtil.TRANSITION==='webkitTransition'||L.DomUtil.TRANSITION==='OTransition'?L.DomUtil.TRANSITION+'End':'transitionend';(function(){var userSelectProperty=L.DomUtil.testProp(['userSelect','WebkitUserSelect','OUserSelect','MozUserSelect','msUserSelect']);var userDragProperty=L.DomUtil.testProp(['userDrag','WebkitUserDrag','OUserDrag','MozUserDrag','msUserDrag']);L.extend(L.DomUtil,{disableTextSelection:function(){if(userSelectProperty){var style=document.documentElement.style;this._userSelect=style[userSelectProperty];style[userSelectProperty]='none';}else L.DomEvent.on(window,'selectstart',L.DomEvent.stop);},enableTextSelection:function(){if(userSelectProperty){document.documentElement.style[userSelectProperty]=this._userSelect;delete this._userSelect;}else L.DomEvent.off(window,'selectstart',L.DomEvent.stop);},disableImageDrag:function(){if(userDragProperty){var style=document.documentElement.style;this._userDrag=style[userDragProperty];style[userDragProperty]='none';}else L.DomEvent.on(window,'dragstart',L.DomEvent.stop);},enableImageDrag:function(){if(userDragProperty){document.documentElement.style[userDragProperty]=this._userDrag;delete this._userDrag;}else L.DomEvent.off(window,'dragstart',L.DomEvent.stop);}});})();L.LatLng=function(rawLat,rawLng){var lat=parseFloat(rawLat),lng=parseFloat(rawLng);if(isNaN(lat)||isNaN(lng))throw new Error('Invalid LatLng object: ('+rawLat+', '+rawLng+')');this.lat=lat;this.lng=lng;};L.extend(L.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1.0E-9});L.LatLng.prototype={equals:function(obj){if(!obj)return false;obj=L.latLng(obj);var margin=Math.max(Math.abs(this.lat-obj.lat),Math.abs(this.lng-obj.lng));return margin<=L.LatLng.MAX_MARGIN;},toString:function(precision){return 'LatLng('+L.Util.formatNum(this.lat,precision)+', '+L.Util.formatNum(this.lng,precision)+')';},distanceTo:function(other){other=L.latLng(other);var R=6378137,d2r=L.LatLng.DEG_TO_RAD,dLat=(other.lat-this.lat)*d2r,dLon=(other.lng-this.lng)*d2r,lat1=this.lat*d2r,lat2=other.lat*d2r,sin1=Math.sin(dLat/2),sin2=Math.sin(dLon/2);var a=sin1*sin1+sin2*sin2*Math.cos(lat1)*Math.cos(lat2);return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));},wrap:function(a,b){var lng=this.lng;a=a||-180;b=b||180;lng=(lng+b)%(b-a)+(lng<a||lng===b?b:a);return new L.LatLng(this.lat,lng);}};L.latLng=function(a,b){if(a instanceof L.LatLng)return a;if(L.Util.isArray(a))return new L.LatLng(a[0],a[1]);if(a===undefined||a===null)return a;if(typeof a==='object'&&'lat' in a)return new L.LatLng(a.lat,'lng' in a?a.lng:a.lon);return new L.LatLng(a,b);};L.LatLngBounds=function(southWest,northEast){if(!southWest)return;var latlngs=northEast?[southWest,northEast]:southWest;for(var i=0,len=latlngs.length;i<len;i++)this.extend(latlngs[i]);};L.LatLngBounds.prototype={extend:function(obj){if(!obj)return this;if(typeof obj[0]==='number'||typeof obj[0]==='string'||obj instanceof L.LatLng)obj=L.latLng(obj);else obj=L.latLngBounds(obj);if(obj instanceof L.LatLng)if(!this._southWest&&!this._northEast){this._southWest=new L.LatLng(obj.lat,obj.lng);this._northEast=new L.LatLng(obj.lat,obj.lng);}else{this._southWest.lat=Math.min(obj.lat,this._southWest.lat);this._southWest.lng=Math.min(obj.lng,this._southWest.lng);this._northEast.lat=Math.max(obj.lat,this._northEast.lat);this._northEast.lng=Math.max(obj.lng,this._northEast.lng);}else if(obj instanceof L.LatLngBounds){this.extend(obj._southWest);this.extend(obj._northEast);}return this;},pad:function(bufferRatio){var sw=this._southWest,ne=this._northEast,heightBuffer=Math.abs(sw.lat-ne.lat)*bufferRatio,widthBuffer=Math.abs(sw.lng-ne.lng)*bufferRatio;return new L.LatLngBounds(new L.LatLng(sw.lat-heightBuffer,sw.lng-widthBuffer),new L.LatLng(ne.lat+heightBuffer,ne.lng+widthBuffer));},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2);},getSouthWest:function(){return this._southWest;},getNorthEast:function(){return this._northEast;},getNorthWest:function(){return new L.LatLng(this.getNorth(),this.getWest());},getSouthEast:function(){return new L.LatLng(this.getSouth(),this.getEast());},getWest:function(){return this._southWest.lng;},getSouth:function(){return this._southWest.lat;},getEast:function(){return this._northEast.lng;},getNorth:function(){return this._northEast.lat;},contains:function(obj){if(typeof obj[0]==='number'||obj instanceof L.LatLng)obj=L.latLng(obj);else obj=L.latLngBounds(obj);var sw=this._southWest,ne=this._northEast,sw2,ne2;if(obj instanceof L.LatLngBounds){sw2=obj.getSouthWest();ne2=obj.getNorthEast();}else sw2=ne2=obj;return(sw2.lat>=sw.lat)&&(ne2.lat<=ne.lat)&&(sw2.lng>=sw.lng)&&(ne2.lng<=ne.lng);},intersects:function(bounds){bounds=L.latLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latIntersects=(ne2.lat>=sw.lat)&&(sw2.lat<=ne.lat),lngIntersects=(ne2.lng>=sw.lng)&&(sw2.lng<=ne.lng);return latIntersects&&lngIntersects;},toBBoxString:function(){return [this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(',');},equals:function(bounds){if(!bounds)return false;bounds=L.latLngBounds(bounds);return this._southWest.equals(bounds.getSouthWest())&&this._northEast.equals(bounds.getNorthEast());},isValid:function(){return !!(this._southWest&&this._northEast);}};L.latLngBounds=function(a,b){if(!a||a instanceof L.LatLngBounds)return a;return new L.LatLngBounds(a,b);};L.Projection={};L.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(latlng){var d=L.LatLng.DEG_TO_RAD,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),x=latlng.lng*d,y=lat*d;y=Math.log(Math.tan((Math.PI/4)+(y/2)));return new L.Point(x,y);},unproject:function(point){var d=L.LatLng.RAD_TO_DEG,lng=point.x*d,lat=(2*Math.atan(Math.exp(point.y))-(Math.PI/2))*d;return new L.LatLng(lat,lng);}};L.Projection.LonLat={project:function(latlng){return new L.Point(latlng.lng,latlng.lat);},unproject:function(point){return new L.LatLng(point.y,point.x);}};L.CRS={latLngToPoint:function(latlng,zoom){var projectedPoint=this.projection.project(latlng),scale=this.scale(zoom);return this.transformation._transform(projectedPoint,scale);},pointToLatLng:function(point,zoom){var scale=this.scale(zoom),untransformedPoint=this.transformation.untransform(point,scale);return this.projection.unproject(untransformedPoint);},project:function(latlng){return this.projection.project(latlng);},scale:function(zoom){return 256*Math.pow(2,zoom);}};L.CRS.Simple=L.extend({},L.CRS,{projection:L.Projection.LonLat,transformation:new L.Transformation(1,0,-1,0),scale:function(zoom){return Math.pow(2,zoom);}});L.CRS.EPSG3857=L.extend({},L.CRS,{code:'EPSG:3857',projection:L.Projection.SphericalMercator,transformation:new L.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(latlng){var projectedPoint=this.projection.project(latlng),earthRadius=6378137;return projectedPoint.multiplyBy(earthRadius);}});L.CRS.EPSG900913=L.extend({},L.CRS.EPSG3857,{code:'EPSG:900913'});L.CRS.EPSG4326=L.extend({},L.CRS,{code:'EPSG:4326',projection:L.Projection.LonLat,transformation:new L.Transformation(1/360,0.5,-1/360,0.5)});L.Map=L.Class.extend({includes:L.Mixin.Events,options:{crs:L.CRS.EPSG3857,fadeAnimation:L.DomUtil.TRANSITION&&!L.Browser.android23,trackResize:true,markerZoomAnimation:L.DomUtil.TRANSITION&&L.Browser.any3d},initialize:function(id,options){options=L.setOptions(this,options);this._initContainer(id);this._initLayout();this._initEvents();if(options.maxBounds)this.setMaxBounds(options.maxBounds);if(options.center&&options.zoom!==undefined)this.setView(L.latLng(options.center),options.zoom,{reset:true});this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(options.layers);},setView:function(center,zoom){this._resetView(L.latLng(center),this._limitZoom(zoom));return this;},setZoom:function(zoom,options){return this.setView(this.getCenter(),zoom,{zoom:options});},zoomIn:function(delta,options){return this.setZoom(this._zoom+(delta||1),options);},zoomOut:function(delta,options){return this.setZoom(this._zoom-(delta||1),options);},setZoomAround:function(latlng,zoom,options){var scale=this.getZoomScale(zoom),viewHalf=this.getSize().divideBy(2),containerPoint=latlng instanceof L.Point?latlng:this.latLngToContainerPoint(latlng),centerOffset=containerPoint.subtract(viewHalf).multiplyBy(1-1/scale),newCenter=this.containerPointToLatLng(viewHalf.add(centerOffset));return this.setView(newCenter,zoom,{zoom:options});},fitBounds:function(bounds,options){options=options||{};bounds=bounds.getBounds?bounds.getBounds():L.latLngBounds(bounds);var paddingTL=L.point(options.paddingTopLeft||options.padding||[0,0]),paddingBR=L.point(options.paddingBottomRight||options.padding||[0,0]),zoom=this.getBoundsZoom(bounds,false,paddingTL.add(paddingBR)),paddingOffset=paddingBR.subtract(paddingTL).divideBy(2),swPoint=this.project(bounds.getSouthWest(),zoom),nePoint=this.project(bounds.getNorthEast(),zoom),center=this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset),zoom);return this.setView(center,zoom,options);},fitWorld:function(options){return this.fitBounds([[-90,-180],[90,180]],options);},panTo:function(center,options){return this.setView(center,this._zoom,{pan:options});},panBy:function(offset){this.fire('movestart');this._rawPanBy(L.point(offset));this.fire('move');return this.fire('moveend');},setMaxBounds:function(bounds){bounds=L.latLngBounds(bounds);this.options.maxBounds=bounds;if(!bounds){this._boundsMinZoom=null;this.off('moveend',this._panInsideMaxBounds,this);return this;}var minZoom=this.getBoundsZoom(bounds,true);this._boundsMinZoom=minZoom;if(this._loaded)if(this._zoom<minZoom)this.setView(bounds.getCenter(),minZoom);else this.panInsideBounds(bounds);this.on('moveend',this._panInsideMaxBounds,this);return this;},panInsideBounds:function(bounds){bounds=L.latLngBounds(bounds);var viewBounds=this.getPixelBounds(),viewSw=viewBounds.getBottomLeft(),viewNe=viewBounds.getTopRight(),sw=this.project(bounds.getSouthWest()),ne=this.project(bounds.getNorthEast()),dx=0,dy=0;if(viewNe.y<ne.y)dy=Math.ceil(ne.y-viewNe.y);if(viewNe.x>ne.x)dx=Math.floor(ne.x-viewNe.x);if(viewSw.y>sw.y)dy=Math.floor(sw.y-viewSw.y);if(viewSw.x<sw.x)dx=Math.ceil(sw.x-viewSw.x);if(dx||dy)return this.panBy([dx,dy]);return this;},addLayer:function(layer){var id=L.stamp(layer);if(this._layers[id])return this;this._layers[id]=layer;if(layer.options&&(!isNaN(layer.options.maxZoom)||!isNaN(layer.options.minZoom))){this._zoomBoundLayers[id]=layer;this._updateZoomLevels();}if(this.options.zoomAnimation&&L.TileLayer&&(layer instanceof L.TileLayer)){this._tileLayersNum++;this._tileLayersToLoad++;layer.on('load',this._onTileLayerLoad,this);}if(this._loaded)this._layerAdd(layer);return this;},removeLayer:function(layer){var id=L.stamp(layer);if(!this._layers[id])return;if(this._loaded){layer.onRemove(this);this.fire('layerremove',{layer:layer});}delete this._layers[id];if(this._zoomBoundLayers[id]){delete this._zoomBoundLayers[id];this._updateZoomLevels();}if(this.options.zoomAnimation&&L.TileLayer&&(layer instanceof L.TileLayer)){this._tileLayersNum--;this._tileLayersToLoad--;layer.off('load',this._onTileLayerLoad,this);}return this;},hasLayer:function(layer){if(!layer)return false;return(L.stamp(layer) in this._layers);},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this;},invalidateSize:function(options){options=L.extend({animate:false,pan:true},options===true?{animate:true}:options);var oldSize=this.getSize();this._sizeChanged=true;if(this.options.maxBounds)this.setMaxBounds(this.options.maxBounds);if(!this._loaded)return this;var newSize=this.getSize(),offset=oldSize.subtract(newSize).divideBy(2).round();if(!offset.x&&!offset.y)return this;if(options.animate&&options.pan)this.panBy(offset);else{if(options.pan)this._rawPanBy(offset);this.fire('move');clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(L.bind(this.fire,this,'moveend'),200);}return this.fire('resize',{oldSize:oldSize,newSize:newSize});},addHandler:function(name,HandlerClass){if(!HandlerClass)return;var handler=this[name]=new HandlerClass(this);this._handlers.push(handler);if(this.options[name])handler.enable();return this;},remove:function(){if(this._loaded)this.fire('unload');this._initEvents('off');delete this._container._leaflet;this._clearPanes();if(this._clearControlPos)this._clearControlPos();this._clearHandlers();return this;},getCenter:function(){this._checkIfLoaded();if(!this._moved())return this._initialCenter;return this.layerPointToLatLng(this._getCenterLayerPoint());},getZoom:function(){return this._zoom;},getBounds:function(){var bounds=this.getPixelBounds(),sw=this.unproject(bounds.getBottomLeft()),ne=this.unproject(bounds.getTopRight());return new L.LatLngBounds(sw,ne);},getMinZoom:function(){var z1=this.options.minZoom||0,z2=this._layersMinZoom||0,z3=this._boundsMinZoom||0;return Math.max(z1,z2,z3);},getMaxZoom:function(){var z1=this.options.maxZoom===undefined?Infinity:this.options.maxZoom,z2=this._layersMaxZoom===undefined?Infinity:this._layersMaxZoom;return Math.min(z1,z2);},getBoundsZoom:function(bounds,inside,padding){bounds=L.latLngBounds(bounds);var zoom=this.getMinZoom()-(inside?1:0),maxZoom=this.getMaxZoom(),size=this.getSize(),nw=bounds.getNorthWest(),se=bounds.getSouthEast(),zoomNotFound=true,boundsSize;padding=L.point(padding||[0,0]);do{zoom++;boundsSize=this.project(se,zoom).subtract(this.project(nw,zoom)).add(padding);zoomNotFound=!inside?size.contains(boundsSize):boundsSize.x<size.x||boundsSize.y<size.y;}while(zoomNotFound&&zoom<=maxZoom);if(zoomNotFound&&inside)return null;return inside?zoom:zoom-1;},getSize:function(){if(!this._size||this._sizeChanged){this._size=new L.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=false;}return this._size.clone();},getPixelBounds:function(){var topLeftPoint=this._getTopLeftPoint();return new L.Bounds(topLeftPoint,topLeftPoint.add(this.getSize()));},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint;},getPanes:function(){return this._panes;},getContainer:function(){return this._container;},getZoomScale:function(toZoom){var crs=this.options.crs;return crs.scale(toZoom)/crs.scale(this._zoom);},getScaleZoom:function(scale){return this._zoom+(Math.log(scale)/Math.LN2);},project:function(latlng,zoom){zoom=zoom===undefined?this._zoom:zoom;return this.options.crs.latLngToPoint(L.latLng(latlng),zoom);},unproject:function(point,zoom){zoom=zoom===undefined?this._zoom:zoom;return this.options.crs.pointToLatLng(L.point(point),zoom);},layerPointToLatLng:function(point){var projectedPoint=L.point(point).add(this.getPixelOrigin());return this.unproject(projectedPoint);},latLngToLayerPoint:function(latlng){var projectedPoint=this.project(L.latLng(latlng))._round();return projectedPoint._subtract(this.getPixelOrigin());},containerPointToLayerPoint:function(point){return L.point(point).subtract(this._getMapPanePos());},layerPointToContainerPoint:function(point){return L.point(point).add(this._getMapPanePos());},containerPointToLatLng:function(point){var layerPoint=this.containerPointToLayerPoint(L.point(point));return this.layerPointToLatLng(layerPoint);},latLngToContainerPoint:function(latlng){return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));},mouseEventToContainerPoint:function(e){return L.DomEvent.getMousePosition(e,this._container);},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e));},_initContainer:function(id){var container=this._container=L.DomUtil.get(id);if(!container)throw new Error('Map container not found.');else if(container._leaflet)throw new Error('Map container is already initialized.');container._leaflet=true;},_initLayout:function(){var container=this._container;L.DomUtil.addClass(container,'leaflet-container'+(L.Browser.touch?' leaflet-touch':'')+(L.Browser.retina?' leaflet-retina':'')+(this.options.fadeAnimation?' leaflet-fade-anim':''));var position=L.DomUtil.getStyle(container,'position');if(position!=='absolute'&&position!=='relative'&&position!=='fixed')container.style.position='relative';this._initPanes();if(this._initControlPos)this._initControlPos();},_initPanes:function(){var panes=this._panes={};this._mapPane=panes.mapPane=this._createPane('leaflet-map-pane',this._container);this._tilePane=panes.tilePane=this._createPane('leaflet-tile-pane',this._mapPane);panes.objectsPane=this._createPane('leaflet-objects-pane',this._mapPane);panes.shadowPane=this._createPane('leaflet-shadow-pane');panes.overlayPane=this._createPane('leaflet-overlay-pane');panes.markerPane=this._createPane('leaflet-marker-pane');panes.popupPane=this._createPane('leaflet-popup-pane');var zoomHide=' leaflet-zoom-hide';if(!this.options.markerZoomAnimation){L.DomUtil.addClass(panes.markerPane,zoomHide);L.DomUtil.addClass(panes.shadowPane,zoomHide);L.DomUtil.addClass(panes.popupPane,zoomHide);}},_createPane:function(className,container){return L.DomUtil.create('div',className,container||this._panes.objectsPane);},_clearPanes:function(){this._container.removeChild(this._mapPane);},_addLayers:function(layers){layers=layers?(L.Util.isArray(layers)?layers:[layers]):[];for(var i=0,len=layers.length;i<len;i++)this.addLayer(layers[i]);},_resetView:function(center,zoom,preserveMapOffset,afterZoomAnim){var zoomChanged=(this._zoom!==zoom);if(!afterZoomAnim){this.fire('movestart');if(zoomChanged)this.fire('zoomstart');}this._zoom=zoom;this._initialCenter=center;this._initialTopLeftPoint=this._getNewTopLeftPoint(center);if(!preserveMapOffset)L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));else this._initialTopLeftPoint._add(this._getMapPanePos());this._tileLayersToLoad=this._tileLayersNum;var loading=!this._loaded;this._loaded=true;if(loading){this.fire('load');this.eachLayer(this._layerAdd,this);}this.fire('viewreset',{hard:!preserveMapOffset});this.fire('move');if(zoomChanged||afterZoomAnim)this.fire('zoomend');this.fire('moveend',{hard:!preserveMapOffset});},_rawPanBy:function(offset){L.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(offset));},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom();},_updateZoomLevels:function(){var i,minZoom=Infinity,maxZoom=-Infinity,oldZoomSpan=this._getZoomSpan();for(i in this._zoomBoundLayers){var layer=this._zoomBoundLayers[i];if(!isNaN(layer.options.minZoom))minZoom=Math.min(minZoom,layer.options.minZoom);if(!isNaN(layer.options.maxZoom))maxZoom=Math.max(maxZoom,layer.options.maxZoom);}if(i===undefined)this._layersMaxZoom=this._layersMinZoom=undefined;else{this._layersMaxZoom=maxZoom;this._layersMinZoom=minZoom;}if(oldZoomSpan!==this._getZoomSpan())this.fire('zoomlevelschange');},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds);},_checkIfLoaded:function(){if(!this._loaded)throw new Error('Set map center and zoom first.');},_initEvents:function(onOff){if(!L.DomEvent)return;onOff=onOff||'on';L.DomEvent[onOff](this._container,'click',this._onMouseClick,this);var events=['dblclick','mousedown','mouseup','mouseenter','mouseleave','mousemove','contextmenu'],i,len;for(i=0,len=events.length;i<len;i++)L.DomEvent[onOff](this._container,events[i],this._fireMouseEvent,this);if(this.options.trackResize)L.DomEvent[onOff](window,'resize',this._onResize,this);},_onResize:function(){L.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=L.Util.requestAnimFrame(this.invalidateSize,this,false,this._container);},_onMouseClick:function(e){if(!this._loaded||(!e._simulated&&this.dragging&&this.dragging.moved())||e._leaflet_stop)return;this.fire('preclick');this._fireMouseEvent(e);},_fireMouseEvent:function(e){if(!this._loaded||e._leaflet_stop)return;var type=e.type;type=(type==='mouseenter'?'mouseover':(type==='mouseleave'?'mouseout':type));if(!this.hasEventListeners(type))return;if(type==='contextmenu')L.DomEvent.preventDefault(e);var containerPoint=this.mouseEventToContainerPoint(e),layerPoint=this.containerPointToLayerPoint(containerPoint),latlng=this.layerPointToLatLng(layerPoint);this.fire(type,{latlng:latlng,layerPoint:layerPoint,containerPoint:containerPoint,originalEvent:e});},_onTileLayerLoad:function(){this._tileLayersToLoad--;if(this._tileLayersNum&&!this._tileLayersToLoad)this.fire('tilelayersload');},_clearHandlers:function(){for(var i=0,len=this._handlers.length;i<len;i++)this._handlers[i].disable();},whenReady:function(callback,context){if(this._loaded)callback.call(context||this,this);else this.on('load',callback,context);return this;},_layerAdd:function(layer){layer.onAdd(this);this.fire('layeradd',{layer:layer});},_getMapPanePos:function(){return L.DomUtil.getPosition(this._mapPane);},_moved:function(){var pos=this._getMapPanePos();return pos&&!pos.equals([0,0]);},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos());},_getNewTopLeftPoint:function(center,zoom){var viewHalf=this.getSize()._divideBy(2);return this.project(center,zoom)._subtract(viewHalf)._round();},_latLngToNewLayerPoint:function(latlng,newZoom,newCenter){var topLeft=this._getNewTopLeftPoint(newCenter,newZoom).add(this._getMapPanePos());return this.project(latlng,newZoom)._subtract(topLeft);},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2));},_getCenterOffset:function(latlng){return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());},_limitZoom:function(zoom){var min=this.getMinZoom(),max=this.getMaxZoom();return Math.max(min,Math.min(max,zoom));}});L.map=function(id,options){return new L.Map(id,options);};L.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(latlng){var d=L.LatLng.DEG_TO_RAD,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),r=this.R_MAJOR,r2=this.R_MINOR,x=latlng.lng*d*r,y=lat*d,tmp=r2/r,eccent=Math.sqrt(1.0-tmp*tmp),con=eccent*Math.sin(y);con=Math.pow((1-con)/(1+con),eccent*0.5);var ts=Math.tan(0.5*((Math.PI*0.5)-y))/con;y=-r*Math.log(ts);return new L.Point(x,y);},unproject:function(point){var d=L.LatLng.RAD_TO_DEG,r=this.R_MAJOR,r2=this.R_MINOR,lng=point.x*d/r,tmp=r2/r,eccent=Math.sqrt(1-(tmp*tmp)),ts=Math.exp(-point.y/r),phi=(Math.PI/2)-2*Math.atan(ts),numIter=15,tol=1e-7,i=numIter,dphi=0.1,con;while((Math.abs(dphi)>tol)&&(--i>0)){con=eccent*Math.sin(phi);dphi=(Math.PI/2)-2*Math.atan(ts*Math.pow((1.0-con)/(1.0+con),0.5*eccent))-phi;phi+=dphi;}return new L.LatLng(phi*d,lng);}};L.CRS.EPSG3395=L.extend({},L.CRS,{code:'EPSG:3395',projection:L.Projection.Mercator,transformation:(function(){var m=L.Projection.Mercator,r=m.R_MAJOR,r2=m.R_MINOR;return new L.Transformation(0.5/(Math.PI*r),0.5,-0.5/(Math.PI*r2),0.5);}())});L.TileLayer=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:'abc',errorTileUrl:'',attribution:'',zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(url,options){options=L.setOptions(this,options);if(options.detectRetina&&L.Browser.retina&&options.maxZoom>0){options.tileSize=Math.floor(options.tileSize/2);options.zoomOffset++;if(options.minZoom>0)options.minZoom--;this.options.maxZoom--;}if(options.bounds)options.bounds=L.latLngBounds(options.bounds);this._url=url;var subdomains=this.options.subdomains;if(typeof subdomains==='string')this.options.subdomains=subdomains.split('');},onAdd:function(map){this._map=map;this._animated=map._zoomAnimated;this._initContainer();this._createTileProto();map.on({'viewreset':this._reset,'moveend':this._update},this);if(this._animated)map.on({'zoomanim':this._animateZoom,'zoomend':this._endZoomAnim},this);if(!this.options.updateWhenIdle){this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);map.on('move',this._limitedUpdate,this);}this._reset();this._update();},addTo:function(map){map.addLayer(this);return this;},onRemove:function(map){this._container.parentNode.removeChild(this._container);map.off({'viewreset':this._reset,'moveend':this._update},this);if(this._animated)map.off({'zoomanim':this._animateZoom,'zoomend':this._endZoomAnim},this);if(!this.options.updateWhenIdle)map.off('move',this._limitedUpdate,this);this._container=null;this._map=null;},bringToFront:function(){var pane=this._map._panes.tilePane;if(this._container){pane.appendChild(this._container);this._setAutoZIndex(pane,Math.max);}return this;},bringToBack:function(){var pane=this._map._panes.tilePane;if(this._container){pane.insertBefore(this._container,pane.firstChild);this._setAutoZIndex(pane,Math.min);}return this;},getAttribution:function(){return this.options.attribution;},getContainer:function(){return this._container;},setOpacity:function(opacity){this.options.opacity=opacity;if(this._map)this._updateOpacity();return this;},setZIndex:function(zIndex){this.options.zIndex=zIndex;this._updateZIndex();return this;},setUrl:function(url,noRedraw){this._url=url;if(!noRedraw)this.redraw();return this;},redraw:function(){if(this._map){this._reset({hard:true});this._update();}return this;},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined)this._container.style.zIndex=this.options.zIndex;},_setAutoZIndex:function(pane,compare){var layers=pane.children,edgeZIndex=-compare(Infinity,-Infinity),zIndex,i,len;for(i=0,len=layers.length;i<len;i++)if(layers[i]!==this._container){zIndex=parseInt(layers[i].style.zIndex,10);if(!isNaN(zIndex))edgeZIndex=compare(edgeZIndex,zIndex);}this.options.zIndex=this._container.style.zIndex=(isFinite(edgeZIndex)?edgeZIndex:0)+compare(1,-1);},_updateOpacity:function(){var i,tiles=this._tiles;if(L.Browser.ielt9)for(i in tiles)L.DomUtil.setOpacity(tiles[i],this.options.opacity);else L.DomUtil.setOpacity(this._container,this.options.opacity);},_initContainer:function(){var tilePane=this._map._panes.tilePane;if(!this._container){this._container=L.DomUtil.create('div','leaflet-layer');this._updateZIndex();if(this._animated){var className='leaflet-tile-container leaflet-zoom-animated';this._bgBuffer=L.DomUtil.create('div',className,this._container);this._bgBuffer.style.zIndex=1;this._tileContainer=L.DomUtil.create('div',className,this._container);this._tileContainer.style.zIndex=2;}else this._tileContainer=this._container;tilePane.appendChild(this._container);if(this.options.opacity<1)this._updateOpacity();}},_reset:function(e){for(var key in this._tiles)this.fire('tileunload',{tile:this._tiles[key]});this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles)this._unusedTiles=[];this._tileContainer.innerHTML='';if(this._animated&&e&&e.hard)this._clearBgBuffer();this._initContainer();},_update:function(){if(!this._map)return;var bounds=this._map.getPixelBounds(),zoom=this._map.getZoom(),tileSize=this.options.tileSize;if(zoom>this.options.maxZoom||zoom<this.options.minZoom)return;var tileBounds=L.bounds(bounds.min.divideBy(tileSize)._floor(),bounds.max.divideBy(tileSize)._floor());this._addTilesFromCenterOut(tileBounds);if(this.options.unloadInvisibleTiles||this.options.reuseTiles)this._removeOtherTiles(tileBounds);},_addTilesFromCenterOut:function(bounds){var queue=[],center=bounds.getCenter();var j,i,point;for(j=bounds.min.y;j<=bounds.max.y;j++)for(i=bounds.min.x;i<=bounds.max.x;i++){point=new L.Point(i,j);if(this._tileShouldBeLoaded(point))queue.push(point);}var tilesToLoad=queue.length;if(tilesToLoad===0)return;queue.sort(function(a,b){return a.distanceTo(center)-b.distanceTo(center);});var fragment=document.createDocumentFragment();if(!this._tilesToLoad)this.fire('loading');this._tilesToLoad+=tilesToLoad;for(i=0;i<tilesToLoad;i++)this._addTile(queue[i],fragment);this._tileContainer.appendChild(fragment);},_tileShouldBeLoaded:function(tilePoint){if((tilePoint.x+':'+tilePoint.y) in this._tiles)return false;var options=this.options;if(!options.continuousWorld){var limit=this._getWrapTileNum();if((options.noWrap&&(tilePoint.x<0||tilePoint.x>=limit))||tilePoint.y<0||tilePoint.y>=limit)return false;}if(options.bounds){var tileSize=options.tileSize,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add([tileSize,tileSize]),nw=this._map.unproject(nwPoint),se=this._map.unproject(sePoint);if(!options.continuousWorld&&!options.noWrap){nw=nw.wrap();se=se.wrap();}if(!options.bounds.intersects([nw,se]))return false;}return true;},_removeOtherTiles:function(bounds){var kArr,x,y,key;for(key in this._tiles){kArr=key.split(':');x=parseInt(kArr[0],10);y=parseInt(kArr[1],10);if(x<bounds.min.x||x>bounds.max.x||y<bounds.min.y||y>bounds.max.y)this._removeTile(key);}},_removeTile:function(key){var tile=this._tiles[key];this.fire('tileunload',{tile:tile,url:tile.src});if(this.options.reuseTiles){L.DomUtil.removeClass(tile,'leaflet-tile-loaded');this._unusedTiles.push(tile);}else if(tile.parentNode===this._tileContainer)this._tileContainer.removeChild(tile);if(!L.Browser.android){tile.onload=null;tile.src=L.Util.emptyImageUrl;}delete this._tiles[key];},_addTile:function(tilePoint,container){var tilePos=this._getTilePos(tilePoint);var tile=this._getTile();L.DomUtil.setPosition(tile,tilePos,L.Browser.chrome||L.Browser.android23);this._tiles[tilePoint.x+':'+tilePoint.y]=tile;this._loadTile(tile,tilePoint);if(tile.parentNode!==this._tileContainer)container.appendChild(tile);},_getZoomForUrl:function(){var options=this.options,zoom=this._map.getZoom();if(options.zoomReverse)zoom=options.maxZoom-zoom;return zoom+options.zoomOffset;},_getTilePos:function(tilePoint){var origin=this._map.getPixelOrigin(),tileSize=this.options.tileSize;return tilePoint.multiplyBy(tileSize).subtract(origin);},getTileUrl:function(tilePoint){return L.Util.template(this._url,L.extend({s:this._getSubdomain(tilePoint),z:tilePoint.z,x:tilePoint.x,y:tilePoint.y},this.options));},_getWrapTileNum:function(){return Math.pow(2,this._getZoomForUrl());},_adjustTilePoint:function(tilePoint){var limit=this._getWrapTileNum();if(!this.options.continuousWorld&&!this.options.noWrap)tilePoint.x=((tilePoint.x%limit)+limit)%limit;if(this.options.tms)tilePoint.y=limit-tilePoint.y-1;tilePoint.z=this._getZoomForUrl();},_getSubdomain:function(tilePoint){var index=Math.abs(tilePoint.x+tilePoint.y)%this.options.subdomains.length;return this.options.subdomains[index];},_createTileProto:function(){var img=this._tileImg=L.DomUtil.create('img','leaflet-tile');img.style.width=img.style.height=this.options.tileSize+'px';img.galleryimg='no';},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var tile=this._unusedTiles.pop();this._resetTile(tile);return tile;}return this._createTile();},_resetTile:function(){},_createTile:function(){var tile=this._tileImg.cloneNode(false);tile.onselectstart=tile.onmousemove=L.Util.falseFn;if(L.Browser.ielt9&&this.options.opacity!==undefined)L.DomUtil.setOpacity(tile,this.options.opacity);return tile;},_loadTile:function(tile,tilePoint){tile._layer=this;tile.onload=this._tileOnLoad;tile.onerror=this._tileOnError;this._adjustTilePoint(tilePoint);tile.src=this.getTileUrl(tilePoint);},_tileLoaded:function(){this._tilesToLoad--;if(!this._tilesToLoad){this.fire('load');if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(L.bind(this._clearBgBuffer,this),500);}}},_tileOnLoad:function(){var layer=this._layer;if(this.src!==L.Util.emptyImageUrl){L.DomUtil.addClass(this,'leaflet-tile-loaded');layer.fire('tileload',{tile:this,url:this.src});}layer._tileLoaded();},_tileOnError:function(){var layer=this._layer;layer.fire('tileerror',{tile:this,url:this.src});var newUrl=layer.options.errorTileUrl;if(newUrl)this.src=newUrl;layer._tileLoaded();}});L.tileLayer=function(url,options){return new L.TileLayer(url,options);};L.TileLayer.WMS=L.TileLayer.extend({defaultWmsParams:{service:'WMS',request:'GetMap',version:'1.1.1',layers:'',styles:'',format:'image/jpeg',transparent:false},initialize:function(url,options){this._url=url;var wmsParams=L.extend({},this.defaultWmsParams),tileSize=options.tileSize||this.options.tileSize;if(options.detectRetina&&L.Browser.retina)wmsParams.width=wmsParams.height=tileSize*2;else wmsParams.width=wmsParams.height=tileSize;for(var i in options)if(!this.options.hasOwnProperty(i)&&i!=='crs')wmsParams[i]=options[i];this.wmsParams=wmsParams;L.setOptions(this,options);},onAdd:function(map){this._crs=this.options.crs||map.options.crs;var projectionKey=parseFloat(this.wmsParams.version)>=1.3?'crs':'srs';this.wmsParams[projectionKey]=this._crs.code;L.TileLayer.prototype.onAdd.call(this,map);},getTileUrl:function(tilePoint,zoom){var map=this._map,tileSize=this.options.tileSize,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add([tileSize,tileSize]),nw=this._crs.project(map.unproject(nwPoint,zoom)),se=this._crs.project(map.unproject(sePoint,zoom)),bbox=[nw.x,se.y,se.x,nw.y].join(','),url=L.Util.template(this._url,{s:this._getSubdomain(tilePoint)});return url+L.Util.getParamString(this.wmsParams,url,true)+'&BBOX='+bbox;},setParams:function(params,noRedraw){L.extend(this.wmsParams,params);if(!noRedraw)this.redraw();return this;}});L.tileLayer.wms=function(url,options){return new L.TileLayer.WMS(url,options);};L.TileLayer.Canvas=L.TileLayer.extend({options:{async:false},initialize:function(options){L.setOptions(this,options);},redraw:function(){for(var i in this._tiles)this._redrawTile(this._tiles[i]);return this;},_redrawTile:function(tile){this.drawTile(tile,tile._tilePoint,this._map._zoom);},_createTileProto:function(){var proto=this._canvasProto=L.DomUtil.create('canvas','leaflet-tile');proto.width=proto.height=this.options.tileSize;},_createTile:function(){var tile=this._canvasProto.cloneNode(false);tile.onselectstart=tile.onmousemove=L.Util.falseFn;return tile;},_loadTile:function(tile,tilePoint){tile._layer=this;tile._tilePoint=tilePoint;this._redrawTile(tile);if(!this.options.async)this.tileDrawn(tile);},drawTile:function(){},tileDrawn:function(tile){this._tileOnLoad.call(tile);}});L.tileLayer.canvas=function(options){return new L.TileLayer.Canvas(options);};L.ImageOverlay=L.Class.extend({includes:L.Mixin.Events,options:{opacity:1},initialize:function(url,bounds,options){this._url=url;this._bounds=L.latLngBounds(bounds);L.setOptions(this,options);},onAdd:function(map){this._map=map;if(!this._image)this._initImage();map._panes.overlayPane.appendChild(this._image);map.on('viewreset',this._reset,this);if(map.options.zoomAnimation&&L.Browser.any3d)map.on('zoomanim',this._animateZoom,this);this._reset();},onRemove:function(map){map.getPanes().overlayPane.removeChild(this._image);map.off('viewreset',this._reset,this);if(map.options.zoomAnimation)map.off('zoomanim',this._animateZoom,this);},addTo:function(map){map.addLayer(this);return this;},setOpacity:function(opacity){this.options.opacity=opacity;this._updateOpacity();return this;},bringToFront:function(){if(this._image)this._map._panes.overlayPane.appendChild(this._image);return this;},bringToBack:function(){var pane=this._map._panes.overlayPane;if(this._image)pane.insertBefore(this._image,pane.firstChild);return this;},_initImage:function(){this._image=L.DomUtil.create('img','leaflet-image-layer');if(this._map.options.zoomAnimation&&L.Browser.any3d)L.DomUtil.addClass(this._image,'leaflet-zoom-animated');else L.DomUtil.addClass(this._image,'leaflet-zoom-hide');this._updateOpacity();L.extend(this._image,{galleryimg:'no',onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.bind(this._onImageLoad,this),src:this._url});},_animateZoom:function(e){var map=this._map,image=this._image,scale=map.getZoomScale(e.zoom),nw=this._bounds.getNorthWest(),se=this._bounds.getSouthEast(),topLeft=map._latLngToNewLayerPoint(nw,e.zoom,e.center),size=map._latLngToNewLayerPoint(se,e.zoom,e.center)._subtract(topLeft),origin=topLeft._add(size._multiplyBy((1/2)*(1-1/scale)));image.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(origin)+' scale('+scale+') ';},_reset:function(){var image=this._image,topLeft=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),size=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);L.DomUtil.setPosition(image,topLeft);image.style.width=size.x+'px';image.style.height=size.y+'px';},_onImageLoad:function(){this.fire('load');},_updateOpacity:function(){L.DomUtil.setOpacity(this._image,this.options.opacity);}});L.imageOverlay=function(url,bounds,options){return new L.ImageOverlay(url,bounds,options);};L.Icon=L.Class.extend({options:{className:''},initialize:function(options){L.setOptions(this,options);},createIcon:function(oldIcon){return this._createIcon('icon',oldIcon);},createShadow:function(oldIcon){return this._createIcon('shadow',oldIcon);},_createIcon:function(name,oldIcon){var src=this._getIconUrl(name);if(!src){if(name==='icon')throw new Error('iconUrl not set in Icon options (see the docs).');return null;}var img;if(!oldIcon||oldIcon.tagName!=='IMG')img=this._createImg(src);else img=this._createImg(src,oldIcon);this._setIconStyles(img,name);return img;},_setIconStyles:function(img,name){var options=this.options,size=L.point(options[name+'Size']),anchor;if(name==='shadow')anchor=L.point(options.shadowAnchor||options.iconAnchor);else anchor=L.point(options.iconAnchor);if(!anchor&&size)anchor=size.divideBy(2,true);img.className='leaflet-marker-'+name+' '+options.className;if(anchor){img.style.marginLeft=(-anchor.x)+'px';img.style.marginTop=(-anchor.y)+'px';}if(size){img.style.width=size.x+'px';img.style.height=size.y+'px';}},_createImg:function(src,el){if(!L.Browser.ie6){if(!el)el=document.createElement('img');el.src=src;}else{if(!el)el=document.createElement('div');el.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+src+'")';}return el;},_getIconUrl:function(name){if(L.Browser.retina&&this.options[name+'RetinaUrl'])return this.options[name+'RetinaUrl'];return this.options[name+'Url'];}});L.icon=function(options){return new L.Icon(options);};L.Icon.Default=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(name){var key=name+'Url';if(this.options[key])return this.options[key];if(L.Browser.retina&&name==='icon')name+='-2x';var path=L.Icon.Default.imagePath;if(!path)throw new Error('Couldn\'t autodetect L.Icon.Default.imagePath, set it manually.');return path+'/marker-'+name+'.png';}});L.Icon.Default.imagePath=(function(){var scripts=document.getElementsByTagName('script'),leafletRe=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;var i,len,src,matches,path;for(i=0,len=scripts.length;i<len;i++){src=scripts[i].src;matches=src.match(leafletRe);if(matches){path=src.split(leafletRe)[0];return(path?path+'/':'')+'images';}}}());L.Marker=L.Class.extend({includes:L.Mixin.Events,options:{icon:new L.Icon.Default(),title:'',clickable:true,draggable:false,keyboard:true,zIndexOffset:0,opacity:1,riseOnHover:false,riseOffset:250},initialize:function(latlng,options){L.setOptions(this,options);this._latlng=L.latLng(latlng);},onAdd:function(map){this._map=map;map.on('viewreset',this.update,this);this._initIcon();this.update();if(map.options.zoomAnimation&&map.options.markerZoomAnimation)map.on('zoomanim',this._animateZoom,this);},addTo:function(map){map.addLayer(this);return this;},onRemove:function(map){if(this.dragging)this.dragging.disable();this._removeIcon();this._removeShadow();this.fire('remove');map.off({'viewreset':this.update,'zoomanim':this._animateZoom},this);this._map=null;},getLatLng:function(){return this._latlng;},setLatLng:function(latlng){this._latlng=L.latLng(latlng);this.update();return this.fire('move',{latlng:this._latlng});},setZIndexOffset:function(offset){this.options.zIndexOffset=offset;this.update();return this;},setIcon:function(icon){this.options.icon=icon;if(this._map){this._initIcon();this.update();}return this;},update:function(){if(this._icon){var pos=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(pos);}return this;},_initIcon:function(){var options=this.options,map=this._map,animation=(map.options.zoomAnimation&&map.options.markerZoomAnimation),classToAdd=animation?'leaflet-zoom-animated':'leaflet-zoom-hide';var icon=options.icon.createIcon(this._icon),addIcon=false;if(icon!==this._icon){if(this._icon)this._removeIcon();addIcon=true;if(options.title)icon.title=options.title;}L.DomUtil.addClass(icon,classToAdd);if(options.keyboard)icon.tabIndex='0';this._icon=icon;this._initInteraction();if(options.riseOnHover)L.DomEvent.on(icon,'mouseover',this._bringToFront,this).on(icon,'mouseout',this._resetZIndex,this);var newShadow=options.icon.createShadow(this._shadow),addShadow=false;if(newShadow!==this._shadow){this._removeShadow();addShadow=true;if(newShadow)L.DomUtil.addClass(newShadow,classToAdd);}this._shadow=newShadow;if(options.opacity<1)this._updateOpacity();var panes=this._map._panes;if(addIcon)panes.markerPane.appendChild(this._icon);if(newShadow&&addShadow)panes.shadowPane.appendChild(this._shadow);},_removeIcon:function(){if(this.options.riseOnHover)L.DomEvent.off(this._icon,'mouseover',this._bringToFront).off(this._icon,'mouseout',this._resetZIndex);this._map._panes.markerPane.removeChild(this._icon);this._icon=null;},_removeShadow:function(){if(this._shadow)this._map._panes.shadowPane.removeChild(this._shadow);this._shadow=null;},_setPos:function(pos){L.DomUtil.setPosition(this._icon,pos);if(this._shadow)L.DomUtil.setPosition(this._shadow,pos);this._zIndex=pos.y+this.options.zIndexOffset;this._resetZIndex();},_updateZIndex:function(offset){this._icon.style.zIndex=this._zIndex+offset;},_animateZoom:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center);this._setPos(pos);},_initInteraction:function(){if(!this.options.clickable)return;var icon=this._icon,events=['dblclick','mousedown','mouseover','mouseout','contextmenu'];L.DomUtil.addClass(icon,'leaflet-clickable');L.DomEvent.on(icon,'click',this._onMouseClick,this);L.DomEvent.on(icon,'keypress',this._onKeyPress,this);for(var i=0;i<events.length;i++)L.DomEvent.on(icon,events[i],this._fireMouseEvent,this);if(L.Handler.MarkerDrag){this.dragging=new L.Handler.MarkerDrag(this);if(this.options.draggable)this.dragging.enable();}},_onMouseClick:function(e){var wasDragged=this.dragging&&this.dragging.moved();if(this.hasEventListeners(e.type)||wasDragged)L.DomEvent.stopPropagation(e);if(wasDragged)return;if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved())return;this.fire(e.type,{originalEvent:e,latlng:this._latlng});},_onKeyPress:function(e){if(e.keyCode===13)this.fire('click',{originalEvent:e,latlng:this._latlng});},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e,latlng:this._latlng});if(e.type==='contextmenu'&&this.hasEventListeners(e.type))L.DomEvent.preventDefault(e);if(e.type!=='mousedown')L.DomEvent.stopPropagation(e);else L.DomEvent.preventDefault(e);},setOpacity:function(opacity){this.options.opacity=opacity;if(this._map)this._updateOpacity();},_updateOpacity:function(){L.DomUtil.setOpacity(this._icon,this.options.opacity);if(this._shadow)L.DomUtil.setOpacity(this._shadow,this.options.opacity);},_bringToFront:function(){this._updateZIndex(this.options.riseOffset);},_resetZIndex:function(){this._updateZIndex(0);}});L.marker=function(latlng,options){return new L.Marker(latlng,options);};L.DivIcon=L.Icon.extend({options:{iconSize:[12,12],className:'leaflet-div-icon',html:false},createIcon:function(oldIcon){var div=(oldIcon&&oldIcon.tagName==='DIV')?oldIcon:document.createElement('div'),options=this.options;if(options.html!==false)div.innerHTML=options.html;else div.innerHTML='';if(options.bgPos)div.style.backgroundPosition=(-options.bgPos.x)+'px '+(-options.bgPos.y)+'px';this._setIconStyles(div,'icon');return div;},createShadow:function(){return null;}});L.divIcon=function(options){return new L.DivIcon(options);};L.Map.mergeOptions({closePopupOnClick:true});L.Popup=L.Class.extend({includes:L.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:true,closeButton:true,offset:[0,7],autoPanPadding:[5,5],keepInView:false,className:'',zoomAnimation:true},initialize:function(options,source){L.setOptions(this,options);this._source=source;this._animated=L.Browser.any3d&&this.options.zoomAnimation;this._isOpen=false;},onAdd:function(map){this._map=map;if(!this._container)this._initLayout();this._updateContent();var animFade=map.options.fadeAnimation;if(animFade)L.DomUtil.setOpacity(this._container,0);map._panes.popupPane.appendChild(this._container);map.on(this._getEvents(),this);this._update();if(animFade)L.DomUtil.setOpacity(this._container,1);this.fire('open');map.fire('popupopen',{popup:this});if(this._source)this._source.fire('popupopen',{popup:this});},addTo:function(map){map.addLayer(this);return this;},openOn:function(map){map.openPopup(this);return this;},onRemove:function(map){map._panes.popupPane.removeChild(this._container);L.Util.falseFn(this._container.offsetWidth);map.off(this._getEvents(),this);if(map.options.fadeAnimation)L.DomUtil.setOpacity(this._container,0);this._map=null;this.fire('close');map.fire('popupclose',{popup:this});if(this._source)this._source.fire('popupclose',{popup:this});},setLatLng:function(latlng){this._latlng=L.latLng(latlng);this._update();return this;},setContent:function(content){this._content=content;this._update();return this;},_getEvents:function(){var events={viewreset:this._updatePosition};if(this._animated)events.zoomanim=this._zoomAnimation;if('closeOnClick' in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)events.preclick=this._close;if(this.options.keepInView)events.moveend=this._adjustPan;return events;},_close:function(){if(this._map)this._map.closePopup(this);},_initLayout:function(){var prefix='leaflet-popup',containerClass=prefix+' '+this.options.className+' leaflet-zoom-'+(this._animated?'animated':'hide'),container=this._container=L.DomUtil.create('div',containerClass),closeButton;if(this.options.closeButton){closeButton=this._closeButton=L.DomUtil.create('a',prefix+'-close-button',container);closeButton.href='#close';closeButton.innerHTML='&#215;';L.DomEvent.disableClickPropagation(closeButton);L.DomEvent.on(closeButton,'click',this._onCloseButtonClick,this);}var wrapper=this._wrapper=L.DomUtil.create('div',prefix+'-content-wrapper',container);L.DomEvent.disableClickPropagation(wrapper);this._contentNode=L.DomUtil.create('div',prefix+'-content',wrapper);L.DomEvent.on(this._contentNode,'mousewheel',L.DomEvent.stopPropagation);L.DomEvent.on(wrapper,'contextmenu',L.DomEvent.stopPropagation);this._tipContainer=L.DomUtil.create('div',prefix+'-tip-container',container);this._tip=L.DomUtil.create('div',prefix+'-tip',this._tipContainer);},_update:function(){if(!this._map)return;this._container.style.visibility='hidden';this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility='';this._adjustPan();},_updateContent:function(){if(!this._content)return;if(typeof this._content==='string')this._contentNode.innerHTML=this._content;else{while(this._contentNode.hasChildNodes())this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content);}this.fire('contentupdate');},_updateLayout:function(){var container=this._contentNode,style=container.style;style.width='';style.whiteSpace='nowrap';var width=container.offsetWidth;width=Math.min(width,this.options.maxWidth);width=Math.max(width,this.options.minWidth);style.width=(width+1)+'px';style.whiteSpace='';style.height='';var height=container.offsetHeight,maxHeight=this.options.maxHeight,scrolledClass='leaflet-popup-scrolled';if(maxHeight&&height>maxHeight){style.height=maxHeight+'px';L.DomUtil.addClass(container,scrolledClass);}else L.DomUtil.removeClass(container,scrolledClass);this._containerWidth=this._container.offsetWidth;},_updatePosition:function(){if(!this._map)return;var pos=this._map.latLngToLayerPoint(this._latlng),animated=this._animated,offset=L.point(this.options.offset);if(animated)L.DomUtil.setPosition(this._container,pos);this._containerBottom=-offset.y-(animated?0:pos.y);this._containerLeft=-Math.round(this._containerWidth/2)+offset.x+(animated?0:pos.x);this._container.style.bottom=this._containerBottom+'px';this._container.style.left=this._containerLeft+'px';},_zoomAnimation:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center);L.DomUtil.setPosition(this._container,pos);},_adjustPan:function(){if(!this.options.autoPan)return;var map=this._map,containerHeight=this._container.offsetHeight,containerWidth=this._containerWidth,layerPos=new L.Point(this._containerLeft,-containerHeight-this._containerBottom);if(this._animated)layerPos._add(L.DomUtil.getPosition(this._container));var containerPos=map.layerPointToContainerPoint(layerPos),padding=L.point(this.options.autoPanPadding),size=map.getSize(),dx=0,dy=0;if(containerPos.x+containerWidth>size.x)dx=containerPos.x+containerWidth-size.x+padding.x;if(containerPos.x-dx<0)dx=containerPos.x-padding.x;if(containerPos.y+containerHeight>size.y)dy=containerPos.y+containerHeight-size.y+padding.y;if(containerPos.y-dy<0)dy=containerPos.y-padding.y;if(dx||dy)map.fire('autopanstart').panBy([dx,dy]);},_onCloseButtonClick:function(e){this._close();L.DomEvent.stop(e);}});L.popup=function(options,source){return new L.Popup(options,source);};L.Map.include({openPopup:function(popup,latlng,options){this.closePopup();if(!(popup instanceof L.Popup)){var content=popup;popup=new L.Popup(options).setLatLng(latlng).setContent(content);}popup._isOpen=true;this._popup=popup;return this.addLayer(popup);},closePopup:function(popup){if(!popup||popup===this._popup){popup=this._popup;this._popup=null;}if(popup){this.removeLayer(popup);popup._isOpen=false;}return this;}});L.Marker.include({openPopup:function(){if(this._popup&&this._map&&!this._map.hasLayer(this._popup)){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup);}return this;},closePopup:function(){if(this._popup)this._popup._close();return this;},togglePopup:function(){if(this._popup)if(this._popup._isOpen)this.closePopup();else this.openPopup();return this;},bindPopup:function(content,options){var anchor=L.point(this.options.icon.options.popupAnchor||[0,0]);anchor=anchor.add(L.Popup.prototype.options.offset);if(options&&options.offset)anchor=anchor.add(options.offset);options=L.extend({offset:anchor},options);if(!this._popup)this.on('click',this.togglePopup,this).on('remove',this.closePopup,this).on('move',this._movePopup,this);if(content instanceof L.Popup){L.setOptions(content,options);this._popup=content;}else this._popup=new L.Popup(options,this).setContent(content);return this;},setPopupContent:function(content){if(this._popup)this._popup.setContent(content);return this;},unbindPopup:function(){if(this._popup){this._popup=null;this.off('click',this.togglePopup).off('remove',this.closePopup).off('move',this._movePopup);}return this;},_movePopup:function(e){this._popup.setLatLng(e.latlng);}});L.LayerGroup=L.Class.extend({initialize:function(layers){this._layers={};var i,len;if(layers)for(i=0,len=layers.length;i<len;i++)this.addLayer(layers[i]);},addLayer:function(layer){var id=this.getLayerId(layer);this._layers[id]=layer;if(this._map)this._map.addLayer(layer);return this;},removeLayer:function(layer){var id=layer in this._layers?layer:this.getLayerId(layer);if(this._map&&this._layers[id])this._map.removeLayer(this._layers[id]);delete this._layers[id];return this;},hasLayer:function(layer){if(!layer)return false;return(layer in this._layers||this.getLayerId(layer) in this._layers);},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this;},invoke:function(methodName){var args=Array.prototype.slice.call(arguments,1),i,layer;for(i in this._layers){layer=this._layers[i];if(layer[methodName])layer[methodName].apply(layer,args);}return this;},onAdd:function(map){this._map=map;this.eachLayer(map.addLayer,map);},onRemove:function(map){this.eachLayer(map.removeLayer,map);this._map=null;},addTo:function(map){map.addLayer(this);return this;},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this;},getLayer:function(id){return this._layers[id];},getLayers:function(){var layers=[];for(var i in this._layers)layers.push(this._layers[i]);return layers;},setZIndex:function(zIndex){return this.invoke('setZIndex',zIndex);},getLayerId:function(layer){return L.stamp(layer);}});L.layerGroup=function(layers){return new L.LayerGroup(layers);};L.FeatureGroup=L.LayerGroup.extend({includes:L.Mixin.Events,statics:{EVENTS:'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'},addLayer:function(layer){if(this.hasLayer(layer))return this;layer.on(L.FeatureGroup.EVENTS,this._propagateEvent,this);L.LayerGroup.prototype.addLayer.call(this,layer);if(this._popupContent&&layer.bindPopup)layer.bindPopup(this._popupContent,this._popupOptions);return this.fire('layeradd',{layer:layer});},removeLayer:function(layer){if(layer in this._layers)layer=this._layers[layer];layer.off(L.FeatureGroup.EVENTS,this._propagateEvent,this);L.LayerGroup.prototype.removeLayer.call(this,layer);if(this._popupContent)this.invoke('unbindPopup');return this.fire('layerremove',{layer:layer});},bindPopup:function(content,options){this._popupContent=content;this._popupOptions=options;return this.invoke('bindPopup',content,options);},setStyle:function(style){return this.invoke('setStyle',style);},bringToFront:function(){return this.invoke('bringToFront');},bringToBack:function(){return this.invoke('bringToBack');},getBounds:function(){var bounds=new L.LatLngBounds();this.eachLayer(function(layer){bounds.extend(layer instanceof L.Marker?layer.getLatLng():layer.getBounds());});return bounds;},_propagateEvent:function(e){if(!e.layer)e.layer=e.target;e.target=this;this.fire(e.type,e);}});L.featureGroup=function(layers){return new L.FeatureGroup(layers);};L.Path=L.Class.extend({includes:[L.Mixin.Events],statics:{CLIP_PADDING:L.Browser.mobile?Math.max(0,Math.min(0.5,(1280/Math.max(window.innerWidth,window.innerHeight)-1)/2)):0.5},options:{stroke:true,color:'#0033ff',dashArray:null,weight:5,opacity:0.5,fill:false,fillColor:null,fillOpacity:0.2,clickable:true},initialize:function(options){L.setOptions(this,options);},onAdd:function(map){this._map=map;if(!this._container){this._initElements();this._initEvents();}this.projectLatlngs();this._updatePath();if(this._container)this._map._pathRoot.appendChild(this._container);this.fire('add');map.on({'viewreset':this.projectLatlngs,'moveend':this._updatePath},this);},addTo:function(map){map.addLayer(this);return this;},onRemove:function(map){map._pathRoot.removeChild(this._container);this.fire('remove');this._map=null;if(L.Browser.vml){this._container=null;this._stroke=null;this._fill=null;}map.off({'viewreset':this.projectLatlngs,'moveend':this._updatePath},this);},projectLatlngs:function(){},setStyle:function(style){L.setOptions(this,style);if(this._container)this._updateStyle();return this;},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath();}return this;}});L.Map.include({_updatePathViewport:function(){var p=L.Path.CLIP_PADDING,size=this.getSize(),panePos=L.DomUtil.getPosition(this._mapPane),min=panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),max=min.add(size.multiplyBy(1+p*2)._round());this._pathViewport=new L.Bounds(min,max);}});L.Path.SVG_NS='http://www.w3.org/2000/svg';L.Browser.svg=!!(document.createElementNS&&document.createElementNS(L.Path.SVG_NS,'svg').createSVGRect);L.Path=L.Path.extend({statics:{SVG:L.Browser.svg},bringToFront:function(){var root=this._map._pathRoot,path=this._container;if(path&&root.lastChild!==path)root.appendChild(path);return this;},bringToBack:function(){var root=this._map._pathRoot,path=this._container,first=root.firstChild;if(path&&first!==path)root.insertBefore(path,first);return this;},getPathString:function(){},_createElement:function(name){return document.createElementNS(L.Path.SVG_NS,name);},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle();},_initPath:function(){this._container=this._createElement('g');this._path=this._createElement('path');this._container.appendChild(this._path);},_initStyle:function(){if(this.options.stroke){this._path.setAttribute('stroke-linejoin','round');this._path.setAttribute('stroke-linecap','round');}if(this.options.fill)this._path.setAttribute('fill-rule','evenodd');if(this.options.pointerEvents)this._path.setAttribute('pointer-events',this.options.pointerEvents);if(!this.options.clickable&&!this.options.pointerEvents)this._path.setAttribute('pointer-events','none');this._updateStyle();},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute('stroke',this.options.color);this._path.setAttribute('stroke-opacity',this.options.opacity);this._path.setAttribute('stroke-width',this.options.weight);if(this.options.dashArray)this._path.setAttribute('stroke-dasharray',this.options.dashArray);else this._path.removeAttribute('stroke-dasharray');}else this._path.setAttribute('stroke','none');if(this.options.fill){this._path.setAttribute('fill',this.options.fillColor||this.options.color);this._path.setAttribute('fill-opacity',this.options.fillOpacity);}else this._path.setAttribute('fill','none');},_updatePath:function(){var str=this.getPathString();if(!str)str='M0 0';this._path.setAttribute('d',str);},_initEvents:function(){if(this.options.clickable){if(L.Browser.svg||!L.Browser.vml)this._path.setAttribute('class','leaflet-clickable');L.DomEvent.on(this._container,'click',this._onMouseClick,this);var events=['dblclick','mousedown','mouseover','mouseout','mousemove','contextmenu'];for(var i=0;i<events.length;i++)L.DomEvent.on(this._container,events[i],this._fireMouseEvent,this);}},_onMouseClick:function(e){if(this._map.dragging&&this._map.dragging.moved())return;this._fireMouseEvent(e);},_fireMouseEvent:function(e){if(!this.hasEventListeners(e.type))return;var map=this._map,containerPoint=map.mouseEventToContainerPoint(e),layerPoint=map.containerPointToLayerPoint(containerPoint),latlng=map.layerPointToLatLng(layerPoint);this.fire(e.type,{latlng:latlng,layerPoint:layerPoint,containerPoint:containerPoint,originalEvent:e});if(e.type==='contextmenu')L.DomEvent.preventDefault(e);if(e.type!=='mousemove')L.DomEvent.stopPropagation(e);}});L.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=L.Path.prototype._createElement('svg');this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&L.Browser.any3d){this._pathRoot.setAttribute('class',' leaflet-zoom-animated');this.on({'zoomanim':this._animatePathZoom,'zoomend':this._endPathZoom});}else this._pathRoot.setAttribute('class',' leaflet-zoom-hide');this.on('moveend',this._updateSvgViewport);this._updateSvgViewport();}},_animatePathZoom:function(e){var scale=this.getZoomScale(e.zoom),offset=this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);this._pathRoot.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(offset)+' scale('+scale+') ';this._pathZooming=true;},_endPathZoom:function(){this._pathZooming=false;},_updateSvgViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var vp=this._pathViewport,min=vp.min,max=vp.max,width=max.x-min.x,height=max.y-min.y,root=this._pathRoot,pane=this._panes.overlayPane;if(L.Browser.mobileWebkit)pane.removeChild(root);L.DomUtil.setPosition(root,min);root.setAttribute('width',width);root.setAttribute('height',height);root.setAttribute('viewBox',[min.x,min.y,width,height].join(' '));if(L.Browser.mobileWebkit)pane.appendChild(root);}});L.Path.include({bindPopup:function(content,options){if(content instanceof L.Popup)this._popup=content;else{if(!this._popup||options)this._popup=new L.Popup(options,this);this._popup.setContent(content);}if(!this._popupHandlersAdded){this.on('click',this._openPopup,this).on('remove',this.closePopup,this);this._popupHandlersAdded=true;}return this;},unbindPopup:function(){if(this._popup){this._popup=null;this.off('click',this._openPopup).off('remove',this.closePopup);this._popupHandlersAdded=false;}return this;},openPopup:function(latlng){if(this._popup){latlng=latlng||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)];this._openPopup({latlng:latlng});}return this;},closePopup:function(){if(this._popup)this._popup._close();return this;},_openPopup:function(e){this._popup.setLatLng(e.latlng);this._map.openPopup(this._popup);}});L.Browser.vml=!L.Browser.svg&&(function(){try{var div=document.createElement('div');div.innerHTML='<v:shape adj="1"/>';var shape=div.firstChild;shape.style.behavior='url(#default#VML)';return shape&&(typeof shape.adj==='object');}catch(e){return false;}}());L.Path=L.Browser.svg||!L.Browser.vml?L.Path:L.Path.extend({statics:{VML:true,CLIP_PADDING:0.02},_createElement:(function(){try{document.namespaces.add('lvml','urn:schemas-microsoft-com:vml');return function(name){return document.createElement('<lvml:'+name+' class="lvml">');};}catch(e){return function(name){return document.createElement('<'+name+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">');};}}()),_initPath:function(){var container=this._container=this._createElement('shape');L.DomUtil.addClass(container,'leaflet-vml-shape');if(this.options.clickable)L.DomUtil.addClass(container,'leaflet-clickable');container.coordsize='1 1';this._path=this._createElement('path');container.appendChild(this._path);this._map._pathRoot.appendChild(container);},_initStyle:function(){this._updateStyle();},_updateStyle:function(){var stroke=this._stroke,fill=this._fill,options=this.options,container=this._container;container.stroked=options.stroke;container.filled=options.fill;if(options.stroke){if(!stroke){stroke=this._stroke=this._createElement('stroke');stroke.endcap='round';container.appendChild(stroke);}stroke.weight=options.weight+'px';stroke.color=options.color;stroke.opacity=options.opacity;if(options.dashArray)stroke.dashStyle=options.dashArray instanceof Array?options.dashArray.join(' '):options.dashArray.replace(/( *, *)/g,' ');else stroke.dashStyle='';}else if(stroke){container.removeChild(stroke);this._stroke=null;}if(options.fill){if(!fill){fill=this._fill=this._createElement('fill');container.appendChild(fill);}fill.color=options.fillColor||options.color;fill.opacity=options.fillOpacity;}else if(fill){container.removeChild(fill);this._fill=null;}},_updatePath:function(){var style=this._container.style;style.display='none';this._path.v=this.getPathString()+' ';style.display='';}});L.Map.include(L.Browser.svg||!L.Browser.vml?{}:{_initPathRoot:function(){if(this._pathRoot)return;var root=this._pathRoot=document.createElement('div');root.className='leaflet-vml-container';this._panes.overlayPane.appendChild(root);this.on('moveend',this._updatePathViewport);this._updatePathViewport();}});L.Browser.canvas=(function(){return !!document.createElement('canvas').getContext;}());L.Path=(L.Path.SVG&&!window.L_PREFER_CANVAS)||!L.Browser.canvas?L.Path:L.Path.extend({statics:{CANVAS:true,SVG:false},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate();}return this;},setStyle:function(style){L.setOptions(this,style);if(this._map){this._updateStyle();this._requestUpdate();}return this;},onRemove:function(map){map.off('viewreset',this.projectLatlngs,this).off('moveend',this._updatePath,this);if(this.options.clickable){this._map.off('click',this._onClick,this);this._map.off('mousemove',this._onMouseMove,this);}this._requestUpdate();this._map=null;},_requestUpdate:function(){if(this._map&&!L.Path._updateRequest)L.Path._updateRequest=L.Util.requestAnimFrame(this._fireMapMoveEnd,this._map);},_fireMapMoveEnd:function(){L.Path._updateRequest=null;this.fire('moveend');},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx;},_updateStyle:function(){var options=this.options;if(options.stroke){this._ctx.lineWidth=options.weight;this._ctx.strokeStyle=options.color;}if(options.fill)this._ctx.fillStyle=options.fillColor||options.color;},_drawPath:function(){var i,j,len,len2,point,drawMethod;this._ctx.beginPath();for(i=0,len=this._parts.length;i<len;i++){for(j=0,len2=this._parts[i].length;j<len2;j++){point=this._parts[i][j];drawMethod=(j===0?'move':'line')+'To';this._ctx[drawMethod](point.x,point.y);}if(this instanceof L.Polygon)this._ctx.closePath();}},_checkIfEmpty:function(){return !this._parts.length;},_updatePath:function(){if(this._checkIfEmpty())return;var ctx=this._ctx,options=this.options;this._drawPath();ctx.save();this._updateStyle();if(options.fill){ctx.globalAlpha=options.fillOpacity;ctx.fill();}if(options.stroke){ctx.globalAlpha=options.opacity;ctx.stroke();}ctx.restore();},_initEvents:function(){if(this.options.clickable){this._map.on('mousemove',this._onMouseMove,this);this._map.on('click',this._onClick,this);}},_onClick:function(e){if(this._containsPoint(e.layerPoint))this.fire('click',e);},_onMouseMove:function(e){if(!this._map||this._map._animatingZoom)return;if(this._containsPoint(e.layerPoint)){this._ctx.canvas.style.cursor='pointer';this._mouseInside=true;this.fire('mouseover',e);}else if(this._mouseInside){this._ctx.canvas.style.cursor='';this._mouseInside=false;this.fire('mouseout',e);}}});L.Map.include((L.Path.SVG&&!window.L_PREFER_CANVAS)||!L.Browser.canvas?{}:{_initPathRoot:function(){var root=this._pathRoot,ctx;if(!root){root=this._pathRoot=document.createElement('canvas');root.style.position='absolute';ctx=this._canvasCtx=root.getContext('2d');ctx.lineCap='round';ctx.lineJoin='round';this._panes.overlayPane.appendChild(root);if(this.options.zoomAnimation){this._pathRoot.className='leaflet-zoom-animated';this.on('zoomanim',this._animatePathZoom);this.on('zoomend',this._endPathZoom);}this.on('moveend',this._updateCanvasViewport);this._updateCanvasViewport();}},_updateCanvasViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var vp=this._pathViewport,min=vp.min,size=vp.max.subtract(min),root=this._pathRoot;L.DomUtil.setPosition(root,min);root.width=size.x;root.height=size.y;root.getContext('2d').translate(-min.x,-min.y);}});L.LineUtil={simplify:function(points,tolerance){if(!tolerance||!points.length)return points.slice();var sqTolerance=tolerance*tolerance;points=this._reducePoints(points,sqTolerance);points=this._simplifyDP(points,sqTolerance);return points;},pointToSegmentDistance:function(p,p1,p2){return Math.sqrt(this._sqClosestPointOnSegment(p,p1,p2,true));},closestPointOnSegment:function(p,p1,p2){return this._sqClosestPointOnSegment(p,p1,p2);},_simplifyDP:function(points,sqTolerance){var len=points.length,ArrayConstructor=typeof Uint8Array!==undefined+''?Uint8Array:Array,markers=new ArrayConstructor(len);markers[0]=markers[len-1]=1;this._simplifyDPStep(points,markers,sqTolerance,0,len-1);var i,newPoints=[];for(i=0;i<len;i++)if(markers[i])newPoints.push(points[i]);return newPoints;},_simplifyDPStep:function(points,markers,sqTolerance,first,last){var maxSqDist=0,index,i,sqDist;for(i=first+1;i<=last-1;i++){sqDist=this._sqClosestPointOnSegment(points[i],points[first],points[last],true);if(sqDist>maxSqDist){index=i;maxSqDist=sqDist;}}if(maxSqDist>sqTolerance){markers[index]=1;this._simplifyDPStep(points,markers,sqTolerance,first,index);this._simplifyDPStep(points,markers,sqTolerance,index,last);}},_reducePoints:function(points,sqTolerance){var reducedPoints=[points[0]];for(var i=1,prev=0,len=points.length;i<len;i++)if(this._sqDist(points[i],points[prev])>sqTolerance){reducedPoints.push(points[i]);prev=i;}if(prev<len-1)reducedPoints.push(points[len-1]);return reducedPoints;},clipSegment:function(a,b,bounds,useLastCode){var codeA=useLastCode?this._lastCode:this._getBitCode(a,bounds),codeB=this._getBitCode(b,bounds),codeOut,p,newCode;this._lastCode=codeB;while(true)if(!(codeA|codeB))return [a,b];else if(codeA&codeB)return false;else{codeOut=codeA||codeB;p=this._getEdgeIntersection(a,b,codeOut,bounds);newCode=this._getBitCode(p,bounds);if(codeOut===codeA){a=p;codeA=newCode;}else{b=p;codeB=newCode;}}},_getEdgeIntersection:function(a,b,code,bounds){var dx=b.x-a.x,dy=b.y-a.y,min=bounds.min,max=bounds.max;if(code&8)return new L.Point(a.x+dx*(max.y-a.y)/dy,max.y);else if(code&4)return new L.Point(a.x+dx*(min.y-a.y)/dy,min.y);else if(code&2)return new L.Point(max.x,a.y+dy*(max.x-a.x)/dx);else if(code&1)return new L.Point(min.x,a.y+dy*(min.x-a.x)/dx);},_getBitCode:function(p,bounds){var code=0;if(p.x<bounds.min.x)code|=1;else if(p.x>bounds.max.x)code|=2;if(p.y<bounds.min.y)code|=4;else if(p.y>bounds.max.y)code|=8;return code;},_sqDist:function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy;},_sqClosestPointOnSegment:function(p,p1,p2,sqDist){var x=p1.x,y=p1.y,dx=p2.x-x,dy=p2.y-y,dot=dx*dx+dy*dy,t;if(dot>0){t=((p.x-x)*dx+(p.y-y)*dy)/dot;if(t>1){x=p2.x;y=p2.y;}else if(t>0){x+=dx*t;y+=dy*t;}}dx=p.x-x;dy=p.y-y;return sqDist?dx*dx+dy*dy:new L.Point(x,y);}};L.Polyline=L.Path.extend({initialize:function(latlngs,options){L.Path.prototype.initialize.call(this,options);this._latlngs=this._convertLatLngs(latlngs);},options:{smoothFactor:1.0,noClip:false},projectLatlngs:function(){this._originalPoints=[];for(var i=0,len=this._latlngs.length;i<len;i++)this._originalPoints[i]=this._map.latLngToLayerPoint(this._latlngs[i]);},getPathString:function(){for(var i=0,len=this._parts.length,str='';i<len;i++)str+=this._getPathPartStr(this._parts[i]);return str;},getLatLngs:function(){return this._latlngs;},setLatLngs:function(latlngs){this._latlngs=this._convertLatLngs(latlngs);return this.redraw();},addLatLng:function(latlng){this._latlngs.push(L.latLng(latlng));return this.redraw();},spliceLatLngs:function(){var removed=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,true);this.redraw();return removed;},closestLayerPoint:function(p){var minDistance=Infinity,parts=this._parts,p1,p2,minPoint=null;for(var j=0,jLen=parts.length;j<jLen;j++){var points=parts[j];for(var i=1,len=points.length;i<len;i++){p1=points[i-1];p2=points[i];var sqDist=L.LineUtil._sqClosestPointOnSegment(p,p1,p2,true);if(sqDist<minDistance){minDistance=sqDist;minPoint=L.LineUtil._sqClosestPointOnSegment(p,p1,p2);}}}if(minPoint)minPoint.distance=Math.sqrt(minDistance);return minPoint;},getBounds:function(){return new L.LatLngBounds(this.getLatLngs());},_convertLatLngs:function(latlngs,overwrite){var i,len,target=overwrite?latlngs:[];for(i=0,len=latlngs.length;i<len;i++){if(L.Util.isArray(latlngs[i])&&typeof latlngs[i][0]!=='number')return;target[i]=L.latLng(latlngs[i]);}return target;},_initEvents:function(){L.Path.prototype._initEvents.call(this);},_getPathPartStr:function(points){var round=L.Path.VML;for(var j=0,len2=points.length,str='',p;j<len2;j++){p=points[j];if(round)p._round();str+=(j?'L':'M')+p.x+' '+p.y;}return str;},_clipPoints:function(){var points=this._originalPoints,len=points.length,i,k,segment;if(this.options.noClip){this._parts=[points];return;}this._parts=[];var parts=this._parts,vp=this._map._pathViewport,lu=L.LineUtil;for(i=0,k=0;i<len-1;i++){segment=lu.clipSegment(points[i],points[i+1],vp,i);if(!segment)continue;parts[k]=parts[k]||[];parts[k].push(segment[0]);if((segment[1]!==points[i+1])||(i===len-2)){parts[k].push(segment[1]);k++;}}},_simplifyPoints:function(){var parts=this._parts,lu=L.LineUtil;for(var i=0,len=parts.length;i<len;i++)parts[i]=lu.simplify(parts[i],this.options.smoothFactor);},_updatePath:function(){if(!this._map)return;this._clipPoints();this._simplifyPoints();L.Path.prototype._updatePath.call(this);}});L.polyline=function(latlngs,options){return new L.Polyline(latlngs,options);};L.PolyUtil={};L.PolyUtil.clipPolygon=function(points,bounds){var clippedPoints,edges=[1,4,2,8],i,j,k,a,b,len,edge,p,lu=L.LineUtil;for(i=0,len=points.length;i<len;i++)points[i]._code=lu._getBitCode(points[i],bounds);for(k=0;k<4;k++){edge=edges[k];clippedPoints=[];for(i=0,len=points.length,j=len-1;i<len;j=i++){a=points[i];b=points[j];if(!(a._code&edge)){if(b._code&edge){p=lu._getEdgeIntersection(b,a,edge,bounds);p._code=lu._getBitCode(p,bounds);clippedPoints.push(p);}clippedPoints.push(a);}else if(!(b._code&edge)){p=lu._getEdgeIntersection(b,a,edge,bounds);p._code=lu._getBitCode(p,bounds);clippedPoints.push(p);}}points=clippedPoints;}return points;};L.Polygon=L.Polyline.extend({options:{fill:true},initialize:function(latlngs,options){var i,len,hole;L.Polyline.prototype.initialize.call(this,latlngs,options);if(latlngs&&L.Util.isArray(latlngs[0])&&(typeof latlngs[0][0]!=='number')){this._latlngs=this._convertLatLngs(latlngs[0]);this._holes=latlngs.slice(1);for(i=0,len=this._holes.length;i<len;i++){hole=this._holes[i]=this._convertLatLngs(this._holes[i]);if(hole[0].equals(hole[hole.length-1]))hole.pop();}}latlngs=this._latlngs;if(latlngs.length>=2&&latlngs[0].equals(latlngs[latlngs.length-1]))latlngs.pop();},projectLatlngs:function(){L.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes)return;var i,j,len,len2;for(i=0,len=this._holes.length;i<len;i++){this._holePoints[i]=[];for(j=0,len2=this._holes[i].length;j<len2;j++)this._holePoints[i][j]=this._map.latLngToLayerPoint(this._holes[i][j]);}},_clipPoints:function(){var points=this._originalPoints,newParts=[];this._parts=[points].concat(this._holePoints);if(this.options.noClip)return;for(var i=0,len=this._parts.length;i<len;i++){var clipped=L.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);if(clipped.length)newParts.push(clipped);}this._parts=newParts;},_getPathPartStr:function(points){var str=L.Polyline.prototype._getPathPartStr.call(this,points);return str+(L.Browser.svg?'z':'x');}});L.polygon=function(latlngs,options){return new L.Polygon(latlngs,options);};(function(){function createMulti(Klass){return L.FeatureGroup.extend({initialize:function(latlngs,options){this._layers={};this._options=options;this.setLatLngs(latlngs);},setLatLngs:function(latlngs){var i=0,len=latlngs.length;this.eachLayer(function(layer){if(i<len)layer.setLatLngs(latlngs[i++]);else this.removeLayer(layer);},this);while(i<len)this.addLayer(new Klass(latlngs[i++],this._options));return this;}});}L.MultiPolyline=createMulti(L.Polyline);L.MultiPolygon=createMulti(L.Polygon);L.multiPolyline=function(latlngs,options){return new L.MultiPolyline(latlngs,options);};L.multiPolygon=function(latlngs,options){return new L.MultiPolygon(latlngs,options);};}());L.Rectangle=L.Polygon.extend({initialize:function(latLngBounds,options){L.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(latLngBounds),options);},setBounds:function(latLngBounds){this.setLatLngs(this._boundsToLatLngs(latLngBounds));},_boundsToLatLngs:function(latLngBounds){latLngBounds=L.latLngBounds(latLngBounds);return [latLngBounds.getSouthWest(),latLngBounds.getNorthWest(),latLngBounds.getNorthEast(),latLngBounds.getSouthEast()];}});L.rectangle=function(latLngBounds,options){return new L.Rectangle(latLngBounds,options);};L.Circle=L.Path.extend({initialize:function(latlng,radius,options){L.Path.prototype.initialize.call(this,options);this._latlng=L.latLng(latlng);this._mRadius=radius;},options:{fill:true},setLatLng:function(latlng){this._latlng=L.latLng(latlng);return this.redraw();},setRadius:function(radius){this._mRadius=radius;return this.redraw();},projectLatlngs:function(){var lngRadius=this._getLngRadius(),latlng=this._latlng,pointLeft=this._map.latLngToLayerPoint([latlng.lat,latlng.lng-lngRadius]);this._point=this._map.latLngToLayerPoint(latlng);this._radius=Math.max(this._point.x-pointLeft.x,1);},getBounds:function(){var lngRadius=this._getLngRadius(),latRadius=(this._mRadius/40075017)*360,latlng=this._latlng;return new L.LatLngBounds([latlng.lat-latRadius,latlng.lng-lngRadius],[latlng.lat+latRadius,latlng.lng+lngRadius]);},getLatLng:function(){return this._latlng;},getPathString:function(){var p=this._point,r=this._radius;if(this._checkIfEmpty())return '';if(L.Browser.svg)return 'M'+p.x+','+(p.y-r)+'A'+r+','+r+',0,1,1,'+(p.x-0.1)+','+(p.y-r)+' z';else{p._round();r=Math.round(r);return 'AL '+p.x+','+p.y+' '+r+','+r+' 0,'+(65535*360);}},getRadius:function(){return this._mRadius;},_getLatRadius:function(){return(this._mRadius/40075017)*360;},_getLngRadius:function(){return this._getLatRadius()/Math.cos(L.LatLng.DEG_TO_RAD*this._latlng.lat);},_checkIfEmpty:function(){if(!this._map)return false;var vp=this._map._pathViewport,r=this._radius,p=this._point;return p.x-r>vp.max.x||p.y-r>vp.max.y||p.x+r<vp.min.x||p.y+r<vp.min.y;}});L.circle=function(latlng,radius,options){return new L.Circle(latlng,radius,options);};L.CircleMarker=L.Circle.extend({options:{radius:10,weight:2},initialize:function(latlng,options){L.Circle.prototype.initialize.call(this,latlng,null,options);this._radius=this.options.radius;},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng);},_updateStyle:function(){L.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius);},setRadius:function(radius){this.options.radius=this._radius=radius;return this.redraw();}});L.circleMarker=function(latlng,options){return new L.CircleMarker(latlng,options);};L.Polyline.include(!L.Path.CANVAS?{}:{_containsPoint:function(p,closed){var i,j,k,len,len2,dist,part,w=this.options.weight/2;if(L.Browser.touch)w+=10;for(i=0,len=this._parts.length;i<len;i++){part=this._parts[i];for(j=0,len2=part.length,k=len2-1;j<len2;k=j++){if(!closed&&(j===0))continue;dist=L.LineUtil.pointToSegmentDistance(p,part[k],part[j]);if(dist<=w)return true;}}return false;}});L.Polygon.include(!L.Path.CANVAS?{}:{_containsPoint:function(p){var inside=false,part,p1,p2,i,j,k,len,len2;if(L.Polyline.prototype._containsPoint.call(this,p,true))return true;for(i=0,len=this._parts.length;i<len;i++){part=this._parts[i];for(j=0,len2=part.length,k=len2-1;j<len2;k=j++){p1=part[j];p2=part[k];if(((p1.y>p.y)!==(p2.y>p.y))&&(p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x))inside=!inside;}}return inside;}});L.Circle.include(!L.Path.CANVAS?{}:{_drawPath:function(){var p=this._point;this._ctx.beginPath();this._ctx.arc(p.x,p.y,this._radius,0,Math.PI*2,false);},_containsPoint:function(p){var center=this._point,w2=this.options.stroke?this.options.weight/2:0;return(p.distanceTo(center)<=this._radius+w2);}});L.CircleMarker.include(!L.Path.CANVAS?{}:{_updateStyle:function(){L.Path.prototype._updateStyle.call(this);}});L.GeoJSON=L.FeatureGroup.extend({initialize:function(geojson,options){L.setOptions(this,options);this._layers={};if(geojson)this.addData(geojson);},addData:function(geojson){var features=L.Util.isArray(geojson)?geojson:geojson.features,i,len;if(features){for(i=0,len=features.length;i<len;i++)if(features[i].geometries||features[i].geometry||features[i].features)this.addData(features[i]);return this;}var options=this.options;if(options.filter&&!options.filter(geojson))return;var layer=L.GeoJSON.geometryToLayer(geojson,options.pointToLayer,options.coordsToLatLng);layer.feature=L.GeoJSON.asFeature(geojson);layer.defaultOptions=layer.options;this.resetStyle(layer);if(options.onEachFeature)options.onEachFeature(geojson,layer);return this.addLayer(layer);},resetStyle:function(layer){var style=this.options.style;if(style){L.Util.extend(layer.options,layer.defaultOptions);this._setLayerStyle(layer,style);}},setStyle:function(style){this.eachLayer(function(layer){this._setLayerStyle(layer,style);},this);},_setLayerStyle:function(layer,style){if(typeof style==='function')style=style(layer.feature);if(layer.setStyle)layer.setStyle(style);}});L.extend(L.GeoJSON,{geometryToLayer:function(geojson,pointToLayer,coordsToLatLng){var geometry=geojson.type==='Feature'?geojson.geometry:geojson,coords=geometry.coordinates,layers=[],latlng,latlngs,i,len,layer;coordsToLatLng=coordsToLatLng||this.coordsToLatLng;switch(geometry.type){case 'Point':latlng=coordsToLatLng(coords);return pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng);case 'MultiPoint':for(i=0,len=coords.length;i<len;i++){latlng=coordsToLatLng(coords[i]);layer=pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng);layers.push(layer);}return new L.FeatureGroup(layers);case 'LineString':latlngs=this.coordsToLatLngs(coords,0,coordsToLatLng);return new L.Polyline(latlngs);case 'Polygon':latlngs=this.coordsToLatLngs(coords,1,coordsToLatLng);return new L.Polygon(latlngs);case 'MultiLineString':latlngs=this.coordsToLatLngs(coords,1,coordsToLatLng);return new L.MultiPolyline(latlngs);case 'MultiPolygon':latlngs=this.coordsToLatLngs(coords,2,coordsToLatLng);return new L.MultiPolygon(latlngs);case 'GeometryCollection':for(i=0,len=geometry.geometries.length;i<len;i++){layer=this.geometryToLayer({geometry:geometry.geometries[i],type:'Feature',properties:geojson.properties},pointToLayer,coordsToLatLng);layers.push(layer);}return new L.FeatureGroup(layers);default:throw new Error('Invalid GeoJSON object.');}},coordsToLatLng:function(coords){return new L.LatLng(coords[1],coords[0]);},coordsToLatLngs:function(coords,levelsDeep,coordsToLatLng){var latlng,i,len,latlngs=[];for(i=0,len=coords.length;i<len;i++){latlng=levelsDeep?this.coordsToLatLngs(coords[i],levelsDeep-1,coordsToLatLng):(coordsToLatLng||this.coordsToLatLng)(coords[i]);latlngs.push(latlng);}return latlngs;},latLngToCoords:function(latLng){return [latLng.lng,latLng.lat];},latLngsToCoords:function(latLngs){var coords=[];for(var i=0,len=latLngs.length;i<len;i++)coords.push(L.GeoJSON.latLngToCoords(latLngs[i]));return coords;},getFeature:function(layer,newGeometry){return layer.feature?L.extend({},layer.feature,{geometry:newGeometry}):L.GeoJSON.asFeature(newGeometry);},asFeature:function(geoJSON){if(geoJSON.type==='Feature')return geoJSON;return{type:'Feature',properties:{},geometry:geoJSON};}});var PointToGeoJSON={toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:'Point',coordinates:L.GeoJSON.latLngToCoords(this.getLatLng())});}};L.Marker.include(PointToGeoJSON);L.Circle.include(PointToGeoJSON);L.CircleMarker.include(PointToGeoJSON);L.Polyline.include({toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:'LineString',coordinates:L.GeoJSON.latLngsToCoords(this.getLatLngs())});}});L.Polygon.include({toGeoJSON:function(){var coords=[L.GeoJSON.latLngsToCoords(this.getLatLngs())],i,len,hole;coords[0].push(coords[0][0]);if(this._holes)for(i=0,len=this._holes.length;i<len;i++){hole=L.GeoJSON.latLngsToCoords(this._holes[i]);hole.push(hole[0]);coords.push(hole);}return L.GeoJSON.getFeature(this,{type:'Polygon',coordinates:coords});}});(function(){function includeMulti(Klass,type){Klass.include({toGeoJSON:function(){var coords=[];this.eachLayer(function(layer){coords.push(layer.toGeoJSON().geometry.coordinates);});return L.GeoJSON.getFeature(this,{type:type,coordinates:coords});}});}includeMulti(L.MultiPolyline,'MultiLineString');includeMulti(L.MultiPolygon,'MultiPolygon');}());L.LayerGroup.include({toGeoJSON:function(){var features=[];this.eachLayer(function(layer){if(layer.toGeoJSON)features.push(L.GeoJSON.asFeature(layer.toGeoJSON()));});return{type:'FeatureCollection',features:features};}});L.geoJson=function(geojson,options){return new L.GeoJSON(geojson,options);};L.DomEvent={addListener:function(obj,type,fn,context){var id=L.stamp(fn),key='_leaflet_'+type+id,handler,originalHandler,newType;if(obj[key])return this;handler=function(e){return fn.call(context||obj,e||L.DomEvent._getEvent());};if(L.Browser.msTouch&&type.indexOf('touch')===0)return this.addMsTouchListener(obj,type,handler,id);if(L.Browser.touch&&(type==='dblclick')&&this.addDoubleTapListener)this.addDoubleTapListener(obj,handler,id);if('addEventListener' in obj){if(type==='mousewheel'){obj.addEventListener('DOMMouseScroll',handler,false);obj.addEventListener(type,handler,false);}else if((type==='mouseenter')||(type==='mouseleave')){originalHandler=handler;newType=(type==='mouseenter'?'mouseover':'mouseout');handler=function(e){if(!L.DomEvent._checkMouse(obj,e))return;return originalHandler(e);};obj.addEventListener(newType,handler,false);}else if(type==='click'&&L.Browser.android){originalHandler=handler;handler=function(e){return L.DomEvent._filterClick(e,originalHandler);};obj.addEventListener(type,handler,false);}else obj.addEventListener(type,handler,false);}else if('attachEvent' in obj)obj.attachEvent('on'+type,handler);obj[key]=handler;return this;},removeListener:function(obj,type,fn){var id=L.stamp(fn),key='_leaflet_'+type+id,handler=obj[key];if(!handler)return this;if(L.Browser.msTouch&&type.indexOf('touch')===0)this.removeMsTouchListener(obj,type,id);else if(L.Browser.touch&&(type==='dblclick')&&this.removeDoubleTapListener)this.removeDoubleTapListener(obj,id);else if('removeEventListener' in obj)if(type==='mousewheel'){obj.removeEventListener('DOMMouseScroll',handler,false);obj.removeEventListener(type,handler,false);}else if((type==='mouseenter')||(type==='mouseleave'))obj.removeEventListener((type==='mouseenter'?'mouseover':'mouseout'),handler,false);else obj.removeEventListener(type,handler,false);else if('detachEvent' in obj)obj.detachEvent('on'+type,handler);obj[key]=null;return this;},stopPropagation:function(e){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true;return this;},disableClickPropagation:function(el){var stop=L.DomEvent.stopPropagation;for(var i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.addListener(el,L.Draggable.START[i],stop);return L.DomEvent.addListener(el,'click',L.DomEvent._fakeStop).addListener(el,'dblclick',stop);},preventDefault:function(e){if(e.preventDefault)e.preventDefault();else e.returnValue=false;return this;},stop:function(e){return L.DomEvent.preventDefault(e).stopPropagation(e);},getMousePosition:function(e,container){var body=document.body,docEl=document.documentElement,x=e.pageX?e.pageX:e.clientX+body.scrollLeft+docEl.scrollLeft,y=e.pageY?e.pageY:e.clientY+body.scrollTop+docEl.scrollTop,pos=new L.Point(x,y);return(container?pos._subtract(L.DomUtil.getViewportOffset(container)):pos);},getWheelDelta:function(e){var delta=0;if(e.wheelDelta)delta=e.wheelDelta/120;if(e.detail)delta=-e.detail/3;return delta;},_fakeStop:function stop(e){e._leaflet_stop=true;},_checkMouse:function(el,e){var related=e.relatedTarget;if(!related)return true;try{while(related&&(related!==el))related=related.parentNode;}catch(err){return false;}return(related!==el);},_getEvent:function(){var e=window.event;if(!e){var caller=arguments.callee.caller;while(caller){e=caller.arguments[0];if(e&&window.Event===e.constructor)break;caller=caller.caller;}}return e;},_filterClick:function(e,handler){var timeStamp=(e.timeStamp||e.originalEvent.timeStamp),elapsed=L.DomEvent._lastClick&&(timeStamp-L.DomEvent._lastClick);if((elapsed&&elapsed>100&&elapsed<1000)||(e.target._simulatedClick&&!e._simulated)){L.DomEvent.stop(e);return;}L.DomEvent._lastClick=timeStamp;return handler(e);}};L.DomEvent.on=L.DomEvent.addListener;L.DomEvent.off=L.DomEvent.removeListener;L.Draggable=L.Class.extend({includes:L.Mixin.Events,statics:{START:L.Browser.touch?['touchstart','mousedown']:['mousedown'],END:{mousedown:'mouseup',touchstart:'touchend',MSPointerDown:'touchend'},MOVE:{mousedown:'mousemove',touchstart:'touchmove',MSPointerDown:'touchmove'}},initialize:function(element,dragStartTarget){this._element=element;this._dragStartTarget=dragStartTarget||element;},enable:function(){if(this._enabled)return;for(var i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.on(this._dragStartTarget,L.Draggable.START[i],this._onDown,this);this._enabled=true;},disable:function(){if(!this._enabled)return;for(var i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.off(this._dragStartTarget,L.Draggable.START[i],this._onDown,this);this._enabled=false;this._moved=false;},_onDown:function(e){if(e.shiftKey||((e.which!==1)&&(e.button!==1)&&!e.touches))return;L.DomEvent.stopPropagation(e);if(L.Draggable._disabled)return;L.DomUtil.disableImageDrag();var first=e.touches?e.touches[0]:e,el=first.target;if(L.Browser.touch&&el.tagName.toLowerCase()==='a')L.DomUtil.addClass(el,'leaflet-active');this._moved=false;if(this._moving)return;this._startPoint=new L.Point(first.clientX,first.clientY);this._startPos=this._newPos=L.DomUtil.getPosition(this._element);L.DomEvent.on(document,L.Draggable.MOVE[e.type],this._onMove,this).on(document,L.Draggable.END[e.type],this._onUp,this);},_onMove:function(e){if(e.touches&&e.touches.length>1)return;var first=(e.touches&&e.touches.length===1?e.touches[0]:e),newPoint=new L.Point(first.clientX,first.clientY),offset=newPoint.subtract(this._startPoint);if(!offset.x&&!offset.y)return;L.DomEvent.preventDefault(e);if(!this._moved){this.fire('dragstart');this._moved=true;this._startPos=L.DomUtil.getPosition(this._element).subtract(offset);if(!L.Browser.touch){L.DomUtil.disableTextSelection();L.DomUtil.addClass(document.body,'leaflet-dragging');}}this._newPos=this._startPos.add(offset);this._moving=true;L.Util.cancelAnimFrame(this._animRequest);this._animRequest=L.Util.requestAnimFrame(this._updatePosition,this,true,this._dragStartTarget);},_updatePosition:function(){this.fire('predrag');L.DomUtil.setPosition(this._element,this._newPos);this.fire('drag');},_onUp:function(){if(!L.Browser.touch){L.DomUtil.enableTextSelection();L.DomUtil.removeClass(document.body,'leaflet-dragging');}for(var i in L.Draggable.MOVE)L.DomEvent.off(document,L.Draggable.MOVE[i],this._onMove).off(document,L.Draggable.END[i],this._onUp);L.DomUtil.enableImageDrag();if(this._moved){L.Util.cancelAnimFrame(this._animRequest);this.fire('dragend');}this._moving=false;}});L.Handler=L.Class.extend({initialize:function(map){this._map=map;},enable:function(){if(this._enabled)return;this._enabled=true;this.addHooks();},disable:function(){if(!this._enabled)return;this._enabled=false;this.removeHooks();},enabled:function(){return !!this._enabled;}});L.Map.mergeOptions({dragging:true,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:L.Browser.touch?32:18,easeLinearity:0.25,worldCopyJump:false});L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var map=this._map;this._draggable=new L.Draggable(map._mapPane,map._container);this._draggable.on({'dragstart':this._onDragStart,'drag':this._onDrag,'dragend':this._onDragEnd},this);if(map.options.worldCopyJump){this._draggable.on('predrag',this._onPreDrag,this);map.on('viewreset',this._onViewReset,this);}}this._draggable.enable();},removeHooks:function(){this._draggable.disable();},moved:function(){return this._draggable&&this._draggable._moved;},_onDragStart:function(){var map=this._map;if(map._panAnim)map._panAnim.stop();map.fire('movestart').fire('dragstart');if(map.options.inertia){this._positions=[];this._times=[];}},_onDrag:function(){if(this._map.options.inertia){var time=this._lastTime=+new Date(),pos=this._lastPos=this._draggable._newPos;this._positions.push(pos);this._times.push(time);if(time-this._times[0]>200){this._positions.shift();this._times.shift();}}this._map.fire('move').fire('drag');},_onViewReset:function(){var pxCenter=this._map.getSize()._divideBy(2),pxWorldCenter=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=pxWorldCenter.subtract(pxCenter).x;this._worldWidth=this._map.project([0,180]).x;},_onPreDrag:function(){var worldWidth=this._worldWidth,halfWidth=Math.round(worldWidth/2),dx=this._initialWorldOffset,x=this._draggable._newPos.x,newX1=(x-halfWidth+dx)%worldWidth+halfWidth-dx,newX2=(x+halfWidth+dx)%worldWidth-halfWidth-dx,newX=Math.abs(newX1+dx)<Math.abs(newX2+dx)?newX1:newX2;this._draggable._newPos.x=newX;},_onDragEnd:function(){var map=this._map,options=map.options,delay=+new Date()-this._lastTime,noInertia=!options.inertia||delay>options.inertiaThreshold||!this._positions[0];map.fire('dragend');if(noInertia)map.fire('moveend');else{var direction=this._lastPos.subtract(this._positions[0]),duration=(this._lastTime+delay-this._times[0])/1000,ease=options.easeLinearity,speedVector=direction.multiplyBy(ease/duration),speed=speedVector.distanceTo([0,0]),limitedSpeed=Math.min(options.inertiaMaxSpeed,speed),limitedSpeedVector=speedVector.multiplyBy(limitedSpeed/speed),decelerationDuration=limitedSpeed/(options.inertiaDeceleration*ease),offset=limitedSpeedVector.multiplyBy(-decelerationDuration/2).round();if(!offset.x||!offset.y)map.fire('moveend');else L.Util.requestAnimFrame(function(){map.panBy(offset,{duration:decelerationDuration,easeLinearity:ease,noMoveStart:true});});}}});L.Map.addInitHook('addHandler','dragging',L.Map.Drag);L.Map.mergeOptions({doubleClickZoom:true});L.Map.DoubleClickZoom=L.Handler.extend({addHooks:function(){this._map.on('dblclick',this._onDoubleClick);},removeHooks:function(){this._map.off('dblclick',this._onDoubleClick);},_onDoubleClick:function(e){this.setZoomAround(e.containerPoint,this._zoom+1);}});L.Map.addInitHook('addHandler','doubleClickZoom',L.Map.DoubleClickZoom);L.Map.mergeOptions({scrollWheelZoom:true});L.Map.ScrollWheelZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,'mousewheel',this._onWheelScroll,this);L.DomEvent.on(this._map._container,'MozMousePixelScroll',L.DomEvent.preventDefault);this._delta=0;},removeHooks:function(){L.DomEvent.off(this._map._container,'mousewheel',this._onWheelScroll);L.DomEvent.off(this._map._container,'MozMousePixelScroll',L.DomEvent.preventDefault);},_onWheelScroll:function(e){var delta=L.DomEvent.getWheelDelta(e);this._delta+=delta;this._lastMousePos=this._map.mouseEventToContainerPoint(e);if(!this._startTime)this._startTime=+new Date();var left=Math.max(40-(+new Date()-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(L.bind(this._performZoom,this),left);L.DomEvent.preventDefault(e);L.DomEvent.stopPropagation(e);},_performZoom:function(){var map=this._map,delta=this._delta,zoom=map.getZoom();delta=delta>0?Math.ceil(delta):Math.floor(delta);delta=Math.max(Math.min(delta,4),-4);delta=map._limitZoom(zoom+delta)-zoom;this._delta=0;this._startTime=null;if(!delta)return;map.setZoomAround(this._lastMousePos,zoom+delta);}});L.Map.addInitHook('addHandler','scrollWheelZoom',L.Map.ScrollWheelZoom);L.extend(L.DomEvent,{_touchstart:L.Browser.msTouch?'MSPointerDown':'touchstart',_touchend:L.Browser.msTouch?'MSPointerUp':'touchend',addDoubleTapListener:function(obj,handler,id){var last,doubleTap=false,delay=250,touch,pre='_leaflet_',touchstart=this._touchstart,touchend=this._touchend,trackedTouches=[];function onTouchStart(e){var count;if(L.Browser.msTouch){trackedTouches.push(e.pointerId);count=trackedTouches.length;}else count=e.touches.length;if(count>1)return;var now=Date.now(),delta=now-(last||now);touch=e.touches?e.touches[0]:e;doubleTap=(delta>0&&delta<=delay);last=now;}function onTouchEnd(e){if(L.Browser.msTouch){var idx=trackedTouches.indexOf(e.pointerId);if(idx===-1)return;trackedTouches.splice(idx,1);}if(doubleTap){if(L.Browser.msTouch){var newTouch={},prop;for(var i in touch){prop=touch[i];if(typeof prop==='function')newTouch[i]=prop.bind(touch);else newTouch[i]=prop;}touch=newTouch;}touch.type='dblclick';handler(touch);last=null;}}obj[pre+touchstart+id]=onTouchStart;obj[pre+touchend+id]=onTouchEnd;var endElement=L.Browser.msTouch?document.documentElement:obj;obj.addEventListener(touchstart,onTouchStart,false);endElement.addEventListener(touchend,onTouchEnd,false);if(L.Browser.msTouch)endElement.addEventListener('MSPointerCancel',onTouchEnd,false);return this;},removeDoubleTapListener:function(obj,id){var pre='_leaflet_';obj.removeEventListener(this._touchstart,obj[pre+this._touchstart+id],false);(L.Browser.msTouch?document.documentElement:obj).removeEventListener(this._touchend,obj[pre+this._touchend+id],false);if(L.Browser.msTouch)document.documentElement.removeEventListener('MSPointerCancel',obj[pre+this._touchend+id],false);return this;}});L.extend(L.DomEvent,{_msTouches:[],_msDocumentListener:false,addMsTouchListener:function(obj,type,handler,id){switch(type){case 'touchstart':return this.addMsTouchListenerStart(obj,type,handler,id);case 'touchend':return this.addMsTouchListenerEnd(obj,type,handler,id);case 'touchmove':return this.addMsTouchListenerMove(obj,type,handler,id);default:throw 'Unknown touch event type';}},addMsTouchListenerStart:function(obj,type,handler,id){var pre='_leaflet_',touches=this._msTouches;var cb=function(e){var alreadyInArray=false;for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){alreadyInArray=true;break;}if(!alreadyInArray)touches.push(e);e.touches=touches.slice();e.changedTouches=[e];handler(e);};obj[pre+'touchstart'+id]=cb;obj.addEventListener('MSPointerDown',cb,false);if(!this._msDocumentListener){var internalCb=function(e){for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches.splice(i,1);break;}};document.documentElement.addEventListener('MSPointerUp',internalCb,false);document.documentElement.addEventListener('MSPointerCancel',internalCb,false);this._msDocumentListener=true;}return this;},addMsTouchListenerMove:function(obj,type,handler,id){var pre='_leaflet_',touches=this._msTouches;function cb(e){if(e.pointerType===e.MSPOINTER_TYPE_MOUSE&&e.buttons===0)return;for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches[i]=e;break;}e.touches=touches.slice();e.changedTouches=[e];handler(e);}obj[pre+'touchmove'+id]=cb;obj.addEventListener('MSPointerMove',cb,false);return this;},addMsTouchListenerEnd:function(obj,type,handler,id){var pre='_leaflet_',touches=this._msTouches;var cb=function(e){for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches.splice(i,1);break;}e.touches=touches.slice();e.changedTouches=[e];handler(e);};obj[pre+'touchend'+id]=cb;obj.addEventListener('MSPointerUp',cb,false);obj.addEventListener('MSPointerCancel',cb,false);return this;},removeMsTouchListener:function(obj,type,id){var pre='_leaflet_',cb=obj[pre+type+id];switch(type){case 'touchstart':obj.removeEventListener('MSPointerDown',cb,false);break;case 'touchmove':obj.removeEventListener('MSPointerMove',cb,false);break;case 'touchend':obj.removeEventListener('MSPointerUp',cb,false);obj.removeEventListener('MSPointerCancel',cb,false);break;}return this;}});L.Map.mergeOptions({touchZoom:L.Browser.touch&&!L.Browser.android23});L.Map.TouchZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,'touchstart',this._onTouchStart,this);},removeHooks:function(){L.DomEvent.off(this._map._container,'touchstart',this._onTouchStart,this);},_onTouchStart:function(e){var map=this._map;if(!e.touches||e.touches.length!==2||map._animatingZoom||this._zooming)return;var p1=map.mouseEventToLayerPoint(e.touches[0]),p2=map.mouseEventToLayerPoint(e.touches[1]),viewCenter=map._getCenterLayerPoint();this._startCenter=p1.add(p2)._divideBy(2);this._startDist=p1.distanceTo(p2);this._moved=false;this._zooming=true;this._centerOffset=viewCenter.subtract(this._startCenter);if(map._panAnim)map._panAnim.stop();L.DomEvent.on(document,'touchmove',this._onTouchMove,this).on(document,'touchend',this._onTouchEnd,this);L.DomEvent.preventDefault(e);},_onTouchMove:function(e){var map=this._map;if(!e.touches||e.touches.length!==2||!this._zooming)return;var p1=map.mouseEventToLayerPoint(e.touches[0]),p2=map.mouseEventToLayerPoint(e.touches[1]);this._scale=p1.distanceTo(p2)/this._startDist;this._delta=p1._add(p2)._divideBy(2)._subtract(this._startCenter);if(this._scale===1)return;if(!this._moved){L.DomUtil.addClass(map._mapPane,'leaflet-touching');map.fire('movestart').fire('zoomstart');this._moved=true;}L.Util.cancelAnimFrame(this._animRequest);this._animRequest=L.Util.requestAnimFrame(this._updateOnMove,this,true,this._map._container);L.DomEvent.preventDefault(e);},_updateOnMove:function(){var map=this._map,origin=this._getScaleOrigin(),center=map.layerPointToLatLng(origin),zoom=map.getScaleZoom(this._scale);map._animateZoom(center,zoom,this._startCenter,this._scale,this._delta);},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return;}var map=this._map;this._zooming=false;L.DomUtil.removeClass(map._mapPane,'leaflet-touching');L.Util.cancelAnimFrame(this._animRequest);L.DomEvent.off(document,'touchmove',this._onTouchMove).off(document,'touchend',this._onTouchEnd);var origin=this._getScaleOrigin(),center=map.layerPointToLatLng(origin),oldZoom=map.getZoom(),floatZoomDelta=map.getScaleZoom(this._scale)-oldZoom,roundZoomDelta=(floatZoomDelta>0?Math.ceil(floatZoomDelta):Math.floor(floatZoomDelta)),zoom=map._limitZoom(oldZoom+roundZoomDelta),scale=map.getZoomScale(zoom)/this._scale;map._animateZoom(center,zoom,origin,scale);},_getScaleOrigin:function(){var centerOffset=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(centerOffset);}});L.Map.addInitHook('addHandler','touchZoom',L.Map.TouchZoom);L.Map.mergeOptions({tap:true,tapTolerance:15});L.Map.Tap=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,'touchstart',this._onDown,this);},removeHooks:function(){L.DomEvent.off(this._map._container,'touchstart',this._onDown,this);},_onDown:function(e){if(!e.touches)return;L.DomEvent.preventDefault(e);this._fireClick=true;if(e.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return;}var first=e.touches[0],el=first.target;this._startPos=this._newPos=new L.Point(first.clientX,first.clientY);if(el.tagName.toLowerCase()==='a')L.DomUtil.addClass(el,'leaflet-active');this._holdTimeout=setTimeout(L.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent('contextmenu',first);}},this),1000);L.DomEvent.on(document,'touchmove',this._onMove,this).on(document,'touchend',this._onUp,this);},_onUp:function(e){clearTimeout(this._holdTimeout);L.DomEvent.off(document,'touchmove',this._onMove,this).off(document,'touchend',this._onUp,this);if(this._fireClick&&e&&e.changedTouches){var first=e.changedTouches[0],el=first.target;if(el.tagName.toLowerCase()==='a')L.DomUtil.removeClass(el,'leaflet-active');if(this._isTapValid())this._simulateEvent('click',first);}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance;},_onMove:function(e){var first=e.touches[0];this._newPos=new L.Point(first.clientX,first.clientY);},_simulateEvent:function(type,e){var simulatedEvent=document.createEvent('MouseEvents');simulatedEvent._simulated=true;e.target._simulatedClick=true;simulatedEvent.initMouseEvent(type,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(simulatedEvent);}});if(L.Browser.touch&&!L.Browser.msTouch)L.Map.addInitHook('addHandler','tap',L.Map.Tap);L.Map.mergeOptions({boxZoom:true});L.Map.BoxZoom=L.Handler.extend({initialize:function(map){this._map=map;this._container=map._container;this._pane=map._panes.overlayPane;},addHooks:function(){L.DomEvent.on(this._container,'mousedown',this._onMouseDown,this);},removeHooks:function(){L.DomEvent.off(this._container,'mousedown',this._onMouseDown);},_onMouseDown:function(e){if(!e.shiftKey||((e.which!==1)&&(e.button!==1)))return false;L.DomUtil.disableTextSelection();L.DomUtil.disableImageDrag();this._startLayerPoint=this._map.mouseEventToLayerPoint(e);this._box=L.DomUtil.create('div','leaflet-zoom-box',this._pane);L.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor='crosshair';L.DomEvent.on(document,'mousemove',this._onMouseMove,this).on(document,'mouseup',this._onMouseUp,this).on(document,'keydown',this._onKeyDown,this);this._map.fire('boxzoomstart');},_onMouseMove:function(e){var startPoint=this._startLayerPoint,box=this._box,layerPoint=this._map.mouseEventToLayerPoint(e),offset=layerPoint.subtract(startPoint),newPos=new L.Point(Math.min(layerPoint.x,startPoint.x),Math.min(layerPoint.y,startPoint.y));L.DomUtil.setPosition(box,newPos);box.style.width=(Math.max(0,Math.abs(offset.x)-4))+'px';box.style.height=(Math.max(0,Math.abs(offset.y)-4))+'px';},_finish:function(){this._pane.removeChild(this._box);this._container.style.cursor='';L.DomUtil.enableTextSelection();L.DomUtil.enableImageDrag();L.DomEvent.off(document,'mousemove',this._onMouseMove).off(document,'mouseup',this._onMouseUp).off(document,'keydown',this._onKeyDown);},_onMouseUp:function(e){this._finish();var map=this._map,layerPoint=map.mouseEventToLayerPoint(e);if(this._startLayerPoint.equals(layerPoint))return;var bounds=new L.LatLngBounds(map.layerPointToLatLng(this._startLayerPoint),map.layerPointToLatLng(layerPoint));map.fitBounds(bounds);map.fire('boxzoomend',{boxZoomBounds:bounds});},_onKeyDown:function(e){if(e.keyCode===27)this._finish();}});L.Map.addInitHook('addHandler','boxZoom',L.Map.BoxZoom);L.Map.mergeOptions({keyboard:true,keyboardPanOffset:80,keyboardZoomOffset:1});L.Map.Keyboard=L.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61],zoomOut:[189,109,173]},initialize:function(map){this._map=map;this._setPanOffset(map.options.keyboardPanOffset);this._setZoomOffset(map.options.keyboardZoomOffset);},addHooks:function(){var container=this._map._container;if(container.tabIndex===-1)container.tabIndex='0';L.DomEvent.on(container,'focus',this._onFocus,this).on(container,'blur',this._onBlur,this).on(container,'mousedown',this._onMouseDown,this);this._map.on('focus',this._addHooks,this).on('blur',this._removeHooks,this);},removeHooks:function(){this._removeHooks();var container=this._map._container;L.DomEvent.off(container,'focus',this._onFocus,this).off(container,'blur',this._onBlur,this).off(container,'mousedown',this._onMouseDown,this);this._map.off('focus',this._addHooks,this).off('blur',this._removeHooks,this);},_onMouseDown:function(){if(this._focused)return;var body=document.body,docEl=document.documentElement,top=body.scrollTop||docEl.scrollTop,left=body.scrollTop||docEl.scrollLeft;this._map._container.focus();window.scrollTo(left,top);},_onFocus:function(){this._focused=true;this._map.fire('focus');},_onBlur:function(){this._focused=false;this._map.fire('blur');},_setPanOffset:function(pan){var keys=this._panKeys={},codes=this.keyCodes,i,len;for(i=0,len=codes.left.length;i<len;i++)keys[codes.left[i]]=[-1*pan,0];for(i=0,len=codes.right.length;i<len;i++)keys[codes.right[i]]=[pan,0];for(i=0,len=codes.down.length;i<len;i++)keys[codes.down[i]]=[0,pan];for(i=0,len=codes.up.length;i<len;i++)keys[codes.up[i]]=[0,-1*pan];},_setZoomOffset:function(zoom){var keys=this._zoomKeys={},codes=this.keyCodes,i,len;for(i=0,len=codes.zoomIn.length;i<len;i++)keys[codes.zoomIn[i]]=zoom;for(i=0,len=codes.zoomOut.length;i<len;i++)keys[codes.zoomOut[i]]=-zoom;},_addHooks:function(){L.DomEvent.on(document,'keydown',this._onKeyDown,this);},_removeHooks:function(){L.DomEvent.off(document,'keydown',this._onKeyDown,this);},_onKeyDown:function(e){var key=e.keyCode,map=this._map;if(key in this._panKeys){if(map._panAnim&&map._panAnim._inProgress)return;map.panBy(this._panKeys[key]);if(map.options.maxBounds)map.panInsideBounds(map.options.maxBounds);}else if(key in this._zoomKeys)map.setZoom(map.getZoom()+this._zoomKeys[key]);else return;L.DomEvent.stop(e);}});L.Map.addInitHook('addHandler','keyboard',L.Map.Keyboard);L.Handler.MarkerDrag=L.Handler.extend({initialize:function(marker){this._marker=marker;},addHooks:function(){var icon=this._marker._icon;if(!this._draggable)this._draggable=new L.Draggable(icon,icon);this._draggable.on('dragstart',this._onDragStart,this).on('drag',this._onDrag,this).on('dragend',this._onDragEnd,this);this._draggable.enable();},removeHooks:function(){this._draggable.off('dragstart',this._onDragStart,this).off('drag',this._onDrag,this).off('dragend',this._onDragEnd,this);this._draggable.disable();},moved:function(){return this._draggable&&this._draggable._moved;},_onDragStart:function(){this._marker.closePopup().fire('movestart').fire('dragstart');},_onDrag:function(){var marker=this._marker,shadow=marker._shadow,iconPos=L.DomUtil.getPosition(marker._icon),latlng=marker._map.layerPointToLatLng(iconPos);if(shadow)L.DomUtil.setPosition(shadow,iconPos);marker._latlng=latlng;marker.fire('move',{latlng:latlng}).fire('drag');},_onDragEnd:function(){this._marker.fire('moveend').fire('dragend');}});L.Control=L.Class.extend({options:{position:'topright'},initialize:function(options){L.setOptions(this,options);},getPosition:function(){return this.options.position;},setPosition:function(position){var map=this._map;if(map)map.removeControl(this);this.options.position=position;if(map)map.addControl(this);return this;},getContainer:function(){return this._container;},addTo:function(map){this._map=map;var container=this._container=this.onAdd(map),pos=this.getPosition(),corner=map._controlCorners[pos];L.DomUtil.addClass(container,'leaflet-control');if(pos.indexOf('bottom')!==-1)corner.insertBefore(container,corner.firstChild);else corner.appendChild(container);return this;},removeFrom:function(map){var pos=this.getPosition(),corner=map._controlCorners[pos];corner.removeChild(this._container);this._map=null;if(this.onRemove)this.onRemove(map);return this;}});L.control=function(options){return new L.Control(options);};L.Map.include({addControl:function(control){control.addTo(this);return this;},removeControl:function(control){control.removeFrom(this);return this;},_initControlPos:function(){var corners=this._controlCorners={},l='leaflet-',container=this._controlContainer=L.DomUtil.create('div',l+'control-container',this._container);function createCorner(vSide,hSide){var className=l+vSide+' '+l+hSide;corners[vSide+hSide]=L.DomUtil.create('div',className,container);}createCorner('top','left');createCorner('top','right');createCorner('bottom','left');createCorner('bottom','right');},_clearControlPos:function(){this._container.removeChild(this._controlContainer);}});L.Control.Zoom=L.Control.extend({options:{position:'topleft'},onAdd:function(map){var zoomName='leaflet-control-zoom',container=L.DomUtil.create('div',zoomName+' leaflet-bar');this._map=map;this._zoomInButton=this._createButton('+','Zoom in',zoomName+'-in',container,this._zoomIn,this);this._zoomOutButton=this._createButton('-','Zoom out',zoomName+'-out',container,this._zoomOut,this);map.on('zoomend zoomlevelschange',this._updateDisabled,this);return container;},onRemove:function(map){map.off('zoomend zoomlevelschange',this._updateDisabled,this);},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1);},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1);},_createButton:function(html,title,className,container,fn,context){var link=L.DomUtil.create('a',className,container);link.innerHTML=html;link.href='#';link.title=title;var stop=L.DomEvent.stopPropagation;L.DomEvent.on(link,'click',stop).on(link,'mousedown',stop).on(link,'dblclick',stop).on(link,'click',L.DomEvent.preventDefault).on(link,'click',fn,context);return link;},_updateDisabled:function(){var map=this._map,className='leaflet-disabled';L.DomUtil.removeClass(this._zoomInButton,className);L.DomUtil.removeClass(this._zoomOutButton,className);if(map._zoom===map.getMinZoom())L.DomUtil.addClass(this._zoomOutButton,className);if(map._zoom===map.getMaxZoom())L.DomUtil.addClass(this._zoomInButton,className);}});L.Map.mergeOptions({zoomControl:true});L.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new L.Control.Zoom();this.addControl(this.zoomControl);}});L.control.zoom=function(options){return new L.Control.Zoom(options);};L.Control.Attribution=L.Control.extend({options:{position:'bottomright',prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(options){L.setOptions(this,options);this._attributions={};},onAdd:function(map){this._container=L.DomUtil.create('div','leaflet-control-attribution');L.DomEvent.disableClickPropagation(this._container);map.on('layeradd',this._onLayerAdd,this).on('layerremove',this._onLayerRemove,this);this._update();return this._container;},onRemove:function(map){map.off('layeradd',this._onLayerAdd).off('layerremove',this._onLayerRemove);},setPrefix:function(prefix){this.options.prefix=prefix;this._update();return this;},addAttribution:function(text){if(!text)return;if(!this._attributions[text])this._attributions[text]=0;this._attributions[text]++;this._update();return this;},removeAttribution:function(text){if(!text)return;if(this._attributions[text]){this._attributions[text]--;this._update();}return this;},_update:function(){if(!this._map)return;var attribs=[];for(var i in this._attributions)if(this._attributions[i])attribs.push(i);var prefixAndAttribs=[];if(this.options.prefix)prefixAndAttribs.push(this.options.prefix);if(attribs.length)prefixAndAttribs.push(attribs.join(', '));this._container.innerHTML=prefixAndAttribs.join(' | ');},_onLayerAdd:function(e){if(e.layer.getAttribution)this.addAttribution(e.layer.getAttribution());},_onLayerRemove:function(e){if(e.layer.getAttribution)this.removeAttribution(e.layer.getAttribution());}});L.Map.mergeOptions({attributionControl:true});L.Map.addInitHook(function(){if(this.options.attributionControl)this.attributionControl=new L.Control.Attribution().addTo(this);});L.control.attribution=function(options){return new L.Control.Attribution(options);};L.Control.Scale=L.Control.extend({options:{position:'bottomleft',maxWidth:100,metric:true,imperial:true,updateWhenIdle:false},onAdd:function(map){this._map=map;var className='leaflet-control-scale',container=L.DomUtil.create('div',className),options=this.options;this._addScales(options,className,container);map.on(options.updateWhenIdle?'moveend':'move',this._update,this);map.whenReady(this._update,this);return container;},onRemove:function(map){map.off(this.options.updateWhenIdle?'moveend':'move',this._update,this);},_addScales:function(options,className,container){if(options.metric)this._mScale=L.DomUtil.create('div',className+'-line',container);if(options.imperial)this._iScale=L.DomUtil.create('div',className+'-line',container);},_update:function(){var bounds=this._map.getBounds(),centerLat=bounds.getCenter().lat,halfWorldMeters=6378137*Math.PI*Math.cos(centerLat*Math.PI/180),dist=halfWorldMeters*(bounds.getNorthEast().lng-bounds.getSouthWest().lng)/180,size=this._map.getSize(),options=this.options,maxMeters=0;if(size.x>0)maxMeters=dist*(options.maxWidth/size.x);this._updateScales(options,maxMeters);},_updateScales:function(options,maxMeters){if(options.metric&&maxMeters)this._updateMetric(maxMeters);if(options.imperial&&maxMeters)this._updateImperial(maxMeters);},_updateMetric:function(maxMeters){var meters=this._getRoundNum(maxMeters);this._mScale.style.width=this._getScaleWidth(meters/maxMeters)+'px';this._mScale.innerHTML=meters<1000?meters+' m':(meters/1000)+' km';},_updateImperial:function(maxMeters){var maxFeet=maxMeters*3.2808399,scale=this._iScale,maxMiles,miles,feet;if(maxFeet>5280){maxMiles=maxFeet/5280;miles=this._getRoundNum(maxMiles);scale.style.width=this._getScaleWidth(miles/maxMiles)+'px';scale.innerHTML=miles+' mi';}else{feet=this._getRoundNum(maxFeet);scale.style.width=this._getScaleWidth(feet/maxFeet)+'px';scale.innerHTML=feet+' ft';}},_getScaleWidth:function(ratio){return Math.round(this.options.maxWidth*ratio)-10;},_getRoundNum:function(num){var pow10=Math.pow(10,(Math.floor(num)+'').length-1),d=num/pow10;d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1;return pow10*d;}});L.control.scale=function(options){return new L.Control.Scale(options);};L.Control.Layers=L.Control.extend({options:{collapsed:true,position:'topright',autoZIndex:true},initialize:function(baseLayers,overlays,options){L.setOptions(this,options);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(var i in baseLayers)this._addLayer(baseLayers[i],i);for(i in overlays)this._addLayer(overlays[i],i,true);},onAdd:function(map){this._initLayout();this._update();map.on('layeradd',this._onLayerChange,this).on('layerremove',this._onLayerChange,this);return this._container;},onRemove:function(map){map.off('layeradd',this._onLayerChange).off('layerremove',this._onLayerChange);},addBaseLayer:function(layer,name){this._addLayer(layer,name);this._update();return this;},addOverlay:function(layer,name){this._addLayer(layer,name,true);this._update();return this;},removeLayer:function(layer){var id=L.stamp(layer);delete this._layers[id];this._update();return this;},_initLayout:function(){var className='leaflet-control-layers',container=this._container=L.DomUtil.create('div',className);container.setAttribute('aria-haspopup',true);if(!L.Browser.touch){L.DomEvent.disableClickPropagation(container);L.DomEvent.on(container,'mousewheel',L.DomEvent.stopPropagation);}else L.DomEvent.on(container,'click',L.DomEvent.stopPropagation);var form=this._form=L.DomUtil.create('form',className+'-list');if(this.options.collapsed){if(!L.Browser.android)L.DomEvent.on(container,'mouseover',this._expand,this).on(container,'mouseout',this._collapse,this);var link=this._layersLink=L.DomUtil.create('a',className+'-toggle',container);link.href='#';link.title='Layers';if(L.Browser.touch)L.DomEvent.on(link,'click',L.DomEvent.stop).on(link,'click',this._expand,this);else L.DomEvent.on(link,'focus',this._expand,this);this._map.on('click',this._collapse,this);}else this._expand();this._baseLayersList=L.DomUtil.create('div',className+'-base',form);this._separator=L.DomUtil.create('div',className+'-separator',form);this._overlaysList=L.DomUtil.create('div',className+'-overlays',form);container.appendChild(form);},_addLayer:function(layer,name,overlay){var id=L.stamp(layer);this._layers[id]={layer:layer,name:name,overlay:overlay};if(this.options.autoZIndex&&layer.setZIndex){this._lastZIndex++;layer.setZIndex(this._lastZIndex);}},_update:function(){if(!this._container)return;this._baseLayersList.innerHTML='';this._overlaysList.innerHTML='';var baseLayersPresent=false,overlaysPresent=false,i,obj;for(i in this._layers){obj=this._layers[i];this._addItem(obj);overlaysPresent=overlaysPresent||obj.overlay;baseLayersPresent=baseLayersPresent||!obj.overlay;}this._separator.style.display=overlaysPresent&&baseLayersPresent?'':'none';},_onLayerChange:function(e){var obj=this._layers[L.stamp(e.layer)];if(!obj)return;if(!this._handlingClick)this._update();var type=obj.overlay?(e.type==='layeradd'?'overlayadd':'overlayremove'):(e.type==='layeradd'?'baselayerchange':null);if(type)this._map.fire(type,obj);},_createRadioElement:function(name,checked){var radioHtml='<input type="radio" class="leaflet-control-layers-selector" name="'+name+'"';if(checked)radioHtml+=' checked="checked"';radioHtml+='/>';var radioFragment=document.createElement('div');radioFragment.innerHTML=radioHtml;return radioFragment.firstChild;},_addItem:function(obj){var label=document.createElement('label'),input,checked=this._map.hasLayer(obj.layer);if(obj.overlay){input=document.createElement('input');input.type='checkbox';input.className='leaflet-control-layers-selector';input.defaultChecked=checked;}else input=this._createRadioElement('leaflet-base-layers',checked);input.layerId=L.stamp(obj.layer);L.DomEvent.on(input,'click',this._onInputClick,this);var name=document.createElement('span');name.innerHTML=' '+obj.name;label.appendChild(input);label.appendChild(name);var container=obj.overlay?this._overlaysList:this._baseLayersList;container.appendChild(label);return label;},_onInputClick:function(){var i,input,obj,inputs=this._form.getElementsByTagName('input'),inputsLen=inputs.length;this._handlingClick=true;for(i=0;i<inputsLen;i++){input=inputs[i];obj=this._layers[input.layerId];if(input.checked&&!this._map.hasLayer(obj.layer))this._map.addLayer(obj.layer);else if(!input.checked&&this._map.hasLayer(obj.layer))this._map.removeLayer(obj.layer);}this._handlingClick=false;},_expand:function(){L.DomUtil.addClass(this._container,'leaflet-control-layers-expanded');},_collapse:function(){this._container.className=this._container.className.replace(' leaflet-control-layers-expanded','');}});L.control.layers=function(baseLayers,overlays,options){return new L.Control.Layers(baseLayers,overlays,options);};L.PosAnimation=L.Class.extend({includes:L.Mixin.Events,run:function(el,newPos,duration,easeLinearity){this.stop();this._el=el;this._inProgress=true;this._newPos=newPos;this.fire('start');el.style[L.DomUtil.TRANSITION]='all '+(duration||0.25)+'s cubic-bezier(0,0,'+(easeLinearity||0.5)+',1)';L.DomEvent.on(el,L.DomUtil.TRANSITION_END,this._onTransitionEnd,this);L.DomUtil.setPosition(el,newPos);L.Util.falseFn(el.offsetWidth);this._stepTimer=setInterval(L.bind(this._onStep,this),50);},stop:function(){if(!this._inProgress)return;L.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();L.Util.falseFn(this._el.offsetWidth);},_onStep:function(){this._el._leaflet_pos=this._getPos();this.fire('step');},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var left,top,matches,el=this._el,style=window.getComputedStyle(el);if(L.Browser.any3d){matches=style[L.DomUtil.TRANSFORM].match(this._transformRe);left=matches?parseFloat(matches[1]):0;top=matches?parseFloat(matches[2]):0;}else{left=parseFloat(style.left);top=parseFloat(style.top);}return new L.Point(left,top,true);},_onTransitionEnd:function(){L.DomEvent.off(this._el,L.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress)return;this._inProgress=false;this._el.style[L.DomUtil.TRANSITION]='';this._el._leaflet_pos=this._newPos;clearInterval(this._stepTimer);this.fire('step').fire('end');}});L.Map.include({setView:function(center,zoom,options){zoom=this._limitZoom(zoom);center=L.latLng(center);options=options||{};if(this._panAnim)this._panAnim.stop();if(this._loaded&&!options.reset&&options!==true){if(options.animate!==undefined){options.zoom=L.extend({animate:options.animate},options.zoom);options.pan=L.extend({animate:options.animate},options.pan);}var animated=(this._zoom!==zoom)?this._tryAnimatedZoom&&this._tryAnimatedZoom(center,zoom,options.zoom):this._tryAnimatedPan(center,options.pan);if(animated){clearTimeout(this._sizeTimer);return this;}}this._resetView(center,zoom);return this;},panBy:function(offset,options){offset=L.point(offset).round();options=options||{};if(!offset.x&&!offset.y)return this;if(!this._panAnim){this._panAnim=new L.PosAnimation();this._panAnim.on({'step':this._onPanTransitionStep,'end':this._onPanTransitionEnd},this);}if(!options.noMoveStart)this.fire('movestart');if(options.animate!==false){L.DomUtil.addClass(this._mapPane,'leaflet-pan-anim');var newPos=this._getMapPanePos().subtract(offset);this._panAnim.run(this._mapPane,newPos,options.duration||0.25,options.easeLinearity);}else{this._rawPanBy(offset);this.fire('move').fire('moveend');}return this;},_onPanTransitionStep:function(){this.fire('move');},_onPanTransitionEnd:function(){L.DomUtil.removeClass(this._mapPane,'leaflet-pan-anim');this.fire('moveend');},_tryAnimatedPan:function(center,options){var offset=this._getCenterOffset(center)._floor();if((options&&options.animate)!==true&&!this.getSize().contains(offset))return false;this.panBy(offset,options);return true;}});L.PosAnimation=L.DomUtil.TRANSITION?L.PosAnimation:L.PosAnimation.extend({run:function(el,newPos,duration,easeLinearity){this.stop();this._el=el;this._inProgress=true;this._duration=duration||0.25;this._easeOutPower=1/Math.max(easeLinearity||0.5,0.2);this._startPos=L.DomUtil.getPosition(el);this._offset=newPos.subtract(this._startPos);this._startTime=+new Date();this.fire('start');this._animate();},stop:function(){if(!this._inProgress)return;this._step();this._complete();},_animate:function(){this._animId=L.Util.requestAnimFrame(this._animate,this);this._step();},_step:function(){var elapsed=(+new Date())-this._startTime,duration=this._duration*1000;if(elapsed<duration)this._runFrame(this._easeOut(elapsed/duration));else{this._runFrame(1);this._complete();}},_runFrame:function(progress){var pos=this._startPos.add(this._offset.multiplyBy(progress));L.DomUtil.setPosition(this._el,pos);this.fire('step');},_complete:function(){L.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire('end');},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower);}});L.Map.mergeOptions({zoomAnimation:true,zoomAnimationThreshold:4});if(L.DomUtil.TRANSITION)L.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&L.DomUtil.TRANSITION&&L.Browser.any3d&&!L.Browser.android23&&!L.Browser.mobileOpera;if(this._zoomAnimated)L.DomEvent.on(this._mapPane,L.DomUtil.TRANSITION_END,this._catchTransitionEnd,this);});L.Map.include(!L.DomUtil.TRANSITION?{}:{_catchTransitionEnd:function(){if(this._animatingZoom)this._onZoomTransitionEnd();},_tryAnimatedZoom:function(center,zoom,options){if(this._animatingZoom)return true;options=options||{};if(!this._zoomAnimated||options.animate===false||Math.abs(zoom-this._zoom)>this.options.zoomAnimationThreshold)return false;var scale=this.getZoomScale(zoom),offset=this._getCenterOffset(center)._divideBy(1-1/scale),origin=this._getCenterLayerPoint()._add(offset);if(options.animate!==true&&!this.getSize().contains(offset))return false;this.fire('movestart').fire('zoomstart');this._animateZoom(center,zoom,origin,scale,null,true);return true;},_animateZoom:function(center,zoom,origin,scale,delta,backwards){this._animatingZoom=true;L.DomUtil.addClass(this._mapPane,'leaflet-zoom-anim');this._animateToCenter=center;this._animateToZoom=zoom;if(L.Draggable)L.Draggable._disabled=true;this.fire('zoomanim',{center:center,zoom:zoom,origin:origin,scale:scale,delta:delta,backwards:backwards});},_onZoomTransitionEnd:function(){this._animatingZoom=false;L.DomUtil.removeClass(this._mapPane,'leaflet-zoom-anim');this._resetView(this._animateToCenter,this._animateToZoom,true,true);if(L.Draggable)L.Draggable._disabled=false;}});L.TileLayer.include({_animateZoom:function(e){var firstFrame=false;if(!this._animating){this._animating=true;firstFrame=true;}if(firstFrame)this._prepareBgBuffer();var bg=this._bgBuffer;if(firstFrame){clearTimeout(this._clearBgBufferTimer);L.Util.falseFn(bg.offsetWidth);}var transform=L.DomUtil.TRANSFORM,initialTransform=e.delta?L.DomUtil.getTranslateString(e.delta):bg.style[transform],scaleStr=L.DomUtil.getScaleString(e.scale,e.origin);bg.style[transform]=e.backwards?scaleStr+' '+initialTransform:initialTransform+' '+scaleStr;},_endZoomAnim:function(){var front=this._tileContainer,bg=this._bgBuffer;front.style.visibility='';front.style.zIndex=2;bg.style.zIndex=1;L.Util.falseFn(bg.offsetWidth);this._animating=false;},_clearBgBuffer:function(){var map=this._map;if(map&&!map._animatingZoom&&!map.touchZoom._zooming){this._bgBuffer.innerHTML='';this._bgBuffer.style[L.DomUtil.TRANSFORM]='';}},_prepareBgBuffer:function(){var front=this._tileContainer,bg=this._bgBuffer;var bgLoaded=this._getLoadedTilesPercentage(bg),frontLoaded=this._getLoadedTilesPercentage(front);if(bg&&bgLoaded>0.5&&frontLoaded<0.5){front.style.visibility='hidden';this._stopLoadingImages(front);return;}bg.style.visibility='hidden';bg.style[L.DomUtil.TRANSFORM]='';this._tileContainer=bg;bg=this._bgBuffer=front;this._stopLoadingImages(bg);},_getLoadedTilesPercentage:function(container){var tiles=container.getElementsByTagName('img'),i,len,count=0;for(i=0,len=tiles.length;i<len;i++)if(tiles[i].complete)count++;return count/len;},_stopLoadingImages:function(container){var tiles=Array.prototype.slice.call(container.getElementsByTagName('img')),i,len,tile;for(i=0,len=tiles.length;i<len;i++){tile=tiles[i];if(!tile.complete){tile.onload=L.Util.falseFn;tile.onerror=L.Util.falseFn;tile.src=L.Util.emptyImageUrl;tile.parentNode.removeChild(tile);}}}});L.Map.include({_defaultLocateOptions:{watch:false,setView:false,maxZoom:Infinity,timeout:10000,maximumAge:0,enableHighAccuracy:false},locate:function(options){options=this._locateOptions=L.extend(this._defaultLocateOptions,options);if(!navigator.geolocation){this._handleGeolocationError({code:0,message:'Geolocation not supported.'});return this;}var onResponse=L.bind(this._handleGeolocationResponse,this),onError=L.bind(this._handleGeolocationError,this);if(options.watch)this._locationWatchId=navigator.geolocation.watchPosition(onResponse,onError,options);else navigator.geolocation.getCurrentPosition(onResponse,onError,options);return this;},stopLocate:function(){if(navigator.geolocation)navigator.geolocation.clearWatch(this._locationWatchId);if(this._locateOptions)this._locateOptions.setView=false;return this;},_handleGeolocationError:function(error){var c=error.code,message=error.message||(c===1?'permission denied':(c===2?'position unavailable':'timeout'));if(this._locateOptions.setView&&!this._loaded)this.fitWorld();this.fire('locationerror',{code:c,message:'Geolocation error: '+message+'.'});},_handleGeolocationResponse:function(pos){var lat=pos.coords.latitude,lng=pos.coords.longitude,latlng=new L.LatLng(lat,lng),latAccuracy=180*pos.coords.accuracy/40075017,lngAccuracy=latAccuracy/Math.cos(L.LatLng.DEG_TO_RAD*lat),bounds=L.latLngBounds([lat-latAccuracy,lng-lngAccuracy],[lat+latAccuracy,lng+lngAccuracy]),options=this._locateOptions;if(options.setView){var zoom=Math.min(this.getBoundsZoom(bounds),options.maxZoom);this.setView(latlng,zoom);}var data={latlng:latlng,bounds:bounds};for(var i in pos.coords)if(typeof pos.coords[i]==='number')data[i]=pos.coords[i];this.fire('locationfound',data);}});}(window,document));})();},{}],5:[function(require,module,exports){'use strict';var util=require('./util'),urlhelper=require('./url'),request=require('./request');module.exports=function(_){var geocoder={},url;geocoder.getURL=function(_){return url;};geocoder.setURL=function(_){url=urlhelper.jsonify(_);return geocoder;};geocoder.setID=function(_){geocoder.setURL(urlhelper.base()+_+'/geocode/{query}.json');return geocoder;};geocoder.setTileJSON=function(_){util.strict(_,'object');geocoder.setURL(_.geocoder);return geocoder;};geocoder.queryURL=function(_){return L.Util.template(geocoder.getURL(),{query:encodeURIComponent(_)});};geocoder.query=function(_,callback){request(geocoder.queryURL(_),function(err,json){if(json&&json.results&&json.results.length){var res={results:json.results,latlng:[json.results[0][0].lat,json.results[0][0].lon]};if(json.results[0][0].bounds!==undefined){res.bounds=json.results[0][0].bounds;res.lbounds=util.lbounds(res.bounds);}callback(null,res);}else callback(err);});return geocoder;};geocoder.reverseQuery=function(_,callback){var q='';function norm(x){if(x.lat!==undefined&&x.lng!==undefined)return x.lng+','+x.lat;else if(x.lat!==undefined&&x.lon!==undefined)return x.lon+','+x.lat;else return x[0]+','+x[1];}if(_.length&&_[0].length){for(var i=0,pts=[];i<_.length;i++)pts.push(norm(_[i]));q=pts.join(';');}else q=norm(_);request(geocoder.queryURL(q),function(err,json){callback(err,json);});return geocoder;};if(typeof _==='string')if(_.indexOf('/')==-1)geocoder.setID(_);else geocoder.setURL(_);else if(typeof _==='object')geocoder.setTileJSON(_);return geocoder;};},{"./url":17,"./util":18,"./request":19}],6:[function(require,module,exports){'use strict';var url=require('./url'),sanitize=require('./sanitize');function icon(fp){fp=fp||{};var sizes={small:[20,50],medium:[30,70],large:[35,90]},size=fp['marker-size']||'medium',symbol=fp['marker-symbol']?'-'+fp['marker-symbol']:'',color=(fp['marker-color']||'7e7e7e').replace('#','');return L.icon({iconUrl:url.base()+'marker/'+'pin-'+size.charAt(0)+symbol+'+'+color+((L.Browser.retina)?'@2x':'')+'.png',iconSize:sizes[size],iconAnchor:[sizes[size][0]/2,sizes[size][1]/2],popupAnchor:[0,-sizes[size][1]/2]});}function style(f,latlon){return L.marker(latlon,{icon:icon(f.properties),title:f.properties.title});}function createPopup(f,sanitizer){var popup='<div class="marker-title">'+f.properties.title+'</div>';if(f.properties.description)popup+='<div class="marker-description">'+f.properties.description+'</div>';return(sanitizer||sanitize)(popup);}module.exports={icon:icon,style:style,createPopup:createPopup};},{"./url":17,"./sanitize":20}],7:[function(require,module,exports){'use strict';var util=require('./util'),url=require('./url');var TileLayer=L.TileLayer.extend({includes:[require('./load_tilejson')],options:{format:'png'},formats:['png','png32','png64','png128','png256','jpg70','jpg80','jpg90'],initialize:function(_,options){L.TileLayer.prototype.initialize.call(this,undefined,options);this._tilejson={};if(options&&options.detectRetina&&L.Browser.retina&&options.retinaVersion)_=options.retinaVersion;if(options&&options.format)util.strict_oneof(options.format,this.formats);this._loadTileJSON(_);},setFormat:function(_){util.strict(_,'string');this.options.format=_;this.redraw();return this;},setUrl:null,_setTileJSON:function(json){util.strict(json,'object');L.extend(this.options,{tiles:json.tiles,attribution:json.attribution,minZoom:json.minzoom,maxZoom:json.maxzoom,tms:json.scheme==='tms',bounds:json.bounds&&util.lbounds(json.bounds)});this._tilejson=json;this.redraw();return this;},getTileJSON:function(){return this._tilejson;},getTileUrl:function(tilePoint){var tiles=this.options.tiles,index=Math.abs(tilePoint.x+tilePoint.y)%tiles.length,url=tiles[index];var templated=L.Util.template(url,tilePoint);if(!templated)return templated;else return templated.replace('.png','.'+this.options.format);},_update:function(){if(this.options.tiles)L.TileLayer.prototype._update.call(this);}});module.exports=function(_,options){return new TileLayer(_,options);};},{"./util":18,"./url":17,"./load_tilejson":21}],8:[function(require,module,exports){'use strict';var ShareControl=L.Control.extend({includes:[require('./load_tilejson')],options:{position:'topleft'},initialize:function(_,options){L.setOptions(this,options);this._loadTileJSON(_);},_setTileJSON:function(json){this._tilejson=json;},onAdd:function(map){this._map=map;var container=L.DomUtil.create('div','leaflet-control-mapbox-share leaflet-bar');var link=L.DomUtil.create('a','mapbox-share',container);link.href='#';L.DomEvent.addListener(link,'click',this._share,this);L.DomEvent.disableClickPropagation(container);return container;},_share:function(e){L.DomEvent.stop(e);if(this._popup){this._map.closePopup(this._popup);return;}var tilejson=this._tilejson||this._map._tilejson||{};var twitter='http://twitter.com/intent/tweet?status='+encodeURIComponent(tilejson.name+'\n'+(tilejson.webpage||window.location));var facebook='https://www.facebook.com/sharer.php?u='+encodeURIComponent(tilejson.webpage||window.location)+'&t='+encodeURIComponent(tilejson.name);var share=L.DomUtil.create('div','mapbox-share-popup');share.innerHTML=("<h3>Share this map</h3>"+"<div class='mapbox-share-buttons'><a class='mapbox-share-facebook' target='_blank' href='{{facebook}}'>Facebook</a>"+"<a class='mapbox-share-twitter' target='_blank' href='{{twitter}}'>Twitter</a></div>").replace('{{twitter}}',twitter).replace('{{facebook}}',facebook);share.innerHTML+="<h3>Get the embed code</h3>";share.innerHTML+="<small>Copy and paste this HTML into your website or blog.</small>";var embed=document.createElement('textarea');embed.rows=4;embed.value="<iframe width='500' height='300' frameBorder='0' src='{{embed}}'></iframe>".replace('{{embed}}',tilejson.embed||window.location);L.DomEvent.addListener(embed,'click',function(e){L.DomEvent.stop(e);embed.focus();embed.select();});share.appendChild(embed);this._popup=new L.Popup({className:'mapbox-share-popup'});this._popup.setContent(share).setLatLng(this._map.getCenter()).openOn(this._map).on('close',function(){this._popup=null;},this);}});module.exports=function(_,options){return new ShareControl(_,options);};},{"./load_tilejson":21}],9:[function(require,module,exports){'use strict';var LegendControl=L.Control.extend({options:{position:'bottomright',sanitizer:require('./sanitize')},initialize:function(options){L.setOptions(this,options);this._legends={};},onAdd:function(map){this._container=L.DomUtil.create('div','map-legends');L.DomEvent.disableClickPropagation(this._container);this._update();return this._container;},addLegend:function(text){if(!text)return this;if(!this._legends[text])this._legends[text]=0;this._legends[text]++;return this._update();},removeLegend:function(text){if(!text)return this;if(this._legends[text])this._legends[text]--;return this._update();},_update:function(){if(!this._map)return this;this._container.innerHTML='';var hide='none';for(var i in this._legends)if(this._legends.hasOwnProperty(i)&&this._legends[i]){var div=this._container.appendChild(document.createElement('div'));div.className='map-legend';div.innerHTML=this.options.sanitizer(i);hide='block';}this._container.style.display=hide;return this;}});module.exports=function(options){return new LegendControl(options);};},{"./sanitize":20}],10:[function(require,module,exports){'use strict';var geocoder=require('./geocoder');var GeocoderControl=L.Control.extend({includes:L.Mixin.Events,initialize:function(_){this.geocoder=geocoder(_);},setURL:function(_){this.geocoder.setURL(_);return this;},getURL:function(){return this.geocoder.getURL();},setID:function(_){this.geocoder.setID(_);return this;},setTileJSON:function(_){this.geocoder.setTileJSON(_);return this;},onAdd:function(map){this._map=map;var className='leaflet-control-mapbox-geocoder',container=L.DomUtil.create('div',className);L.DomEvent.disableClickPropagation(container);var form=this._form=L.DomUtil.create('form',className+'-form');L.DomEvent.addListener(form,'submit',this._geocode,this);var input=this._input=document.createElement('input');input.type='text';var submit=this._submit=document.createElement('input');submit.type='submit';submit.className='mapbox-button';submit.value='Locate';form.appendChild(input);form.appendChild(submit);container.appendChild(form);return container;},_geocode:function(event){L.DomEvent.preventDefault(event);L.DomUtil.addClass(this._container,'searching');this.geocoder.query(this._input.value,L.bind(function(err,res){L.DomUtil.removeClass(this._container,'searching');if(err)this.fire('error',{error:err});else{if(res.lbounds)this._map.fitBounds(res.lbounds);else this._map.setView(res.latlng,6);this.fire('found',res);}},this));}});module.exports=function(options){return new GeocoderControl(options);};},{"./geocoder":5}],12:[function(require,module,exports){'use strict';var util=require('./util'),url=require('./url'),request=require('./request'),grid=require('./grid');var GridLayer=L.Class.extend({includes:[L.Mixin.Events,require('./load_tilejson')],options:{template:function(){return '';}},_mouseOn:null,_tilejson:{},_cache:{},initialize:function(_,options){L.Util.setOptions(this,options);this._loadTileJSON(_);},_setTileJSON:function(json){util.strict(json,'object');L.extend(this.options,{grids:json.grids,minZoom:json.minzoom,maxZoom:json.maxzoom,bounds:json.bounds&&util.lbounds(json.bounds)});this._tilejson=json;this._cache={};this._update();return this;},getTileJSON:function(){return this._tilejson;},active:function(){return !!(this._map&&this.options.grids&&this.options.grids.length);},addTo:function(map){map.addLayer(this);return this;},onAdd:function(map){this._map=map;this._update();this._map.on('click',this._click,this).on('mousemove',this._move,this).on('moveend',this._update,this);},onRemove:function(){this._map.off('click',this._click,this).off('mousemove',this._move,this).off('moveend',this._update,this);},getData:function(latlng,callback){if(!this.active())return;var map=this._map,point=map.project(latlng),tileSize=256,resolution=4,x=Math.floor(point.x/tileSize),y=Math.floor(point.y/tileSize),max=map.options.crs.scale(map.getZoom())/tileSize;x=(x+max)%max;y=(y+max)%max;this._getTile(map.getZoom(),x,y,function(grid){var gridX=Math.floor((point.x-(x*tileSize))/resolution),gridY=Math.floor((point.y-(y*tileSize))/resolution);callback(grid(gridX,gridY));});return this;},_click:function(e){this.getData(e.latlng,L.bind(function(data){this.fire('click',{latLng:e.latlng,data:data});},this));},_move:function(e){this.getData(e.latlng,L.bind(function(data){if(data!==this._mouseOn){if(this._mouseOn)this.fire('mouseout',{latLng:e.latlng,data:this._mouseOn});this.fire('mouseover',{latLng:e.latlng,data:data});this._mouseOn=data;}else this.fire('mousemove',{latLng:e.latlng,data:data});},this));},_getTileURL:function(tilePoint){var urls=this.options.grids,index=(tilePoint.x+tilePoint.y)%urls.length,url=urls[index];return L.Util.template(url,tilePoint);},_update:function(){if(!this.active())return;var bounds=this._map.getPixelBounds(),z=this._map.getZoom(),tileSize=256;if(z>this.options.maxZoom||z<this.options.minZoom)return;var nwTilePoint=new L.Point(Math.floor(bounds.min.x/tileSize),Math.floor(bounds.min.y/tileSize)),seTilePoint=new L.Point(Math.floor(bounds.max.x/tileSize),Math.floor(bounds.max.y/tileSize)),max=this._map.options.crs.scale(z)/tileSize;for(var x=nwTilePoint.x;x<=seTilePoint.x;x++)for(var y=nwTilePoint.y;y<=seTilePoint.y;y++){var xw=(x+max)%max,yw=(y+max)%max;this._getTile(z,xw,yw);}},_getTile:function(z,x,y,callback){var key=z+'_'+x+'_'+y,tilePoint=L.point(x,y);tilePoint.z=z;if(!this._tileShouldBeLoaded(tilePoint))return;if(key in this._cache){if(!callback)return;if(typeof this._cache[key]==='function')callback(this._cache[key]);else this._cache[key].push(callback);return;}this._cache[key]=[];if(callback)this._cache[key].push(callback);request(this._getTileURL(tilePoint),L.bind(function(err,json){var callbacks=this._cache[key];this._cache[key]=grid(json);for(var i=0;i<callbacks.length;++i)callbacks[i](this._cache[key]);},this));},_tileShouldBeLoaded:function(tilePoint){if(tilePoint.z>this.options.maxZoom||tilePoint.z<this.options.minZoom)return false;if(this.options.bounds){var tileSize=256,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add(new L.Point(tileSize,tileSize)),nw=this._map.unproject(nwPoint),se=this._map.unproject(sePoint),bounds=new L.LatLngBounds([nw,se]);if(!this.options.bounds.intersects(bounds))return false;}return true;}});module.exports=function(_,options){return new GridLayer(_,options);};},{"./util":18,"./url":17,"./request":19,"./grid":22,"./load_tilejson":21}],13:[function(require,module,exports){'use strict';var util=require('./util');var urlhelper=require('./url');var request=require('./request');var marker=require('./marker');var MarkerLayer=L.FeatureGroup.extend({options:{filter:function(){return true;},sanitizer:require('./sanitize')},initialize:function(_,options){L.setOptions(this,options);this._layers={};if(typeof _==='string')util.idUrl(_,this);else if(_&&typeof _==='object')this.setGeoJSON(_);},setGeoJSON:function(_){this._geojson=_;this.clearLayers();this._initialize(_);},getGeoJSON:function(){return this._geojson;},loadURL:function(url){url=urlhelper.jsonify(url);request(url,L.bind(function(err,json){if(err){util.log('could not load markers at '+url);this.fire('error',{error:err});}else if(json){this.setGeoJSON(json);this.fire('ready');}},this));return this;},loadID:function(id){return this.loadURL(urlhelper.base()+id+'/markers.geojson');},setFilter:function(_){this.options.filter=_;if(this._geojson){this.clearLayers();this._initialize(this._geojson);}return this;},getFilter:function(){return this.options.filter;},_initialize:function(json){var features=L.Util.isArray(json)?json:json.features,i,len;if(features){for(i=0,len=features.length;i<len;i++)if(features[i].geometries||features[i].geometry||features[i].features)this._initialize(features[i]);}else if(this.options.filter(json)){var layer=L.GeoJSON.geometryToLayer(json,marker.style),popupHtml=marker.createPopup(json,this.options.sanitizer);layer.feature=json;layer.bindPopup(popupHtml,{closeButton:false});this.addLayer(layer);}}});module.exports=function(_,options){return new MarkerLayer(_,options);};},{"./util":18,"./url":17,"./request":19,"./marker":6,"./sanitize":20}],14:[function(require,module,exports){'use strict';var util=require('./util'),tileLayer=require('./tile_layer'),markerLayer=require('./marker_layer'),gridLayer=require('./grid_layer'),gridControl=require('./grid_control'),legendControl=require('./legend_control');var Map=L.Map.extend({includes:[require('./load_tilejson')],options:{tileLayer:{},markerLayer:{},gridLayer:{},legendControl:{},gridControl:{}},_tilejson:{},initialize:function(element,_,options){L.Map.prototype.initialize.call(this,element,options);if(this.attributionControl)this.attributionControl.setPrefix('');if(this.options.tileLayer){this.tileLayer=tileLayer(undefined,this.options.tileLayer);this.addLayer(this.tileLayer);}if(this.options.markerLayer){this.markerLayer=markerLayer(undefined,this.options.markerLayer);this.addLayer(this.markerLayer);}if(this.options.gridLayer){this.gridLayer=gridLayer(undefined,this.options.gridLayer);this.addLayer(this.gridLayer);}if(this.options.gridLayer&&this.options.gridControl){this.gridControl=gridControl(this.gridLayer,this.options.gridControl);this.addControl(this.gridControl);}if(this.options.legendControl){this.legendControl=legendControl(this.options.legendControl);this.addControl(this.legendControl);}this._loadTileJSON(_);},addLayer:function(layer){if('on' in layer)layer.on('ready',L.bind(function(){this._updateLayer(layer);},this));return L.Map.prototype.addLayer.call(this,layer);},_setTileJSON:function(_){this._tilejson=_;this._initialize(_);return this;},getTileJSON:function(){return this._tilejson;},_initialize:function(json){if(this.tileLayer){this.tileLayer._setTileJSON(json);this._updateLayer(this.tileLayer);}if(this.markerLayer&&!this.markerLayer.getGeoJSON()&&json.data&&json.data[0])this.markerLayer.loadURL(json.data[0]);if(this.gridLayer){this.gridLayer._setTileJSON(json);this._updateLayer(this.gridLayer);}if(this.legendControl&&json.legend)this.legendControl.addLegend(json.legend);if(!this._loaded){var zoom=json.center[2],center=L.latLng(json.center[1],json.center[0]);this.setView(center,zoom);}},_updateLayer:function(layer){if(!layer.options)return;if(this.attributionControl&&this._loaded)this.attributionControl.addAttribution(layer.options.attribution);if(!(L.stamp(layer) in this._zoomBoundLayers)&&(layer.options.maxZoom||layer.options.minZoom))this._zoomBoundLayers[L.stamp(layer)]=layer;this._updateZoomLevels();}});module.exports=function(element,_,options){return new Map(element,_,options);};},{"./util":18,"./tile_layer":7,"./marker_layer":13,"./grid_layer":12,"./grid_control":11,"./legend_control":9,"./load_tilejson":21}],18:[function(require,module,exports){'use strict';module.exports={idUrl:function(_,t){if(_.indexOf('/')==-1)t.loadID(_);else t.loadURL(_);},log:function(_){if(console&&typeof console.error==='function')console.error(_);},strict:function(_,type){if(typeof _!==type)throw new Error('Invalid argument: '+type+' expected');},strict_instance:function(_,klass,name){if(!(_ instanceof klass))throw new Error('Invalid argument: '+name+' expected');},strict_oneof:function(_,values){if(values.indexOf(_)==-1)throw new Error('Invalid argument: '+_+' given, valid values are '+values.join(', '));},lbounds:function(_){return new L.LatLngBounds([[_[1],_[0]],[_[3],_[2]]]);}};},{}],22:[function(require,module,exports){'use strict';function utfDecode(c){if(c>=93)c--;if(c>=35)c--;return c-32;}module.exports=function(data){return function(x,y){if(!data)return;var idx=utfDecode(data.grid[y].charCodeAt(x)),key=data.keys[idx];return data.data[key];};};},{}],20:[function(require,module,exports){'use strict';var html_sanitize=require('../ext/sanitizer/html-sanitizer-bundle.js');function cleanUrl(url){if(/^https?/.test(url.getScheme()))return url.toString();if('data'==url.getScheme()&&/^image/.test(url.getPath()))return url.toString();}function cleanId(id){return id;}module.exports=function(_){if(!_)return '';return html_sanitize(_,cleanUrl,cleanId);};},{"../ext/sanitizer/html-sanitizer-bundle.js":23}],17:[function(require,module,exports){'use strict';var config=require('./config');module.exports={isSSL:function(){return 'https:'===document.location.protocol||config.FORCE_HTTPS;},base:function(hash){var urls=this.isSSL()?config.HTTPS_URLS:config.HTTP_URLS;if(hash===undefined||typeof hash!=='number')return urls[0];else return urls[hash%urls.length];},secureFlag:function(url){if(!this.isSSL())return url;else if(url.match(/(\?|&)secure/))return url;else if(url.indexOf('?')!==-1)return url+'&secure';else return url+'?secure';},jsonify:function(url){return url.replace(/\.(geo)?jsonp(?=$|\?)/,'.$1json');}};},{"./config":15}],21:[function(require,module,exports){'use strict';var request=require('./request'),url=require('./url'),util=require('./util');module.exports={_loadTileJSON:function(_){if(typeof _==='string'){if(_.indexOf('/')==-1)_=url.base()+_+'.json';request(url.secureFlag(_),L.bind(function(err,json){if(err){util.log('could not load TileJSON at '+_);this.fire('error',{error:err});}else if(json){this._setTileJSON(json);this.fire('ready');}},this));}else if(_&&typeof _==='object')this._setTileJSON(_);}};},{"./request":19,"./url":17,"./util":18}],11:[function(require,module,exports){'use strict';var util=require('./util'),Mustache=require('mustache');var GridControl=L.Control.extend({options:{pinnable:true,follow:false,sanitizer:require('./sanitize')},_currentContent:'',_pinned:false,initialize:function(_,options){L.Util.setOptions(this,options);util.strict_instance(_,L.Class,'L.mapbox.gridLayer');this._layer=_;},setTemplate:function(template){this.options.template=template;},_template:function(format,data){if(!data)return;var template=this.options.template||this._layer.getTileJSON().template;if(template){var d={};d['__'+format+'__']=true;return this.options.sanitizer(Mustache.to_html(template,L.extend(d,data)));}},_show:function(content,o){if(content===this._currentContent)return;this._currentContent=content;if(this.options.follow){this._popup.setContent(content).setLatLng(o.latLng);if(this._map._popup!==this._popup)this._popup.openOn(this._map);}else{this._container.style.display='block';this._contentWrapper.innerHTML=content;}},_hide:function(){this._pinned=false;this._currentContent='';this._map.closePopup();this._container.style.display='none';this._contentWrapper.innerHTML='';L.DomUtil.removeClass(this._container,'closable');},_mouseover:function(o){if(o.data)L.DomUtil.addClass(this._map._container,'map-clickable');else L.DomUtil.removeClass(this._map._container,'map-clickable');if(this._pinned)return;var content=this._template('teaser',o.data);if(content)this._show(content,o);else this._hide();},_mousemove:function(o){if(this._pinned)return;if(!this.options.follow)return;this._popup.setLatLng(o.latLng);},_click:function(o){if(!this.options.pinnable)return;var content=this._template('full',o.data);if(content){L.DomUtil.addClass(this._container,'closable');this._pinned=true;this._show(content,o);}else if(this._pinned){L.DomUtil.removeClass(this._container,'closable');this._pinned=false;this._hide();}},_createClosebutton:function(container,fn){var link=L.DomUtil.create('a','close',container);link.innerHTML='close';link.href='#';link.title='close';L.DomEvent.on(link,'click',L.DomEvent.stopPropagation).on(link,'mousedown',L.DomEvent.stopPropagation).on(link,'dblclick',L.DomEvent.stopPropagation).on(link,'click',L.DomEvent.preventDefault).on(link,'click',fn,this);return link;},onAdd:function(map){this._map=map;var className='leaflet-control-grid map-tooltip',container=L.DomUtil.create('div',className),contentWrapper=L.DomUtil.create('div','map-tooltip-content');container.style.display='none';this._createClosebutton(container,this._hide);container.appendChild(contentWrapper);this._contentWrapper=contentWrapper;this._popup=new L.Popup({autoPan:false,closeOnClick:false});map.on('popupclose',L.bind(function onPopupClose(){this._currentContent=null;this._pinned=false;},this));L.DomEvent.disableClickPropagation(container).addListener(container,'mousewheel',L.DomEvent.stopPropagation);this._layer.on('mouseover',this._mouseover,this).on('mousemove',this._mousemove,this).on('click',this._click,this);return container;}});module.exports=function(_,options){return new GridControl(_,options);};},{"./util":18,"./sanitize":20,"mustache":24}],23:[function(require,module,exports){(function(){var URI=(function(){function parse(uriStr){var m=(''+uriStr).match(URI_RE_);if(!m)return null;return new URI(nullIfAbsent(m[1]),nullIfAbsent(m[2]),nullIfAbsent(m[3]),nullIfAbsent(m[4]),nullIfAbsent(m[5]),nullIfAbsent(m[6]),nullIfAbsent(m[7]));}function create(scheme,credentials,domain,port,path,query,fragment){var uri=new URI(encodeIfExists2(scheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists2(credentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists(domain),port>0?port.toString():null,encodeIfExists2(path,URI_DISALLOWED_IN_PATH_),null,encodeIfExists(fragment));if(query)if('string'===typeof query)uri.setRawQuery(query.replace(/[^?&=0-9A-Za-z_\-~.%]/g,encodeOne));else uri.setAllParameters(query);return uri;}function encodeIfExists(unescapedPart){if('string'==typeof unescapedPart)return encodeURIComponent(unescapedPart);return null;};function encodeIfExists2(unescapedPart,extra){if('string'==typeof unescapedPart)return encodeURI(unescapedPart).replace(extra,encodeOne);return null;};function encodeOne(ch){var n=ch.charCodeAt(0);return '%'+'0123456789ABCDEF'.charAt((n>>4)&0xf)+'0123456789ABCDEF'.charAt(n&0xf);}function normPath(path){return path.replace(/(^|\/)\.(?:\/|$)/g,'$1').replace(/\/{2,}/g,'/');}var PARENT_DIRECTORY_HANDLER=new RegExp(''+'(/|^)'+'(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)'+'/\\.\\.(?:/|$)');var PARENT_DIRECTORY_HANDLER_RE=new RegExp(PARENT_DIRECTORY_HANDLER);var EXTRA_PARENT_PATHS_RE=/^(?:\.\.\/)*(?:\.\.$)?/;function collapse_dots(path){if(path===null)return null;var p=normPath(path);var r=PARENT_DIRECTORY_HANDLER_RE;for(var q;(q=p.replace(r,'$1'))!=p;p=q){};return p;}function resolve(baseUri,relativeUri){var absoluteUri=baseUri.clone();var overridden=relativeUri.hasScheme();if(overridden)absoluteUri.setRawScheme(relativeUri.getRawScheme());else overridden=relativeUri.hasCredentials();if(overridden)absoluteUri.setRawCredentials(relativeUri.getRawCredentials());else overridden=relativeUri.hasDomain();if(overridden)absoluteUri.setRawDomain(relativeUri.getRawDomain());else overridden=relativeUri.hasPort();var rawPath=relativeUri.getRawPath();var simplifiedPath=collapse_dots(rawPath);if(overridden){absoluteUri.setPort(relativeUri.getPort());simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,'');}else{overridden=!!rawPath;if(overridden){if(simplifiedPath.charCodeAt(0)!==0x2f){var absRawPath=collapse_dots(absoluteUri.getRawPath()||'').replace(EXTRA_PARENT_PATHS_RE,'');var slash=absRawPath.lastIndexOf('/')+1;simplifiedPath=collapse_dots((slash?absRawPath.substring(0,slash):'')+collapse_dots(rawPath)).replace(EXTRA_PARENT_PATHS_RE,'');}}else{simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,'');if(simplifiedPath!==rawPath)absoluteUri.setRawPath(simplifiedPath);}}if(overridden)absoluteUri.setRawPath(simplifiedPath);else overridden=relativeUri.hasQuery();if(overridden)absoluteUri.setRawQuery(relativeUri.getRawQuery());else overridden=relativeUri.hasFragment();if(overridden)absoluteUri.setRawFragment(relativeUri.getRawFragment());return absoluteUri;}function URI(rawScheme,rawCredentials,rawDomain,port,rawPath,rawQuery,rawFragment){this.scheme_=rawScheme;this.credentials_=rawCredentials;this.domain_=rawDomain;this.port_=port;this.path_=rawPath;this.query_=rawQuery;this.fragment_=rawFragment;this.paramCache_=null;}URI.prototype.toString=function(){var out=[];if(null!==this.scheme_)out.push(this.scheme_,':');if(null!==this.domain_){out.push('//');if(null!==this.credentials_)out.push(this.credentials_,'@');out.push(this.domain_);if(null!==this.port_)out.push(':',this.port_.toString());}if(null!==this.path_)out.push(this.path_);if(null!==this.query_)out.push('?',this.query_);if(null!==this.fragment_)out.push('#',this.fragment_);return out.join('');};URI.prototype.clone=function(){return new URI(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_);};URI.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase();};URI.prototype.getRawScheme=function(){return this.scheme_;};URI.prototype.setScheme=function(newScheme){this.scheme_=encodeIfExists2(newScheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this;};URI.prototype.setRawScheme=function(newScheme){this.scheme_=newScheme?newScheme:null;return this;};URI.prototype.hasScheme=function(){return null!==this.scheme_;};URI.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_);};URI.prototype.getRawCredentials=function(){return this.credentials_;};URI.prototype.setCredentials=function(newCredentials){this.credentials_=encodeIfExists2(newCredentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this;};URI.prototype.setRawCredentials=function(newCredentials){this.credentials_=newCredentials?newCredentials:null;return this;};URI.prototype.hasCredentials=function(){return null!==this.credentials_;};URI.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_);};URI.prototype.getRawDomain=function(){return this.domain_;};URI.prototype.setDomain=function(newDomain){return this.setRawDomain(newDomain&&encodeURIComponent(newDomain));};URI.prototype.setRawDomain=function(newDomain){this.domain_=newDomain?newDomain:null;return this.setRawPath(this.path_);};URI.prototype.hasDomain=function(){return null!==this.domain_;};URI.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_);};URI.prototype.setPort=function(newPort){if(newPort){newPort=Number(newPort);if(newPort!==(newPort&0xffff))throw new Error('Bad port number '+newPort);this.port_=''+newPort;}else this.port_=null;return this;};URI.prototype.hasPort=function(){return null!==this.port_;};URI.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_);};URI.prototype.getRawPath=function(){return this.path_;};URI.prototype.setPath=function(newPath){return this.setRawPath(encodeIfExists2(newPath,URI_DISALLOWED_IN_PATH_));};URI.prototype.setRawPath=function(newPath){if(newPath){newPath=String(newPath);this.path_=(!this.domain_||/^\//.test(newPath))?newPath:'/'+newPath;}else this.path_=null;return this;};URI.prototype.hasPath=function(){return null!==this.path_;};URI.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g,' ');};URI.prototype.getRawQuery=function(){return this.query_;};URI.prototype.setQuery=function(newQuery){this.paramCache_=null;this.query_=encodeIfExists(newQuery);return this;};URI.prototype.setRawQuery=function(newQuery){this.paramCache_=null;this.query_=newQuery?newQuery:null;return this;};URI.prototype.hasQuery=function(){return null!==this.query_;};URI.prototype.setAllParameters=function(params){if(typeof params==='object')if(!(params instanceof Array)&&(params instanceof Object||Object.prototype.toString.call(params)!=='[object Array]')){var newParams=[];var i=-1;for(var k in params){var v=params[k];if('string'===typeof v){newParams[++i]=k;newParams[++i]=v;}}params=newParams;}this.paramCache_=null;var queryBuf=[];var separator='';for(var j=0;j<params.length;){var k=params[j++];var v=params[j++];queryBuf.push(separator,encodeURIComponent(k.toString()));separator='&';if(v)queryBuf.push('=',encodeURIComponent(v.toString()));}this.query_=queryBuf.join('');return this;};URI.prototype.checkParameterCache_=function(){if(!this.paramCache_){var q=this.query_;if(!q)this.paramCache_=[];else{var cgiParams=q.split(/[&\?]/);var out=[];var k=-1;for(var i=0;i<cgiParams.length;++i){var m=cgiParams[i].match(/^([^=]*)(?:=(.*))?$/);out[++k]=decodeURIComponent(m[1]).replace(/\+/g,' ');out[++k]=decodeURIComponent(m[2]||'').replace(/\+/g,' ');}this.paramCache_=out;}}};URI.prototype.setParameterValues=function(key,values){if(typeof values==='string')values=[values];this.checkParameterCache_();var newValueIndex=0;var pc=this.paramCache_;var params=[];for(var i=0,k=0;i<pc.length;i+=2)if(key===pc[i]){if(newValueIndex<values.length)params.push(key,values[newValueIndex++]);}else params.push(pc[i],pc[i+1]);while(newValueIndex<values.length)params.push(key,values[newValueIndex++]);this.setAllParameters(params);return this;};URI.prototype.removeParameter=function(key){return this.setParameterValues(key,[]);};URI.prototype.getAllParameters=function(){this.checkParameterCache_();return this.paramCache_.slice(0,this.paramCache_.length);};URI.prototype.getParameterValues=function(paramNameUnescaped){this.checkParameterCache_();var values=[];for(var i=0;i<this.paramCache_.length;i+=2)if(paramNameUnescaped===this.paramCache_[i])values.push(this.paramCache_[i+1]);return values;};URI.prototype.getParameterMap=function(paramNameUnescaped){this.checkParameterCache_();var paramMap={};for(var i=0;i<this.paramCache_.length;i+=2){var key=this.paramCache_[i++],value=this.paramCache_[i++];if(!(key in paramMap))paramMap[key]=[value];else paramMap[key].push(value);}return paramMap;};URI.prototype.getParameterValue=function(paramNameUnescaped){this.checkParameterCache_();for(var i=0;i<this.paramCache_.length;i+=2)if(paramNameUnescaped===this.paramCache_[i])return this.paramCache_[i+1];return null;};URI.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_);};URI.prototype.getRawFragment=function(){return this.fragment_;};URI.prototype.setFragment=function(newFragment){this.fragment_=newFragment?encodeURIComponent(newFragment):null;return this;};URI.prototype.setRawFragment=function(newFragment){this.fragment_=newFragment?newFragment:null;return this;};URI.prototype.hasFragment=function(){return null!==this.fragment_;};function nullIfAbsent(matchPart){return('string'==typeof matchPart)&&(matchPart.length>0)?matchPart:null;}var URI_RE_=new RegExp("^"+"(?:"+"([^:/?#]+)"+":)?"+"(?://"+"(?:([^/?#]*)@)?"+"([^/?#:@]*)"+"(?::([0-9]+))?"+")?"+"([^?#]+)?"+"(?:\\?([^#]*))?"+"(?:#(.*))?"+"$");var URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_=/[#\/\?@]/g;var URI_DISALLOWED_IN_PATH_=/[\#\?]/g;URI.parse=parse;URI.create=create;URI.resolve=resolve;URI.collapse_dots=collapse_dots;URI.utils={mimeTypeOf:function(uri){var uriObj=parse(uri);if(/\.html$/.test(uriObj.getPath()))return 'text/html';else return 'application/javascript';},resolve:function(base,uri){if(base)return resolve(parse(base),parse(uri)).toString();else return ''+uri;}};return URI;})();var html4={};html4.atype={'NONE':0,'URI':1,'URI_FRAGMENT':11,'SCRIPT':2,'STYLE':3,'HTML':12,'ID':4,'IDREF':5,'IDREFS':6,'GLOBAL_NAME':7,'LOCAL_NAME':8,'CLASSES':9,'FRAME_TARGET':10,'MEDIA_QUERY':13};html4.atype=html4.atype;html4.ATTRIBS={'*::class':9,'*::dir':0,'*::draggable':0,'*::hidden':0,'*::id':4,'*::inert':0,'*::itemprop':0,'*::itemref':6,'*::itemscope':0,'*::lang':0,'*::onblur':2,'*::onchange':2,'*::onclick':2,'*::ondblclick':2,'*::onfocus':2,'*::onkeydown':2,'*::onkeypress':2,'*::onkeyup':2,'*::onload':2,'*::onmousedown':2,'*::onmousemove':2,'*::onmouseout':2,'*::onmouseover':2,'*::onmouseup':2,'*::onreset':2,'*::onscroll':2,'*::onselect':2,'*::onsubmit':2,'*::onunload':2,'*::spellcheck':0,'*::style':3,'*::title':0,'*::translate':0,'a::accesskey':0,'a::coords':0,'a::href':1,'a::hreflang':0,'a::name':7,'a::onblur':2,'a::onfocus':2,'a::shape':0,'a::tabindex':0,'a::target':10,'a::type':0,'area::accesskey':0,'area::alt':0,'area::coords':0,'area::href':1,'area::nohref':0,'area::onblur':2,'area::onfocus':2,'area::shape':0,'area::tabindex':0,'area::target':10,'audio::controls':0,'audio::loop':0,'audio::mediagroup':5,'audio::muted':0,'audio::preload':0,'bdo::dir':0,'blockquote::cite':1,'br::clear':0,'button::accesskey':0,'button::disabled':0,'button::name':8,'button::onblur':2,'button::onfocus':2,'button::tabindex':0,'button::type':0,'button::value':0,'canvas::height':0,'canvas::width':0,'caption::align':0,'col::align':0,'col::char':0,'col::charoff':0,'col::span':0,'col::valign':0,'col::width':0,'colgroup::align':0,'colgroup::char':0,'colgroup::charoff':0,'colgroup::span':0,'colgroup::valign':0,'colgroup::width':0,'command::checked':0,'command::command':5,'command::disabled':0,'command::icon':1,'command::label':0,'command::radiogroup':0,'command::type':0,'data::value':0,'del::cite':1,'del::datetime':0,'details::open':0,'dir::compact':0,'div::align':0,'dl::compact':0,'fieldset::disabled':0,'font::color':0,'font::face':0,'font::size':0,'form::accept':0,'form::action':1,'form::autocomplete':0,'form::enctype':0,'form::method':0,'form::name':7,'form::novalidate':0,'form::onreset':2,'form::onsubmit':2,'form::target':10,'h1::align':0,'h2::align':0,'h3::align':0,'h4::align':0,'h5::align':0,'h6::align':0,'hr::align':0,'hr::noshade':0,'hr::size':0,'hr::width':0,'iframe::align':0,'iframe::frameborder':0,'iframe::height':0,'iframe::marginheight':0,'iframe::marginwidth':0,'iframe::width':0,'img::align':0,'img::alt':0,'img::border':0,'img::height':0,'img::hspace':0,'img::ismap':0,'img::name':7,'img::src':1,'img::usemap':11,'img::vspace':0,'img::width':0,'input::accept':0,'input::accesskey':0,'input::align':0,'input::alt':0,'input::autocomplete':0,'input::checked':0,'input::disabled':0,'input::inputmode':0,'input::ismap':0,'input::list':5,'input::max':0,'input::maxlength':0,'input::min':0,'input::multiple':0,'input::name':8,'input::onblur':2,'input::onchange':2,'input::onfocus':2,'input::onselect':2,'input::placeholder':0,'input::readonly':0,'input::required':0,'input::size':0,'input::src':1,'input::step':0,'input::tabindex':0,'input::type':0,'input::usemap':11,'input::value':0,'ins::cite':1,'ins::datetime':0,'label::accesskey':0,'label::for':5,'label::onblur':2,'label::onfocus':2,'legend::accesskey':0,'legend::align':0,'li::type':0,'li::value':0,'map::name':7,'menu::compact':0,'menu::label':0,'menu::type':0,'meter::high':0,'meter::low':0,'meter::max':0,'meter::min':0,'meter::value':0,'ol::compact':0,'ol::reversed':0,'ol::start':0,'ol::type':0,'optgroup::disabled':0,'optgroup::label':0,'option::disabled':0,'option::label':0,'option::selected':0,'option::value':0,'output::for':6,'output::name':8,'p::align':0,'pre::width':0,'progress::max':0,'progress::min':0,'progress::value':0,'q::cite':1,'select::autocomplete':0,'select::disabled':0,'select::multiple':0,'select::name':8,'select::onblur':2,'select::onchange':2,'select::onfocus':2,'select::required':0,'select::size':0,'select::tabindex':0,'source::type':0,'table::align':0,'table::bgcolor':0,'table::border':0,'table::cellpadding':0,'table::cellspacing':0,'table::frame':0,'table::rules':0,'table::summary':0,'table::width':0,'tbody::align':0,'tbody::char':0,'tbody::charoff':0,'tbody::valign':0,'td::abbr':0,'td::align':0,'td::axis':0,'td::bgcolor':0,'td::char':0,'td::charoff':0,'td::colspan':0,'td::headers':6,'td::height':0,'td::nowrap':0,'td::rowspan':0,'td::scope':0,'td::valign':0,'td::width':0,'textarea::accesskey':0,'textarea::autocomplete':0,'textarea::cols':0,'textarea::disabled':0,'textarea::inputmode':0,'textarea::name':8,'textarea::onblur':2,'textarea::onchange':2,'textarea::onfocus':2,'textarea::onselect':2,'textarea::placeholder':0,'textarea::readonly':0,'textarea::required':0,'textarea::rows':0,'textarea::tabindex':0,'textarea::wrap':0,'tfoot::align':0,'tfoot::char':0,'tfoot::charoff':0,'tfoot::valign':0,'th::abbr':0,'th::align':0,'th::axis':0,'th::bgcolor':0,'th::char':0,'th::charoff':0,'th::colspan':0,'th::headers':6,'th::height':0,'th::nowrap':0,'th::rowspan':0,'th::scope':0,'th::valign':0,'th::width':0,'thead::align':0,'thead::char':0,'thead::charoff':0,'thead::valign':0,'tr::align':0,'tr::bgcolor':0,'tr::char':0,'tr::charoff':0,'tr::valign':0,'track::default':0,'track::kind':0,'track::label':0,'track::srclang':0,'ul::compact':0,'ul::type':0,'video::controls':0,'video::height':0,'video::loop':0,'video::mediagroup':5,'video::muted':0,'video::poster':1,'video::preload':0,'video::width':0};html4.ATTRIBS=html4.ATTRIBS;html4.eflags={'OPTIONAL_ENDTAG':1,'EMPTY':2,'CDATA':4,'RCDATA':8,'UNSAFE':16,'FOLDABLE':32,'SCRIPT':64,'STYLE':128,'VIRTUALIZED':256};html4.eflags=html4.eflags;html4.ELEMENTS={'a':0,'abbr':0,'acronym':0,'address':0,'applet':272,'area':2,'article':0,'aside':0,'audio':0,'b':0,'base':274,'basefont':274,'bdi':0,'bdo':0,'big':0,'blockquote':0,'body':305,'br':2,'button':0,'canvas':0,'caption':0,'center':0,'cite':0,'code':0,'col':2,'colgroup':1,'command':2,'data':0,'datalist':0,'dd':1,'del':0,'details':0,'dfn':0,'dialog':272,'dir':0,'div':0,'dl':0,'dt':1,'em':0,'fieldset':0,'figcaption':0,'figure':0,'font':0,'footer':0,'form':0,'frame':274,'frameset':272,'h1':0,'h2':0,'h3':0,'h4':0,'h5':0,'h6':0,'head':305,'header':0,'hgroup':0,'hr':2,'html':305,'i':0,'iframe':4,'img':2,'input':2,'ins':0,'isindex':274,'kbd':0,'keygen':274,'label':0,'legend':0,'li':1,'link':274,'map':0,'mark':0,'menu':0,'meta':274,'meter':0,'nav':0,'nobr':0,'noembed':276,'noframes':276,'noscript':276,'object':272,'ol':0,'optgroup':0,'option':1,'output':0,'p':1,'param':274,'pre':0,'progress':0,'q':0,'s':0,'samp':0,'script':84,'section':0,'select':0,'small':0,'source':2,'span':0,'strike':0,'strong':0,'style':148,'sub':0,'summary':0,'sup':0,'table':0,'tbody':1,'td':1,'textarea':8,'tfoot':1,'th':1,'thead':1,'time':0,'title':280,'tr':1,'track':2,'tt':0,'u':0,'ul':0,'var':0,'video':0,'wbr':2};html4.ELEMENTS=html4.ELEMENTS;html4.ELEMENT_DOM_INTERFACES={'a':'HTMLAnchorElement','abbr':'HTMLElement','acronym':'HTMLElement','address':'HTMLElement','applet':'HTMLAppletElement','area':'HTMLAreaElement','article':'HTMLElement','aside':'HTMLElement','audio':'HTMLAudioElement','b':'HTMLElement','base':'HTMLBaseElement','basefont':'HTMLBaseFontElement','bdi':'HTMLElement','bdo':'HTMLElement','big':'HTMLElement','blockquote':'HTMLQuoteElement','body':'HTMLBodyElement','br':'HTMLBRElement','button':'HTMLButtonElement','canvas':'HTMLCanvasElement','caption':'HTMLTableCaptionElement','center':'HTMLElement','cite':'HTMLElement','code':'HTMLElement','col':'HTMLTableColElement','colgroup':'HTMLTableColElement','command':'HTMLCommandElement','data':'HTMLElement','datalist':'HTMLDataListElement','dd':'HTMLElement','del':'HTMLModElement','details':'HTMLDetailsElement','dfn':'HTMLElement','dialog':'HTMLDialogElement','dir':'HTMLDirectoryElement','div':'HTMLDivElement','dl':'HTMLDListElement','dt':'HTMLElement','em':'HTMLElement','fieldset':'HTMLFieldSetElement','figcaption':'HTMLElement','figure':'HTMLElement','font':'HTMLFontElement','footer':'HTMLElement','form':'HTMLFormElement','frame':'HTMLFrameElement','frameset':'HTMLFrameSetElement','h1':'HTMLHeadingElement','h2':'HTMLHeadingElement','h3':'HTMLHeadingElement','h4':'HTMLHeadingElement','h5':'HTMLHeadingElement','h6':'HTMLHeadingElement','head':'HTMLHeadElement','header':'HTMLElement','hgroup':'HTMLElement','hr':'HTMLHRElement','html':'HTMLHtmlElement','i':'HTMLElement','iframe':'HTMLIFrameElement','img':'HTMLImageElement','input':'HTMLInputElement','ins':'HTMLModElement','isindex':'HTMLUnknownElement','kbd':'HTMLElement','keygen':'HTMLKeygenElement','label':'HTMLLabelElement','legend':'HTMLLegendElement','li':'HTMLLIElement','link':'HTMLLinkElement','map':'HTMLMapElement','mark':'HTMLElement','menu':'HTMLMenuElement','meta':'HTMLMetaElement','meter':'HTMLMeterElement','nav':'HTMLElement','nobr':'HTMLElement','noembed':'HTMLElement','noframes':'HTMLElement','noscript':'HTMLElement','object':'HTMLObjectElement','ol':'HTMLOListElement','optgroup':'HTMLOptGroupElement','option':'HTMLOptionElement','output':'HTMLOutputElement','p':'HTMLParagraphElement','param':'HTMLParamElement','pre':'HTMLPreElement','progress':'HTMLProgressElement','q':'HTMLQuoteElement','s':'HTMLElement','samp':'HTMLElement','script':'HTMLScriptElement','section':'HTMLElement','select':'HTMLSelectElement','small':'HTMLElement','source':'HTMLSourceElement','span':'HTMLSpanElement','strike':'HTMLElement','strong':'HTMLElement','style':'HTMLStyleElement','sub':'HTMLElement','summary':'HTMLElement','sup':'HTMLElement','table':'HTMLTableElement','tbody':'HTMLTableSectionElement','td':'HTMLTableDataCellElement','textarea':'HTMLTextAreaElement','tfoot':'HTMLTableSectionElement','th':'HTMLTableHeaderCellElement','thead':'HTMLTableSectionElement','time':'HTMLTimeElement','title':'HTMLTitleElement','tr':'HTMLTableRowElement','track':'HTMLTrackElement','tt':'HTMLElement','u':'HTMLElement','ul':'HTMLUListElement','var':'HTMLElement','video':'HTMLVideoElement','wbr':'HTMLElement'};html4.ELEMENT_DOM_INTERFACES=html4.ELEMENT_DOM_INTERFACES;html4.ueffects={'NOT_LOADED':0,'SAME_DOCUMENT':1,'NEW_DOCUMENT':2};html4.ueffects=html4.ueffects;html4.URIEFFECTS={'a::href':2,'area::href':2,'blockquote::cite':0,'command::icon':1,'del::cite':0,'form::action':2,'img::src':1,'input::src':1,'ins::cite':0,'q::cite':0,'video::poster':1};html4.URIEFFECTS=html4.URIEFFECTS;html4.ltypes={'UNSANDBOXED':2,'SANDBOXED':1,'DATA':0};html4.ltypes=html4.ltypes;html4.LOADERTYPES={'a::href':2,'area::href':2,'blockquote::cite':2,'command::icon':1,'del::cite':2,'form::action':2,'img::src':1,'input::src':1,'ins::cite':2,'q::cite':2,'video::poster':1};html4.LOADERTYPES=html4.LOADERTYPES;if('I'.toLowerCase()!=='i')throw 'I/i problem';var html=(function(html4){var parseCssDeclarations,sanitizeCssProperty,cssSchema;if('undefined'!==typeof window){parseCssDeclarations=window.parseCssDeclarations;sanitizeCssProperty=window.sanitizeCssProperty;cssSchema=window.cssSchema;}var ENTITIES={'lt':'<','LT':'<','gt':'>','GT':'>','amp':'&','AMP':'&','quot':'"','apos':'\'','nbsp':240};var decimalEscapeRe=/^#(\d+)$/;var hexEscapeRe=/^#x([0-9A-Fa-f]+)$/;var safeEntityNameRe=/^[A-Za-z][A-za-z0-9]+$/;var entityLookupElement=('undefined'!==typeof window&&window.document)?window.document.createElement('textarea'):null;function lookupEntity(name){if(ENTITIES.hasOwnProperty(name))return ENTITIES[name];var m=name.match(decimalEscapeRe);if(m)return String.fromCharCode(parseInt(m[1],10));else if(!!(m=name.match(hexEscapeRe)))return String.fromCharCode(parseInt(m[1],16));else if(entityLookupElement&&safeEntityNameRe.test(name)){entityLookupElement.innerHTML='&'+name+';';var text=entityLookupElement.textContent;ENTITIES[name]=text;return text;}else return '&'+name+';';}function decodeOneEntity(_,name){return lookupEntity(name);}var nulRe=/\0/g;function stripNULs(s){return s.replace(nulRe,'');}var ENTITY_RE_1=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g;var ENTITY_RE_2=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/;function unescapeEntities(s){return s.replace(ENTITY_RE_1,decodeOneEntity);}var ampRe=/&/g;var looseAmpRe=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;var ltRe=/[<]/g;var gtRe=/>/g;var quotRe=/\"/g;function escapeAttrib(s){return(''+s).replace(ampRe,'&amp;').replace(ltRe,'&lt;').replace(gtRe,'&gt;').replace(quotRe,'&#34;');}function normalizeRCData(rcdata){return rcdata.replace(looseAmpRe,'&amp;$1').replace(ltRe,'&lt;').replace(gtRe,'&gt;');}var ATTR_RE=new RegExp('^\\s*'+'([-.:\\w]+)'+'(?:'+('\\s*(=)\\s*'+'('+('(\")[^\"]*(\"|$)'+'|'+'(\')[^\']*(\'|$)'+'|'+'(?=[a-z][-\\w]*\\s*=)'+'|'+'[^\"\'\\s]*')+')')+')?','i');var splitWillCapture=('a,b'.split(/(,)/).length===3);var EFLAGS_TEXT=html4.eflags.CDATA|html4.eflags.RCDATA;function makeSaxParser(handler){var hcopy={cdata:handler.cdata||handler.cdata,comment:handler.comment||handler.comment,endDoc:handler.endDoc||handler.endDoc,endTag:handler.endTag||handler.endTag,pcdata:handler.pcdata||handler.pcdata,rcdata:handler.rcdata||handler.rcdata,startDoc:handler.startDoc||handler.startDoc,startTag:handler.startTag||handler.startTag};return function(htmlText,param){return parse(htmlText,hcopy,param);};}var continuationMarker={};function parse(htmlText,handler,param){var m,p,tagName;var parts=htmlSplit(htmlText);var state={noMoreGT:false,noMoreEndComments:false};parseCPS(handler,parts,0,state,param);}function continuationMaker(h,parts,initial,state,param){return function(){parseCPS(h,parts,initial,state,param);};}function parseCPS(h,parts,initial,state,param){try{if(h.startDoc&&initial==0)h.startDoc(param);var m,p,tagName;for(var pos=initial,end=parts.length;pos<end;){var current=parts[pos++];var next=parts[pos];switch(current){case '&':if(ENTITY_RE_2.test(next)){if(h.pcdata)h.pcdata('&'+next,param,continuationMarker,continuationMaker(h,parts,pos,state,param));pos++;}else if(h.pcdata)h.pcdata("&amp;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case '<\/':if(m=/^([-\w:]+)[^\'\"]*/.exec(next)){if(m[0].length===next.length&&parts[pos+1]==='>'){pos+=2;tagName=m[1].toLowerCase();if(h.endTag)h.endTag(tagName,param,continuationMarker,continuationMaker(h,parts,pos,state,param));}else pos=parseEndTag(parts,pos,h,param,continuationMarker,state);}else if(h.pcdata)h.pcdata('&lt;/',param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case '<':if(m=/^([-\w:]+)\s*\/?/.exec(next)){if(m[0].length===next.length&&parts[pos+1]==='>'){pos+=2;tagName=m[1].toLowerCase();if(h.startTag)h.startTag(tagName,[],param,continuationMarker,continuationMaker(h,parts,pos,state,param));var eflags=html4.ELEMENTS[tagName];if(eflags&EFLAGS_TEXT){var tag={name:tagName,next:pos,eflags:eflags};pos=parseText(parts,tag,h,param,continuationMarker,state);}}else pos=parseStartTag(parts,pos,h,param,continuationMarker,state);}else if(h.pcdata)h.pcdata('&lt;',param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case '<\!--':if(!state.noMoreEndComments){for(p=pos+1;p<end;p++)if(parts[p]==='>'&&/--$/.test(parts[p-1]))break;if(p<end){if(h.comment){var comment=parts.slice(pos,p).join('');h.comment(comment.substr(0,comment.length-2),param,continuationMarker,continuationMaker(h,parts,p+1,state,param));}pos=p+1;}else state.noMoreEndComments=true;}if(state.noMoreEndComments)if(h.pcdata)h.pcdata('&lt;!--',param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case '<\!':if(!/^\w/.test(next)){if(h.pcdata)h.pcdata('&lt;!',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}else{if(!state.noMoreGT){for(p=pos+1;p<end;p++)if(parts[p]==='>')break;if(p<end)pos=p+1;else state.noMoreGT=true;}if(state.noMoreGT)if(h.pcdata)h.pcdata('&lt;!',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}break;case '<?':if(!state.noMoreGT){for(p=pos+1;p<end;p++)if(parts[p]==='>')break;if(p<end)pos=p+1;else state.noMoreGT=true;}if(state.noMoreGT)if(h.pcdata)h.pcdata('&lt;?',param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case '>':if(h.pcdata)h.pcdata("&gt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case '':break;default:if(h.pcdata)h.pcdata(current,param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;}}if(h.endDoc)h.endDoc(param);}catch(e){if(e!==continuationMarker)throw e;}}function htmlSplit(str){var re=/(<\/|<\!--|<[!?]|[&<>])/g;str+='';if(splitWillCapture)return str.split(re);else{var parts=[];var lastPos=0;var m;while((m=re.exec(str))!==null){parts.push(str.substring(lastPos,m.index));parts.push(m[0]);lastPos=m.index+m[0].length;}parts.push(str.substring(lastPos));return parts;}}function parseEndTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);if(!tag)return parts.length;if(h.endTag)h.endTag(tag.name,param,continuationMarker,continuationMaker(h,parts,pos,state,param));return tag.next;}function parseStartTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);if(!tag)return parts.length;if(h.startTag)h.startTag(tag.name,tag.attrs,param,continuationMarker,continuationMaker(h,parts,tag.next,state,param));if(tag.eflags&EFLAGS_TEXT)return parseText(parts,tag,h,param,continuationMarker,state);else return tag.next;}var endTagRe={};function parseText(parts,tag,h,param,continuationMarker,state){var end=parts.length;if(!endTagRe.hasOwnProperty(tag.name))endTagRe[tag.name]=new RegExp('^'+tag.name+'(?:[\\s\\/]|$)','i');var re=endTagRe[tag.name];var first=tag.next;var p=tag.next+1;for(;p<end;p++)if(parts[p-1]==='<\/'&&re.test(parts[p]))break;if(p<end)p-=1;var buf=parts.slice(first,p).join('');if(tag.eflags&html4.eflags.CDATA){if(h.cdata)h.cdata(buf,param,continuationMarker,continuationMaker(h,parts,p,state,param));}else if(tag.eflags&html4.eflags.RCDATA){if(h.rcdata)h.rcdata(normalizeRCData(buf),param,continuationMarker,continuationMaker(h,parts,p,state,param));}else throw new Error('bug');return p;}function parseTagAndAttrs(parts,pos){var m=/^([-\w:]+)/.exec(parts[pos]);var tag={};tag.name=m[1].toLowerCase();tag.eflags=html4.ELEMENTS[tag.name];var buf=parts[pos].substr(m[0].length);var p=pos+1;var end=parts.length;for(;p<end;p++){if(parts[p]==='>')break;buf+=parts[p];}if(end<=p)return void 0;var attrs=[];while(buf!==''){m=ATTR_RE.exec(buf);if(!m)buf=buf.replace(/^[\s\S][^a-z\s]*/,'');else if((m[4]&&!m[5])||(m[6]&&!m[7])){var quote=m[4]||m[6];var sawQuote=false;var abuf=[buf,parts[p++]];for(;p<end;p++){if(sawQuote){if(parts[p]==='>')break;}else if(0<=parts[p].indexOf(quote))sawQuote=true;abuf.push(parts[p]);}if(end<=p)break;buf=abuf.join('');continue;}else{var aName=m[1].toLowerCase();var aValue=m[2]?decodeValue(m[3]):'';attrs.push(aName,aValue);buf=buf.substr(m[0].length);}}tag.attrs=attrs;tag.next=p+1;return tag;}function decodeValue(v){var q=v.charCodeAt(0);if(q===0x22||q===0x27)v=v.substr(1,v.length-2);return unescapeEntities(stripNULs(v));}function makeHtmlSanitizer(tagPolicy){var stack;var ignoring;var emit=function(text,out){if(!ignoring)out.push(text);};return makeSaxParser({'startDoc':function(_){stack=[];ignoring=false;},'startTag':function(tagNameOrig,attribs,out){if(ignoring)return;if(!html4.ELEMENTS.hasOwnProperty(tagNameOrig))return;var eflagsOrig=html4.ELEMENTS[tagNameOrig];if(eflagsOrig&html4.eflags.FOLDABLE)return;var decision=tagPolicy(tagNameOrig,attribs);if(!decision){ignoring=!(eflagsOrig&html4.eflags.EMPTY);return;}else if(typeof decision!=='object')throw new Error('tagPolicy did not return object (old API?)');if('attribs' in decision)attribs=decision.attribs;else throw new Error('tagPolicy gave no attribs');var eflagsRep;var tagNameRep;if('tagName' in decision){tagNameRep=decision.tagName;eflagsRep=html4.ELEMENTS[tagNameRep];}else{tagNameRep=tagNameOrig;eflagsRep=eflagsOrig;}if(eflagsOrig&html4.eflags.OPTIONAL_ENDTAG){var onStack=stack[stack.length-1];if(onStack&&onStack.orig===tagNameOrig&&(onStack.rep!==tagNameRep||tagNameOrig!==tagNameRep))out.push('<\/',onStack.rep,'>');}if(!(eflagsOrig&html4.eflags.EMPTY))stack.push({orig:tagNameOrig,rep:tagNameRep});out.push('<',tagNameRep);for(var i=0,n=attribs.length;i<n;i+=2){var attribName=attribs[i],value=attribs[i+1];if(value!==null&&value!==void 0)out.push(' ',attribName,'="',escapeAttrib(value),'"');}out.push('>');if((eflagsOrig&html4.eflags.EMPTY)&&!(eflagsRep&html4.eflags.EMPTY))out.push('<\/',tagNameRep,'>');},'endTag':function(tagName,out){if(ignoring){ignoring=false;return;}if(!html4.ELEMENTS.hasOwnProperty(tagName))return;var eflags=html4.ELEMENTS[tagName];if(!(eflags&(html4.eflags.EMPTY|html4.eflags.FOLDABLE))){var index;if(eflags&html4.eflags.OPTIONAL_ENDTAG){for(index=stack.length;--index>=0;){var stackElOrigTag=stack[index].orig;if(stackElOrigTag===tagName)break;if(!(html4.ELEMENTS[stackElOrigTag]&html4.eflags.OPTIONAL_ENDTAG))return;}}else for(index=stack.length;--index>=0;)if(stack[index].orig===tagName)break;if(index<0)return;for(var i=stack.length;--i>index;){var stackElRepTag=stack[i].rep;if(!(html4.ELEMENTS[stackElRepTag]&html4.eflags.OPTIONAL_ENDTAG))out.push('<\/',stackElRepTag,'>');}if(index<stack.length)tagName=stack[index].rep;stack.length=index;out.push('<\/',tagName,'>');}},'pcdata':emit,'rcdata':emit,'cdata':emit,'endDoc':function(out){for(;stack.length;stack.length--)out.push('<\/',stack[stack.length-1].rep,'>');}});}var ALLOWED_URI_SCHEMES=/^(?:https?|mailto|data)$/i;function safeUri(uri,effect,ltype,hints,naiveUriRewriter){if(!naiveUriRewriter)return null;try{var parsed=URI.parse(''+uri);if(parsed)if(!parsed.hasScheme()||ALLOWED_URI_SCHEMES.test(parsed.getScheme())){var safe=naiveUriRewriter(parsed,effect,ltype,hints);return safe?safe.toString():null;}}catch(e){return null;}return null;}function log(logger,tagName,attribName,oldValue,newValue){if(!attribName)logger(tagName+" removed",{change:"removed",tagName:tagName});if(oldValue!==newValue){var changed="changed";if(oldValue&&!newValue)changed="removed";else if(!oldValue&&newValue)changed="added";logger(tagName+"."+attribName+" "+changed,{change:changed,tagName:tagName,attribName:attribName,oldValue:oldValue,newValue:newValue});}}function lookupAttribute(map,tagName,attribName){var attribKey;attribKey=tagName+'::'+attribName;if(map.hasOwnProperty(attribKey))return map[attribKey];attribKey='*::'+attribName;if(map.hasOwnProperty(attribKey))return map[attribKey];return void 0;}function getAttributeType(tagName,attribName){return lookupAttribute(html4.ATTRIBS,tagName,attribName);}function getLoaderType(tagName,attribName){return lookupAttribute(html4.LOADERTYPES,tagName,attribName);}function getUriEffect(tagName,attribName){return lookupAttribute(html4.URIEFFECTS,tagName,attribName);}function sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){for(var i=0;i<attribs.length;i+=2){var attribName=attribs[i];var value=attribs[i+1];var oldValue=value;var atype=null,attribKey;if((attribKey=tagName+'::'+attribName,html4.ATTRIBS.hasOwnProperty(attribKey))||(attribKey='*::'+attribName,html4.ATTRIBS.hasOwnProperty(attribKey)))atype=html4.ATTRIBS[attribKey];if(atype!==null){switch(atype){case html4.atype.NONE:break;case html4.atype.SCRIPT:value=null;if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.STYLE:if('undefined'===typeof parseCssDeclarations){value=null;if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);break;}var sanitizedDeclarations=[];parseCssDeclarations(value,{declaration:function(property,tokens){var normProp=property.toLowerCase();var schema=cssSchema[normProp];if(!schema)return;sanitizeCssProperty(normProp,schema,tokens,opt_naiveUriRewriter?function(url){return safeUri(url,html4.ueffects.SAME_DOCUMENT,html4.ltypes.SANDBOXED,{"TYPE":"CSS","CSS_PROP":normProp},opt_naiveUriRewriter);}:null);sanitizedDeclarations.push(property+': '+tokens.join(' '));}});value=sanitizedDeclarations.length>0?sanitizedDeclarations.join(' ; '):null;if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.ID:case html4.atype.IDREF:case html4.atype.IDREFS:case html4.atype.GLOBAL_NAME:case html4.atype.LOCAL_NAME:case html4.atype.CLASSES:value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.URI:value=safeUri(value,getUriEffect(tagName,attribName),getLoaderType(tagName,attribName),{"TYPE":"MARKUP","XML_ATTR":attribName,"XML_TAG":tagName},opt_naiveUriRewriter);if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.URI_FRAGMENT:if(value&&'#'===value.charAt(0)){value=value.substring(1);value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;if(value!==null&&value!==void 0)value='#'+value;}else value=null;if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);break;default:value=null;if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);break;}}else{value=null;if(opt_logger)log(opt_logger,tagName,attribName,oldValue,value);}attribs[i+1]=value;}return attribs;}function makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){return function(tagName,attribs){if(!(html4.ELEMENTS[tagName]&html4.eflags.UNSAFE))return{'attribs':sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger)};else if(opt_logger)log(opt_logger,tagName,undefined,undefined,undefined);};}function sanitizeWithPolicy(inputHtml,tagPolicy){var outputArray=[];makeHtmlSanitizer(tagPolicy)(inputHtml,outputArray);return outputArray.join('');}function sanitize(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){var tagPolicy=makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger);return sanitizeWithPolicy(inputHtml,tagPolicy);}var html={};html.escapeAttrib=html.escapeAttrib=escapeAttrib;html.makeHtmlSanitizer=html.makeHtmlSanitizer=makeHtmlSanitizer;html.makeSaxParser=html.makeSaxParser=makeSaxParser;html.makeTagPolicy=html.makeTagPolicy=makeTagPolicy;html.normalizeRCData=html.normalizeRCData=normalizeRCData;html.sanitize=html.sanitize=sanitize;html.sanitizeAttribs=html.sanitizeAttribs=sanitizeAttribs;html.sanitizeWithPolicy=html.sanitizeWithPolicy=sanitizeWithPolicy;html.unescapeEntities=html.unescapeEntities=unescapeEntities;return html;})(html4);var html_sanitize=html.sanitize;html4.ATTRIBS['*::style']=0;html4.ELEMENTS.style=0;html4.ATTRIBS['a::target']=0;html4.ELEMENTS.video=0;html4.ATTRIBS['video::src']=0;html4.ATTRIBS['video::poster']=0;html4.ATTRIBS['video::controls']=0;html4.ELEMENTS.audio=0;html4.ATTRIBS['audio::src']=0;html4.ATTRIBS['video::autoplay']=0;html4.ATTRIBS['video::controls']=0;if(typeof module!=='undefined')module.exports=html_sanitize;})();},{}],24:[function(require,module,exports){(function(){(function(root,factory){if(typeof exports==="object"&&exports)module.exports=factory;else if(typeof define==="function"&&define.amd)define(factory);else root.Mustache=factory;}(this,(function(){var exports={};exports.name="mustache.js";exports.version="0.7.2";exports.tags=["{{","}}"];exports.Scanner=Scanner;exports.Context=Context;exports.Writer=Writer;var whiteRe=/\s*/;var spaceRe=/\s+/;var nonSpaceRe=/\S/;var eqRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function testRe(re,string){return RegExp.prototype.test.call(re,string);}function isWhitespace(string){return !testRe(nonSpaceRe,string);}var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;',"/":'&#x2F;'};function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s];});}exports.escape=escapeHtml;function Scanner(string){this.string=string;this.tail=string;this.pos=0;}Scanner.prototype.eos=function(){return this.tail==="";};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&match.index===0){this.tail=this.tail.substring(match[0].length);this.pos+=match[0].length;return match[0];}return "";};Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case -1:match=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos;}return match;};function Context(view,parent){this.view=view;this.parent=parent;this.clearCache();}Context.make=function(view){return(view instanceof Context)?view:new Context(view);};Context.prototype.clearCache=function(){this._cache={};};Context.prototype.push=function(view){return new Context(view,this);};Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if(name===".")value=this.view;else{var context=this;while(context){if(name.indexOf(".")>0){var names=name.split("."),i=0;value=context.view;while(value&&i<names.length)value=value[names[i++]];}else value=context.view[name];if(value!=null)break;context=context.parent;}}this._cache[name]=value;}if(typeof value==="function")value=value.call(this.view);return value;};function Writer(){this.clearCache();}Writer.prototype.clearCache=function(){this._cache={};this._partialCache={};};Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=exports.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template);}return fn;};Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);this._partialCache[name]=fn;return fn;};Writer.prototype.compileTokens=function(tokens,template){var fn=compileTokens(tokens);var self=this;return function(view,partials){if(partials)if(typeof partials==="function")self._loadPartial=partials;else for(var name in partials)self.compilePartial(name,partials[name]);return fn(self,Context.make(view),template);};};Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials);};Writer.prototype._section=function(name,context,text,callback){var value=context.lookup(name);switch(typeof value){case "object":if(isArray(value)){var buffer="";for(var i=0,len=value.length;i<len;++i)buffer+=callback(this,context.push(value[i]));return buffer;}return value?callback(this,context.push(value)):"";case "function":var self=this;var scopedRender=function(template){return self.render(template,context);};var result=value.call(context.view,text,scopedRender);return result!=null?result:"";default:if(value)return callback(this,context);}return "";};Writer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);if(!value||(isArray(value)&&value.length===0))return callback(this,context);return "";};Writer.prototype._partial=function(name,context){if(!(name in this._partialCache)&&this._loadPartial)this.compilePartial(name,this._loadPartial(name));var fn=this._partialCache[name];return fn?fn(context):"";};Writer.prototype._name=function(name,context){var value=context.lookup(name);if(typeof value==="function")value=value.call(context.view);return(value==null)?"":String(value);};Writer.prototype._escaped=function(name,context){return exports.escape(this._name(name,context));};function compileTokens(tokens){var subRenders={};function subRender(i,tokens,template){if(!subRenders[i]){var fn=compileTokens(tokens);subRenders[i]=function(writer,context){return fn(writer,context,template);};}return subRenders[i];}return function(writer,context,template){var buffer="";var token,sectionText;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case "#":sectionText=template.slice(token[3],token[5]);buffer+=writer._section(token[1],context,sectionText,subRender(i,token[4],template));break;case "^":buffer+=writer._inverted(token[1],context,subRender(i,token[4],template));break;case ">":buffer+=writer._partial(token[1],context);break;case "&":buffer+=writer._name(token[1],context);break;case "name":buffer+=writer._escaped(token[1],context);break;case "text":buffer+=token[1];break;}}return buffer;};}function nestTokens(tokens){var tree=[];var collector=tree;var sections=[];var token;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case '#':case '^':sections.push(token);collector.push(token);collector=token[4]=[];break;case '/':var section=sections.pop();section[5]=token[2];collector=sections.length>0?sections[sections.length-1][4]:tree;break;default:collector.push(token);}}return tree;}function squashTokens(tokens){var squashedTokens=[];var token,lastToken;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];if(token[0]==='text'&&lastToken&&lastToken[0]==='text'){lastToken[1]+=token[1];lastToken[3]=token[3];}else{lastToken=token;squashedTokens.push(token);}}return squashedTokens;}function escapeTags(tags){return [new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))];}exports.parse=function(template,tags){template=template||'';tags=tags||exports.tags;if(typeof tags==='string')tags=tags.split(spaceRe);if(tags.length!==2)throw new Error('Invalid tags: '+tags.join(', '));var tagRes=escapeTags(tags);var scanner=new Scanner(template);var sections=[];var tokens=[];var spaces=[];var hasTag=false;var nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace)while(spaces.length)tokens.splice(spaces.pop(),1);else spaces=[];hasTag=false;nonSpace=false;}var start,type,value,chr;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(tagRes[0]);if(value)for(var i=0,len=value.length;i<len;++i){chr=value.charAt(i);if(isWhitespace(chr))spaces.push(tokens.length);else nonSpace=true;tokens.push(["text",chr,start,start+1]);start+=1;if(chr==="\n")stripSpace();}start=scanner.pos;if(!scanner.scan(tagRes[0]))break;hasTag=true;type=scanner.scan(tagRe)||"name";scanner.scan(whiteRe);if(type==="="){value=scanner.scanUntil(eqRe);scanner.scan(eqRe);scanner.scanUntil(tagRes[1]);}else if(type==="{"){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe);scanner.scan(curlyRe);scanner.scanUntil(tagRes[1]);type="&";}else value=scanner.scanUntil(tagRes[1]);if(!scanner.scan(tagRes[1]))throw new Error('Unclosed tag at '+scanner.pos);if(type==='/'){if(sections.length===0)throw new Error('Unopened section "'+value+'" at '+start);var section=sections.pop();if(section[1]!==value)throw new Error('Unclosed section "'+section[1]+'" at '+start);}var token=[type,value,start,scanner.pos];tokens.push(token);if(type==='#'||type==='^')sections.push(token);else if(type==="name"||type==="{"||type==="&")nonSpace=true;else if(type==="="){tags=value.split(spaceRe);if(tags.length!==2)throw new Error('Invalid tags at '+start+': '+tags.join(', '));tagRes=escapeTags(tags);}}var section=sections.pop();if(section)throw new Error('Unclosed section "'+section[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens));};var _writer=new Writer();exports.clearCache=function(){return _writer.clearCache();};exports.compile=function(template,tags){return _writer.compile(template,tags);};exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags);};exports.compileTokens=function(tokens,template){return _writer.compileTokens(tokens,template);};exports.render=function(template,view,partials){return _writer.render(template,view,partials);};exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);if(typeof send==="function")send(result);else return result;};return exports;}())));})();},{}],19:[function(require,module,exports){'use strict';var corslite=require('corslite'),JSON3=require('json3'),strict=require('./util').strict;module.exports=function(url,callback){strict(url,'string');strict(callback,'function');corslite(url,function(err,resp){if(!err&&resp)if(resp.responseText[0]=='g')resp=JSON3.parse(resp.responseText.substring(5,resp.responseText.length-2));else resp=JSON3.parse(resp.responseText);callback(err,resp);});};},{"./util":18,"corslite":25,"json3":26}],25:[function(require,module,exports){function xhr(url,callback,cors){if(typeof window.XMLHttpRequest==='undefined')return callback(Error('Browser not supported'));if(typeof cors==='undefined'){var m=url.match(/^\s*https?:\/\/[^\/]*/);cors=m&&(m[0]!==location.protocol+'//'+location.domain+(location.port?':'+location.port:''));}var x;function isSuccessful(status){return status>=200&&status<300||status===304;}if(cors&&(typeof window.XDomainRequest==='object'||typeof window.XDomainRequest==='function'))x=new window.XDomainRequest();else x=new window.XMLHttpRequest();function loaded(){if(x.status===undefined||isSuccessful(x.status))callback.call(x,null,x);else callback.call(x,x,null);}if('onload' in x)x.onload=loaded;else x.onreadystatechange=function readystate(){if(x.readyState===4)loaded();};x.onerror=function error(evt){callback.call(this,evt,null);callback=function(){};};x.onprogress=function(){};x.ontimeout=function(evt){callback.call(this,evt,null);callback=function(){};};x.onabort=function(evt){callback.call(this,evt,null);callback=function(){};};x.open('GET',url,true);x.send(null);return xhr;}if(typeof module!=='undefined')module.exports=xhr;},{}],26:[function(require,module,exports){;(function(window){var getClass={}.toString,isProperty,forEach,undef;var isLoader=typeof define==="function"&&define.amd,JSON3=typeof exports=="object"&&exports;if(JSON3||isLoader){if(typeof JSON=="object"&&JSON)if(JSON3){JSON3.stringify=JSON.stringify;JSON3.parse=JSON.parse;}else JSON3=JSON;else if(isLoader)JSON3=window.JSON={};}else JSON3=window.JSON||(window.JSON={});var isExtended=new Date(-3509827334573292);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708;}catch(exception){}function has(name){if(name=="bug-string-char-index")return "a"[0]!="a";var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',isAll=name=="json";if(isAll||name=="json-stringify"||name=="json-parse"){if(name=="json-stringify"||isAll){var stringify=JSON3.stringify,stringifySupported=typeof stringify=="function"&&isExtended;if(stringifySupported){(value=function(){return 1;}).toJSON=value;try{stringifySupported=stringify(0)==="0"&&stringify(new Number())==="0"&&stringify(new String())=='""'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undef])=="[null]"&&stringify(null)=="null"&&stringify([undef,getClass,null])=="[null,null,null]"&&stringify({"a":[value,true,false,null,"\x00\b\n\f\r\t"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&stringify(new Date(-8.64e15))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(8.64e15))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"';}catch(exception){stringifySupported=false;}}if(!isAll)return stringifySupported;}if(name=="json-parse"||isAll){var parse=JSON3.parse;if(typeof parse=="function")try{if(parse("0")===0&&!parse(false)){value=parse(serialized);var parseSupported=value.a.length==5&&value.a[0]===1;if(parseSupported){try{parseSupported=!parse('"\t"');}catch(exception){}if(parseSupported)try{parseSupported=parse("01")!==1;}catch(exception){}}}}catch(exception){parseSupported=false;}if(!isAll)return parseSupported;}return stringifySupported&&parseSupported;}}if(!has("json")){var functionClass="[object Function]";var dateClass="[object Date]";var numberClass="[object Number]";var stringClass="[object String]";var arrayClass="[object Array]";var booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400);};}if(!(isProperty={}.hasOwnProperty))isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={"toString":1},members).toString!=getClass)isProperty=function(property){var original=this.__proto__,result=property in (this.__proto__=null,this);this.__proto__=original;return result;};else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property]);};}members=null;return isProperty.call(this,property);};forEach=function(object,callback){var size=0,Properties,members,property,forEach;(Properties=function(){this.valueOf=0;}).prototype.valueOf=0;members=new Properties();for(property in members)if(isProperty.call(members,property))size++;Properties=members=null;if(!size){members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;for(property in object)if(!(isFunction&&property=="prototype")&&isProperty.call(object,property))callback(property);for(length=members.length;property=members[--length];isProperty.call(object,property)&&callback(property));};}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object)if(!(isFunction&&property=="prototype")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property))callback(property);};}else forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object)if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor"))callback(property);if(isConstructor||isProperty.call(object,(property="constructor")))callback(property);};return forEach(object,callback);};if(!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width);};var unicodePrefix="\\u00";var quote=function(value){var result='"',index=0,length=value.length,isLarge=length>10&&charIndexBuggy,symbols;if(isLarge)symbols=value.split("");for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break;}result+=isLarge?symbols[index]:charIndexBuggy?value.charAt(index):value[index];}}return result+'"';};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value=object[property],className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,hasMembers,result;try{value=object[property];}catch(exception){}if(typeof value=="object"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,"toJSON"))if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3;}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds();}value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z";}else value=null;else if(typeof value.toJSON=="function"&&((className!=numberClass&&className!=stringClass&&className!=arrayClass)||isProperty.call(value,"toJSON")))value=value.toJSON(property);}if(callback)value=callback.call(object,property,value);if(value===null)return "null";className=getClass.call(value);if(className==booleanClass)return ""+value;else if(className==numberClass)return value>-1/0&&value<1/0?""+value:"null";else if(className==stringClass)return quote(value);if(typeof value=="object"){for(length=stack.length;length--;)if(stack[length]===value)throw TypeError();stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;hasMembers||(hasMembers=true),index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?"null":element);}result=hasMembers?(whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":("["+results.join(",")+"]")):"[]";}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef)results.push(quote(property)+":"+(whitespace?" ":"")+element);hasMembers||(hasMembers=true);});result=hasMembers?(whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":("{"+results.join(",")+"}")):"{}";}stack.pop();return result;}};JSON3.stringify=function(source,filter,width){var whitespace,callback,properties;if(typeof filter=="function"||typeof filter=="object"&&filter)if(getClass.call(filter)==functionClass)callback=filter;else if(getClass.call(filter)==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],((getClass.call(value)==stringClass||getClass.call(value)==numberClass)&&(properties[value]=1)));}if(width)if(getClass.call(width)==numberClass){if((width-=width%1)>0)for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}else if(getClass.call(width)==stringClass)whitespace=width.length<=10?width:width.slice(0,10);return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[]);};}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError();};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32)abort();else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70))abort();}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort();}}else{if(charCode==34)break;charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34)charCode=source.charCodeAt(++Index);value+=source.slice(begin,Index);}}if(source.charCodeAt(Index)==34){Index++;return value;}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index);}if(charCode>=48&&charCode<=57){if(charCode==48&&((charCode=source.charCodeAt(Index+1)),charCode>=48&&charCode<=57))abort();isSigned=false;for(;Index<length&&((charCode=source.charCodeAt(Index)),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&((charCode=source.charCodeAt(position)),charCode>=48&&charCode<=57);position++);if(position==Index)abort();Index=position;}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45)Index++;for(position=Index;position<length&&((charCode=source.charCodeAt(position)),charCode>=48&&charCode<=57);position++);if(position==Index)abort();Index=position;}return +source.slice(begin,Index);}if(isSigned)abort();if(source.slice(Index,Index+4)=="true"){Index+=4;return true;}else if(source.slice(Index,Index+5)=="false"){Index+=5;return false;}else if(source.slice(Index,Index+4)=="null"){Index+=4;return null;}abort();}}return "$";};var get=function(value){var results,hasMembers;if(value=="$")abort();if(typeof value=="string"){if(value[0]=="@")return value.slice(1);if(value=="["){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="]")break;if(hasMembers)if(value==","){value=lex();if(value=="]")abort();}else abort();if(value==",")abort();results.push(get(value));}return results;}else if(value=="{"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="}")break;if(hasMembers)if(value==","){value=lex();if(value=="}")abort();}else abort();if(value==","||typeof value!="string"||value[0]!="@"||lex()!=":")abort();results[value.slice(1)]=get(lex());}return results;}abort();}return value;};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef)delete source[property];else source[property]=element;};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value)if(getClass.call(value)==arrayClass)for(length=value.length;length--;)update(value,length,callback);else forEach(value,function(property){update(value,property,callback);});return callback.call(source,property,value);};JSON3.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$")abort();Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result;};}}if(isLoader)define(function(){return JSON3;});}(this));},{}]},{},[1]);
var BASE_LAYER=APP_CONFIG.MAPBOX_BASE_LAYER;var RETINA_LAYER=APP_CONFIG.MAPBOX_BASE_LAYER_RETINA;var IS_MOBILE=Modernizr.touch;$(function(){SOUTHWEST_BOUND=[42.2026,-71.2664];NORTHWEST_BOUND=[42.4428,-70.9642];FastClick.attach(document.body);var map=L.mapbox.map('map',BASE_LAYER,{detectRetina:true,retinaVersion:RETINA_LAYER,center:[-71.0599,42.3540],minZoom:13,maxZoom:16,scrollWheelZoom:false,maxBounds:[SOUTHWEST_BOUND,NORTHWEST_BOUND]});if(IS_MOBILE)map.dragging.disable();var geolocate=document.getElementById('geolocate');if(!navigator.geolocation)alert('Geolocation is not available. Please use a modern browser or phone');else geolocate.onclick=function(e){e.preventDefault();e.stopPropagation();map.locate();};map.on('locationfound',function(e){console.log(e);map.fitBounds(e.bounds);map.markerLayer.setGeoJSON({type:"Feature",geometry:{type:"Point",coordinates:[e.latlng.lng,e.latlng.lat]},properties:{'marker-color':'#fff'}});});map.on('locationerror',function(){alert('Position could not be found');});});